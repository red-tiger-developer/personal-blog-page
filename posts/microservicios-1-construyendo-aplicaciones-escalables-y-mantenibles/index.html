<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="MicroServicios 1 Construyendo aplicaciones escalables y mantenibles" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/microservicios-1-construyendo-aplicaciones-escalables-y-mantenibles/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/microservicios-1-construyendo-aplicaciones-escalables-y-mantenibles/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-10-27T02:00:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="MicroServicios 1 Construyendo aplicaciones escalables y mantenibles" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2023-10-27T02:00:00-03:00","datePublished":"2023-10-27T02:00:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"MicroServicios 1 Construyendo aplicaciones escalables y mantenibles","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/microservicios-1-construyendo-aplicaciones-escalables-y-mantenibles/"},"url":"https://nullpointer-excelsior.github.io/posts/microservicios-1-construyendo-aplicaciones-escalables-y-mantenibles/"}</script><title>MicroServicios 1 Construyendo aplicaciones escalables y mantenibles | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>MicroServicios 1 Construyendo aplicaciones escalables y mantenibles</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>MicroServicios 1 Construyendo aplicaciones escalables y mantenibles</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1698382800" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-10-27 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2244 palabras"> <em>12 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="https://i.ibb.co/SdBbxx6/Screenshot-2023-11-27-at-11-49-41.png" alt="img" data-proofer-ignore></p><p>En este capítulo tomaremos nota de pequeños tips para generar aplicaciones escalables y mantenibles, las cuales podrán ayudarte de manera más sencilla en una posible transición de monolito a microservicios. No todos los sistemas en sus primeros pasos necesitan una arquitectura de microservicios, pero si puedes aplicar un poco de buenas prácticas te ahorrarás dolores de cabeza.</p><h2 id="spotify-clone-con-nestjs-como-prueba-de-concepto"><span class="mr-2">Spotify clone con NestJs como prueba de concepto</span><a href="#spotify-clone-con-nestjs-como-prueba-de-concepto" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Crearemos un clon de Spotify para ejemplificar. Con el siguiente diagrama de clases robado de internet modelaremos una API Restful con NestJs. Esta aplicación será una API backend.</p><p><img data-src="https://i.ibb.co/3rc8bS3/diagrama-clases-spotify.jpg" alt="diagrama-clases-spotify.jpg" data-proofer-ignore></p><p>En base a esto crearemos nuestro backend, el cual será un simple CRUD en comienzo.</p><p>El diseño de clases lo convertimos en un diseño de entidades de ORM.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Album</span> <span class="p">{</span>

  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">(</span><span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">title</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">photo</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">year</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">OneToMany</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">,</span> <span class="nx">song</span> <span class="o">=&gt;</span> <span class="nx">song</span><span class="p">.</span><span class="nx">album</span><span class="p">)</span>
  <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[];</span>

  <span class="p">@</span><span class="nd">ManyToOne</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Artist</span><span class="p">,</span> <span class="nx">artist</span> <span class="o">=&gt;</span> <span class="nx">artist</span><span class="p">.</span><span class="nx">albums</span><span class="p">)</span>
  <span class="nx">artist</span><span class="p">:</span> <span class="nx">Artist</span>

<span class="p">}</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Artist</span> <span class="p">{</span>

  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">(</span><span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">photo</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">biography</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">OneToMany</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">,</span> <span class="nx">song</span> <span class="o">=&gt;</span> <span class="nx">song</span><span class="p">.</span><span class="nx">artist</span><span class="p">)</span>
  <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[]</span>

  <span class="p">@</span><span class="nd">OneToMany</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Album</span><span class="p">,</span> <span class="nx">album</span> <span class="o">=&gt;</span> <span class="nx">album</span><span class="p">.</span><span class="nx">artist</span><span class="p">)</span>
  <span class="nx">albums</span><span class="p">:</span> <span class="nx">Album</span><span class="p">[]</span>

<span class="p">}</span>


<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Genre</span> <span class="p">{</span>

  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">(</span><span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">OneToMany</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">,</span> <span class="nx">song</span> <span class="o">=&gt;</span> <span class="nx">song</span><span class="p">.</span><span class="nx">genre</span><span class="p">)</span>
  <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[];</span>

<span class="p">}</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Playlist</span> <span class="p">{</span>

  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">(</span><span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">duration</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">ManyToMany</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">JoinTable</span><span class="p">()</span>
  <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[];</span>

  <span class="p">@</span><span class="nd">ManyToOne</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">User</span><span class="p">,</span> <span class="nx">user</span> <span class="o">=&gt;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">playlists</span><span class="p">)</span>
  <span class="nx">user</span><span class="p">:</span> <span class="nx">User</span><span class="p">;</span>

<span class="p">}</span>


<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Radio</span> <span class="p">{</span>

  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">(</span><span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">ManyToMany</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">,</span> <span class="p">(</span><span class="nx">song</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">song</span><span class="p">.</span><span class="nx">radios</span><span class="p">)</span>
  <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[];</span>

  <span class="p">@</span><span class="nd">ManyToOne</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Genre</span><span class="p">,</span> <span class="nx">genre</span> <span class="o">=&gt;</span> <span class="nx">genre</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span>
  <span class="nx">genre</span><span class="p">:</span> <span class="nx">Genre</span>

<span class="p">}</span>

<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Song</span> <span class="p">{</span>

  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">(</span><span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">title</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">video</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">plays</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">duration</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">ManyToOne</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Album</span><span class="p">,</span> <span class="nx">album</span> <span class="o">=&gt;</span> <span class="nx">album</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span>
  <span class="nx">album</span><span class="p">:</span> <span class="nx">Album</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">ManyToOne</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Artist</span><span class="p">,</span> <span class="nx">artist</span> <span class="o">=&gt;</span> <span class="nx">artist</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span>
  <span class="nx">artist</span><span class="p">:</span> <span class="nx">Artist</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">ManyToOne</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Genre</span><span class="p">,</span> <span class="nx">genre</span> <span class="o">=&gt;</span> <span class="nx">genre</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span>
  <span class="nx">genre</span><span class="p">:</span> <span class="nx">Genre</span>

  <span class="p">@</span><span class="nd">ManyToMany</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Radio</span><span class="p">,</span> <span class="p">(</span><span class="nx">radio</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">radio</span><span class="p">.</span><span class="nx">songs</span><span class="p">)</span>
  <span class="p">@</span><span class="nd">JoinTable</span><span class="p">()</span>
  <span class="nx">radios</span><span class="p">:</span> <span class="nx">Radio</span><span class="p">[]</span>

<span class="p">}</span>


<span class="p">@</span><span class="nd">Entity</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">User</span> <span class="p">{</span>

  <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">(</span><span class="dl">"</span><span class="s2">uuid</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">password</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
  <span class="nx">premium</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>

  <span class="p">@</span><span class="nd">OneToMany</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Playlist</span><span class="p">,</span> <span class="nx">playlist</span> <span class="o">=&gt;</span> <span class="nx">playlist</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span>
  <span class="nx">playlists</span><span class="p">:</span> <span class="nx">Playlist</span><span class="p">[];</span>

<span class="p">}</span>

</pre></table></code></div></div><p>A partir de esta base construiremos un pequeño proyecto con buenas prácticas y tips.</p><h2 id="1---define-tu-aplicación-de-forma-modular"><span class="mr-2">1 - Define tu aplicación de forma modular</span><a href="#1---define-tu-aplicación-de-forma-modular" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Crear tu aplicación de forma modular, separa los casos de uso relacionados en un contexto específico y define qué componentes serán compartidos por estos módulos para poder reutilizar código en común o funciones utilitarias. Sin embargo, estos deberían ser piezas de software pequeñas y extensibles. Si utilizamos funciones, tratemos de que sean lo más puras posibles y con sus test unitarios.</p><p><strong>Ejemplo:</strong> Módulos de Spotify clone:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre> src
├──  accounts
├──  music-library
├──  player
└──  shared
    ├──  database
    └──  decorators

</pre></table></code></div></div><p>Definimos los módulos principales <code class="language-plaintext highlighter-rouge">player</code>, <code class="language-plaintext highlighter-rouge">music-library</code> y <code class="language-plaintext highlighter-rouge">accounts</code>. Estos tendrán agrupados sus casos de uso, servicios, repositorios, controladores y modelos de datos, mientras que el módulo <code class="language-plaintext highlighter-rouge">shared</code> contendrá los componentes compartidos por la aplicación. En este caso, el módulo <code class="language-plaintext highlighter-rouge">database</code> contiene las entidades ORM del modelo de datos de la aplicación.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre> database
├──  database.module.ts
└──  entities
    ├──  album.entity.ts
    ├──  artist.entity.ts
    ├──  entity.base.ts
    ├──  genre.entity.ts
    ├──  playlist.entity.ts
    ├──  radio.entity.ts
    ├──  song.entity.ts
    └──  user.entity.ts

</pre></table></code></div></div><p>Ahora, con este enfoque, cada módulo puede implementar su propia arquitectura y diseño. En este ejemplo, el módulo <code class="language-plaintext highlighter-rouge">library</code> es solo un API CRUD para acceder a artistas, álbumes y canciones, por lo que las guías de diseño de NestJs nos bastan y sobran. En cambio, el módulo <code class="language-plaintext highlighter-rouge">player</code> puede tener mayor complejidad en ciertos casos de uso, por lo que podemos implementar una arquitectura hexagonal aislada en su propio módulo sin que otras partes de la aplicación se vean obligadas a implementarla.</p><p><strong>Ejemplo de CRUD:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre> music-library
├──  controller
│   ├──  album.controller.ts
│   ├──  artists.controller.ts
│   ├──  genre.controller.ts
│   └──  song.controller.ts
├──  model
│   ├──  album.model.ts
│   ├──  artist.model.ts
│   ├──  genre.model.ts
│   └──  song.model.ts
├──  music-library.module.ts
└──  service
    ├──  album.service.ts
    ├──  artist.service.ts
    ├──  genre.service.ts
    └──  song.service.ts

</pre></table></code></div></div><p><strong>Ejemplo Arquitectura Hexagonal:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre> player
├──  application
│   ├──  playlists.use-cases.ts
│   └──  radio.use-cases.ts
├──  domain
│   ├──  factory
│   │   ├──  create-playlist-entity.ts
│   │   └──  create-playlist-model.ts
│   ├──  model
│   │   ├──  genre.model.ts
│   │   ├──  playlist.model.ts
│   │   ├──  radio.model.ts
│   │   ├──  song.model.ts
│   │   └──  user.model.ts
│   └──  service
│       ├──  playlist.service.ts
│       ├──  radio.service.ts
│       ├──  song.service.ts
│       └──  user.service.ts
├──  infrastructure
│   └──  restful-api
│       ├──  controller
│       │   ├──  playlist.controller.ts
│       │   └──  radio.controller.ts
│       └──  dto
│           ├──  create-playlist.request.ts
│           ├──  create-radio.request.ts
│           └──  entity-created.response.ts
└──  player.module.ts
</pre></table></code></div></div><h2 id="2---definir-una-comunicación-entre-módulos-desacoplada"><span class="mr-2">2 - Definir una comunicación entre módulos desacoplada</span><a href="#2---definir-una-comunicación-entre-módulos-desacoplada" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Al definir una arquitectura modular, es muy probable que ciertos casos de uso nos obliguen a requerir algún servicio de otro módulo que no sea <code class="language-plaintext highlighter-rouge">shared</code>. Esto es propenso a crear código espagueti para establecer una comunicación desacoplada entre módulos. Podemos hacer uso de un event bus en memoria y aplicar una arquitectura orientada a eventos.</p><p>NestJs nos provee un módulo de <a href="https://docs.nestjs.com/techniques/events">eventos</a> el cual podemos hacer uso:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm i <span class="nt">--save</span> @nestjs/event-emitter
</pre></table></code></div></div><p>Crearemos un pequeño ejemplo basado en la creación de una nueva Radio cuando un nuevo álbum es creado.</p><p>Definimos una clase que representa el evento y lo agregamos a nuestro módulo <code class="language-plaintext highlighter-rouge">shared</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">AlbumCreatedEvent</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="k">public</span> <span class="nx">album</span><span class="p">:</span> <span class="nx">Album</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Ahora, cuando en el módulo <code class="language-plaintext highlighter-rouge">music-library</code> se hace un llamado al <code class="language-plaintext highlighter-rouge">create()</code> del servicio <code class="language-plaintext highlighter-rouge">AlbumService</code>, emitiremos el evento.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AlbumService</span> <span class="p">{</span>

	<span class="kd">constructor</span><span class="p">(</span>
		<span class="p">@</span><span class="nd">InjectRepository</span><span class="p">(</span><span class="nx">Album</span><span class="p">)</span> <span class="k">private</span> <span class="nx">albumRepository</span><span class="p">:</span> <span class="nx">Repository</span><span class="o">&lt;</span><span class="nx">Album</span><span class="o">&gt;</span><span class="p">,</span>
		<span class="p">@</span><span class="nd">InjectRepository</span><span class="p">(</span><span class="nx">Song</span><span class="p">)</span> <span class="k">private</span> <span class="nx">songRepository</span><span class="p">:</span> <span class="nx">Repository</span><span class="o">&lt;</span><span class="nx">Song</span><span class="o">&gt;</span><span class="p">,</span>
		<span class="p">@</span><span class="nd">InjectRepository</span><span class="p">(</span><span class="nx">Artist</span><span class="p">)</span> <span class="k">private</span> <span class="nx">artistRepository</span><span class="p">:</span> <span class="nx">Repository</span><span class="o">&lt;</span><span class="nx">Artist</span><span class="o">&gt;</span><span class="p">,</span>
		<span class="k">private</span> <span class="nx">eventEmitter</span><span class="p">:</span> <span class="nx">EventEmitter2</span>
	<span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
  
	<span class="k">async</span> <span class="nx">create</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">CreateAlbumRequest</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">const</span> <span class="nx">songs</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">songRepository</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span> <span class="na">where</span><span class="p">:</span> <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="nx">In</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">songIds</span><span class="p">)}})</span>
		<span class="kd">const</span> <span class="nx">artist</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">artistRepository</span><span class="p">.</span><span class="nx">findOneBy</span><span class="p">({</span> <span class="na">id</span><span class="p">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">artistId</span> <span class="p">})</span>
		
		<span class="kd">const</span> <span class="nx">albumCreated</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">albumRepository</span><span class="p">.</span><span class="nx">save</span><span class="p">({</span>
			<span class="na">title</span><span class="p">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
			<span class="na">photo</span><span class="p">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">photo</span><span class="p">,</span>
			<span class="na">artist</span><span class="p">:</span> <span class="nx">artist</span><span class="p">,</span>
			<span class="na">year</span><span class="p">:</span> <span class="nx">request</span><span class="p">.</span><span class="nx">year</span><span class="p">,</span>
			<span class="nx">songs</span>
		<span class="p">})</span>
		
		<span class="k">this</span><span class="p">.</span><span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">library.album-created</span><span class="dl">'</span><span class="p">,</span> <span class="k">new</span> <span class="nx">AlbumCreatedEvent</span><span class="p">(</span>
			<span class="nx">albumCreated</span>
		<span class="p">))</span>
		
		<span class="k">return</span> <span class="nx">albumCreated</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Y ahora, en nuestro módulo <code class="language-plaintext highlighter-rouge">player</code>, escuchamos el evento.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">NewAlbumListener</span> <span class="p">{</span>

	<span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">radio</span><span class="p">:</span> <span class="nx">RadioUseCases</span><span class="p">)</span> <span class="p">{}</span>

	<span class="p">@</span><span class="nd">OnEvent</span><span class="p">(</span><span class="dl">'</span><span class="s1">library.album-created</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">async</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
	<span class="k">async</span> <span class="nx">onNewAlbum</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">AlbumCreatedEvent</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">radio</span><span class="p">.</span><span class="nx">createLatestAmazingAlbumsRadio</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">album</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Ahora, nuestros módulos quedan más aislados en responsabilidades, incluyendo la posibilidad de tener múltiples suscriptores a eventos.</p><h2 id="3---utilizar-esquemas-separados-por-cada-módulo-para-bases-de-datos-relacionales"><span class="mr-2">3 - Utilizar esquemas separados por cada módulo para bases de datos relacionales</span><a href="#3---utilizar-esquemas-separados-por-cada-módulo-para-bases-de-datos-relacionales" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Este enfoque nos permite una separación lógica y física de los datos más comprensible y nos permitiría una migración más limpia si un módulo lo queremos pasar a una aplicación independiente. En estos casos, diferentes esquemas para los datos también nos dan la flexibilidad.</p><p>TypeORM nos permite hacer esto mediante anotaciones.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Entity</span><span class="p">({</span> <span class="na">schema</span><span class="p">:</span> <span class="dl">"</span><span class="s2">music_library</span><span class="dl">"</span> <span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Song</span> <span class="p">{</span>
	<span class="c1">// ...entity code</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Ahora, cada esquema representará un módulo de nuestra aplicación. Los datos tendrán sus contextos definidos y aún así nos da la posibilidad de consultar los datos entre esquemas.</p><h2 id="4---conoce-los-principios-solid"><span class="mr-2">4 - Conoce los principios SOLID</span><a href="#4---conoce-los-principios-solid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Estos 5 principios de diseño de software son aplicados a la programación orientada a objetos y es una excelente manera de crear código mantenible y escalable. Afortunadamente, muchos de estos principios son aplicados por frameworks como NestJs, Spring y muchos similares. Por lo que, si piensas que nunca los has aplicado, lo más probable es que te hayas topado sin darte cuenta. De todas formas, aquí un breve ejemplo de cada principio.</p><h3 id="principio-de-responsabilidad-única-srp"><span class="mr-2">Principio de responsabilidad única (SRP)</span><a href="#principio-de-responsabilidad-única-srp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Cada clase o módulo debe tener una sola responsabilidad. Por ejemplo, <code class="language-plaintext highlighter-rouge">UserService</code> solo tiene operaciones para manipular el modelo de <code class="language-plaintext highlighter-rouge">User</code> mediante <code class="language-plaintext highlighter-rouge">Repository</code> y el componente.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserService</span> <span class="p">{</span>
	<span class="c1">// ...</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="principio-de-abiertocerrado-ocp"><span class="mr-2">Principio de abierto/cerrado (OCP)</span><a href="#principio-de-abiertocerrado-ocp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Este principio establece que las clases deben ser abiertas para la extensión, pero cerradas para la modificación. Por ejemplo, si no estás seguro de qué base de datos es la indicada en tu aplicación, puedes aplicar el patrón <code class="language-plaintext highlighter-rouge">Entity Repository</code> para desacoplar tu dominio del almacenamiento de datos definido. Este patrón también ayuda a un mejor testing unitario.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="c1">// Repository contract</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">SongRepository</span> <span class="p">{</span>
  <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Song</span><span class="o">&gt;</span><span class="p">;</span>    
<span class="p">}</span>
<span class="c1">// repository implementation</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SongPostgresRepository</span> <span class="k">implements</span> <span class="nx">SongRepository</span> <span class="p">{</span>
  <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Song</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// code to implement a orm crud</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// NesJs provider declaration</span>
<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
    <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">provide</span><span class="p">:</span> <span class="dl">"</span><span class="s2">SONG_REPOSITORY</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">useClass</span><span class="p">:</span> <span class="nx">SongPostgresRepository</span>
      <span class="p">}</span>
    <span class="p">]</span>    
<span class="p">})</span>
<span class="k">export</span> <span class="nx">PlayerModule</span> <span class="p">{}</span>
<span class="c1">// Repository injection</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SongUseCases</span> <span class="p">{</span>
  
  <span class="kd">constructor</span><span class="p">(@</span><span class="nd">Inject</span><span class="p">(</span><span class="dl">"</span><span class="s2">SONG_REPOSITORY</span><span class="dl">"</span><span class="p">)</span> <span class="k">private</span> <span class="nx">songRepository</span><span class="p">:</span> <span class="nx">SongRepository</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>NestJs no permite providers personalizados, así que en la definición, nuestra entidad es la representación de nuestros datos y su lógica asociada, y repository es el componente que realiza operaciones de escritura y lectura. Este componente es solo un contrato, una interfaz, la cual debemos implementar con la lógica asociada al motor de base de datos que estemos usando.</p><h3 id="principio-de-segregación-de-interfaz-isp"><span class="mr-2">Principio de segregación de interfaz (ISP)</span><a href="#principio-de-segregación-de-interfaz-isp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Este principio establece que las interfaces deben ser lo más pequeñas y específicas posible. Esto quiere decir que una interfaz implementa su mínima funcionalidad. En el siguiente ejemplo, definimos un EventDispatcher para enviar mensajes, EventListener para escuchar eventos y EventBus, el cual hereda ambas interfaces para crear una implementación completa de un event bus.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span><span class="p">,</span> <span class="nx">Subject</span><span class="p">,</span> <span class="nx">filter</span><span class="p">,</span> <span class="nx">iif</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">v4</span> <span class="k">as</span> <span class="nx">uuid</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">uuid</span><span class="dl">'</span><span class="p">;</span>

<span class="cm">/**
 * Represents a domain event with a specific data payload.
 */</span>
<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="nx">D</span><span class="p">,</span> <span class="nx">E</span> <span class="kd">extends</span> <span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">readonly</span> <span class="na">datetime</span><span class="p">:</span> <span class="nb">Date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="k">readonly</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">uuid</span><span class="p">()</span>
    <span class="kd">abstract</span> <span class="na">name</span><span class="p">:</span> <span class="nx">E</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="k">public</span> <span class="k">readonly</span> <span class="na">data</span><span class="p">:</span> <span class="nx">D</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * Defines the contract for an event dispatcher.
 */</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">EventDispatcher</span><span class="o">&lt;</span><span class="nx">E</span> <span class="kd">extends</span> <span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="cm">/**
     * Dispatches a domain event to appropriate listeners.
     * @param event The domain event to dispatch.
     */</span>
    <span class="nx">dispatch</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="p">,</span> <span class="nx">E</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**
 * Defines the contract for an event listener.
 */</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">EventListener</span><span class="o">&lt;</span><span class="nx">E</span> <span class="kd">extends</span> <span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="cm">/**
     * Subscribes to events of a specific name or all events.
     * @param name The name of the event to subscribe to (optional).
     * @returns An observable stream of events.
     */</span>
    <span class="nx">onEvent</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="p">,</span> <span class="nx">E</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">name</span><span class="p">?:</span> <span class="nx">E</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="cm">/**
 * Defines the contract for an event bus that acts as both a dispatcher and a listener.
 */</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">EventBus</span><span class="o">&lt;</span><span class="nx">E</span> <span class="kd">extends</span> <span class="kr">string</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nx">EventListener</span><span class="o">&lt;</span><span class="nx">E</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">EventDispatcher</span><span class="o">&lt;</span><span class="nx">E</span><span class="o">&gt;</span> <span class="p">{</span>

<span class="p">}</span>

<span class="cm">/**
 * An implementation of EventBus using RxJS.
 */</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">RxjsEventBus</span><span class="o">&lt;</span><span class="nx">E</span> <span class="kd">extends</span> <span class="kr">string</span><span class="o">&gt;</span> <span class="k">implements</span> <span class="nx">EventBus</span><span class="o">&lt;</span><span class="nx">E</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">private</span> <span class="nx">events$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="o">&lt;</span><span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="p">,</span> <span class="nx">E</span><span class="o">&gt;&gt;</span><span class="p">()</span>

    <span class="nx">onEvent</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="p">,</span> <span class="nx">E</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">eventName</span><span class="p">?:</span> <span class="nx">E</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">iif</span><span class="p">(</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">eventName</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">,</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">events$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">filter</span><span class="p">(</span><span class="nx">event</span> <span class="o">=&gt;</span> <span class="nx">eventName</span> <span class="o">===</span> <span class="nx">event</span><span class="p">.</span><span class="nx">name</span><span class="p">)),</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">events$</span><span class="p">.</span><span class="nx">asObservable</span><span class="p">()</span>
        <span class="p">)</span> <span class="k">as</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">dispatch</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="p">,</span> <span class="nx">E</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">events$</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><h3 id="principio-de-inversión-de-dependencias-dip"><span class="mr-2">Principio de inversión de dependencias (DIP)</span><a href="#principio-de-inversión-de-dependencias-dip" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Las clases de alto nivel no deben depender de clases de bajo nivel, sino de abstracciones. NestJs implementa este principio en sus providers.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">PlayListUseCases</span> <span class="p">{</span>
	
	<span class="kd">constructor</span><span class="p">(</span>
		<span class="k">private</span> <span class="nx">user</span><span class="p">:</span> <span class="nx">UserService</span><span class="p">,</span>
		<span class="k">private</span> <span class="nx">song</span><span class="p">:</span> <span class="nx">SongService</span><span class="p">,</span>
		<span class="k">private</span> <span class="nx">playlist</span><span class="p">:</span> <span class="nx">PlaylistService</span>
	<span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
	
<span class="p">}</span>
</pre></table></code></div></div><h2 id="conclusión"><span class="mr-2">Conclusión</span><a href="#conclusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Abordamos estas simples recomendaciones, las cuales pueden ayudar a crear aplicaciones escalables y mantenibles. Todo dependerá del caso, pero cuando un sistema puede crecer, es mejor considerar todas las buenas prácticas posibles. Cada proyecto es un mundo, al igual que el tiempo que nos dan para poder realizar un proyecto.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/microservices-architecture-nestjs/tree/master/apps/spotify-monolith">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="meme-de-cortesía"><span class="mr-2">Meme de cortesía:</span><a href="#meme-de-cortesía" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="https://i.ibb.co/6F6XkPM/Screenshot-2023-11-27-at-11-57-42.png" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/arquitectura/'>Arquitectura</a>, <a href='//categories/software/'>Software,</a>, <a href='//categories/domain/'>Domain</a>, <a href='//categories/driven/'>Driven</a>, <a href='//categories/design/'>Design,</a>, <a href='//categories/microservicios/'>Microservicios,</a>, <a href='//categories/nestjs/'>NestJs,</a>, <a href='//categories/patrones/'>Patrones,</a>, <a href='//categories/backend/'>Backend,</a>, <a href='//categories/fullstack/'>Fullstack,</a>, <a href='//categories/software/'>Software</a>, <a href='//categories/engineer/'>Engineer</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/arquitectura/" class="post-tag no-text-decoration" >arquitectura</a> <a href="//tags/software/" class="post-tag no-text-decoration" >software,</a> <a href="//tags/domain/" class="post-tag no-text-decoration" >domain</a> <a href="//tags/driven/" class="post-tag no-text-decoration" >driven</a> <a href="//tags/design/" class="post-tag no-text-decoration" >design,</a> <a href="//tags/microservicios/" class="post-tag no-text-decoration" >microservicios,</a> <a href="//tags/nestjs/" class="post-tag no-text-decoration" >nestjs,</a> <a href="//tags/patrones/" class="post-tag no-text-decoration" >patrones,</a> <a href="//tags/backend/" class="post-tag no-text-decoration" >backend,</a> <a href="//tags/fullstack/" class="post-tag no-text-decoration" >fullstack,</a> <a href="//tags/software/" class="post-tag no-text-decoration" >software</a> <a href="//tags/engineer/" class="post-tag no-text-decoration" >engineer</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=MicroServicios+1+Construyendo+aplicaciones+escalables+y+mantenibles+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fmicroservicios-1-construyendo-aplicaciones-escalables-y-mantenibles%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=MicroServicios+1+Construyendo+aplicaciones+escalables+y+mantenibles+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fmicroservicios-1-construyendo-aplicaciones-escalables-y-mantenibles%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fmicroservicios-1-construyendo-aplicaciones-escalables-y-mantenibles%2F&text=MicroServicios+1+Construyendo+aplicaciones+escalables+y+mantenibles+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fmicroservicios-1-construyendo-aplicaciones-escalables-y-mantenibles%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/patrones-de-resiliencia/"><div class="card-body"> <em class="small" data-ts="1715230800" data-df="YYYY-MM-DD" > 2024-05-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Patrones de resiliencia</h3><div class="text-muted small"><p> ¿Qué es la resiliencia? La resiliencia es la capacidad de un sistema de poder recuperarse de un escenario adverso. En el desarrollo de software, podemos aplicar este concepto para crear aplicaci...</p></div></div></a></div><div class="card"> <a href="/posts/sagas-i-transacciones-distribuidas-con-patrones-saga/"><div class="card-body"> <em class="small" data-ts="1710133200" data-df="YYYY-MM-DD" > 2024-03-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Sagas I - Transacciones Distribuidas Con Patrones Saga</h3><div class="text-muted small"><p> Transacciones centralizadas vs distribuidas Las aplicaciones monolíticas tienen la ventaja de poder crear procesos transaccionales de forma sencilla. Las transacciones nos ayudan a mantener la c...</p></div></div></a></div><div class="card"> <a href="/posts/comunicacion-sincrona-avanzada-en-microservicios/"><div class="card-body"> <em class="small" data-ts="1704862800" data-df="YYYY-MM-DD" > 2024-01-10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Comunicación síncrona avanzada en Microservicios</h3><div class="text-muted small"><p> En una arquitectura de microservicios, podemos comunicar nuestras aplicaciones de forma síncrona y asíncrona. En este artículo, exploraremos comunicaciones síncronas avanzadas. Si bien RESTful es...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/arquitectura-frontend-2-como-implementar-clean-arquitecture/" class="btn btn-outline-primary" prompt="Anterior"><p>Arquitectura Frontend 2. Cómo implementar Clean Architecture en el Frontend.</p></a> <a href="//posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/" class="btn btn-outline-primary" prompt="Nuevo"><p>Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
