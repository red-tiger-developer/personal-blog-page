<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Arquitecturas EDA Eventos de dominio vs eventos de integración" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/arquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/arquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-02-12T02:00:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Arquitecturas EDA Eventos de dominio vs eventos de integración" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2024-02-12T02:00:00-03:00","datePublished":"2024-02-12T02:00:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Arquitecturas EDA Eventos de dominio vs eventos de integración","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/arquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion/"},"url":"https://nullpointer-excelsior.github.io/posts/arquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion/"}</script><title>Arquitecturas EDA Eventos de dominio vs eventos de integración | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Arquitecturas EDA Eventos de dominio vs eventos de integración</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Arquitecturas EDA Eventos de dominio vs eventos de integración</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1707714000" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2024-02-12 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2528 palabras"> <em>14 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/intros/intro4.webp" alt="intro" data-proofer-ignore></p><p>La comunicación asíncrona entre microservicios nos ayuda a crear procesos complejos donde las responsabilidades del sistema están repartidas entre distintas aplicaciones. Como es la filosofía de los microservicios, separar responsabilidades para mantener ciertas características independientes entre sí nos ayuda a lograr escalabilidad, manejo de cargas y tolerancia a errores, pero esto conlleva un gran desafío de comunicación. Comunicar un servicio de forma síncrona y esperar una respuesta no siempre es viable. Hay cargas de trabajo que no requieren una respuesta inmediata, e incluso muchas veces esto puede fallar y romper todo el flujo de un proceso importante. Nadie quiere esto en una compra de considerable valor.</p><p>Cuando la comunicación síncrona no es la opción, te presento las arquitecturas EDA, o arquitecturas basadas en eventos. Este enfoque nos da la posibilidad de comunicarnos con componentes tanto internos de una aplicación como con servicios o aplicaciones externas. En esta ocasión analizaremos los eventos de dominio y los eventos de integración.</p><h2 id="comunicación-basada-en-eventos"><span class="mr-2">Comunicación basada en eventos</span><a href="#comunicación-basada-en-eventos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>La integración de aplicaciones y servicios utilizando arquitecturas orientadas a eventos es esencial para crear sistemas robustos y flexibles. Dos conceptos fundamentales en este ámbito son los eventos de dominio y los eventos de integración. Ambos desempeñan roles cruciales, pero se aplican en contextos un tanto diferentes, pero a su vez son compatibles entre sí, lo que nos permite crear sistemas complejos y desacoplados.</p><h3 id="eventos-de-dominio"><span class="mr-2">Eventos de Dominio:</span><a href="#eventos-de-dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Los eventos de dominio son fundamentales en el diseño basado en dominio o DDD, una técnica que se centra en modelar el sistema según el dominio de negocio al que pertenece. Estos eventos representan cambios significativos en el estado del dominio y suelen estar vinculados estrechamente a los conceptos del modelo de dominio. También representan hechos pasados del dominio, por ejemplo: <code class="language-plaintext highlighter-rouge">user-created</code>, <code class="language-plaintext highlighter-rouge">user-banned</code>, <code class="language-plaintext highlighter-rouge">stock-updated</code>, etc.</p><blockquote><p>Si bien los eventos de dominio los encuentras mucho en sistemas hechos con DDD, nadie te impide usarlos en arquitecturas más simples como las de N-capas.</p></blockquote><h4 id="características-clave"><span class="mr-2">Características Clave:</span><a href="#características-clave" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><strong>Contexto de Negocio</strong>: Los eventos de dominio se originan en el núcleo del negocio y reflejan acciones o cambios relevantes para el dominio.<li><strong>Desacoplamiento</strong>: Permiten un desacoplamiento eficiente entre las distintas partes del sistema al enfocarse en la semántica del dominio en lugar de detalles de implementación.<li><strong>Modelado Preciso</strong>: Al reflejar eventos específicos del dominio, estos eventos contribuyen a un modelado más preciso y representativo del negocio.</ul><h3 id="eventos-de-integración"><span class="mr-2">Eventos de Integración:</span><a href="#eventos-de-integración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Los eventos de integración son mensajes diseñados para coordinar la interacción entre microservicios o aplicaciones. Estos eventos abordan la necesidad de sincronización y colaboración en un entorno distribuido. Estos eventos representan mensajes que se intercambian entre componentes o servicios para mantener la coherencia y la sincronización en el ecosistema de software.</p><h4 id="características-clave-1"><span class="mr-2">Características Clave:</span><a href="#características-clave-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li><strong>Comunicación Inter-Servicios</strong>: Los eventos de integración facilitan la comunicación entre diferentes servicios o componentes, permitiendo la colaboración en un entorno distribuido.<li><strong>Desacoplamiento de Sistemas</strong>: Al utilizar eventos para la integración, se logra un desacoplamiento efectivo entre sistemas, lo que facilita la escalabilidad y la evolución independiente de cada componente.<li><strong>Interoperabilidad</strong>: Son esenciales para lograr interoperabilidad entre sistemas heterogéneos, ya que proporcionan un medio estandarizado de intercambio de información.</ul><p>Es crucial comprender que los eventos de dominio y los eventos de integración sirven propósitos diferentes, pero no son mutuamente excluyentes. De hecho, su uso combinado puede potenciar la eficacia de un sistema.</p><h2 id="casos-de-uso-eventos-de-dominio"><span class="mr-2">Casos de Uso Eventos de dominio:</span><a href="#casos-de-uso-eventos-de-dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>En nuestra arquitectura de nuestro <strong>Spotify-clone</strong> veremos los eventos de dominio ocurridos en el microservicio <code class="language-plaintext highlighter-rouge">music-discovery-ms</code>. Esta aplicación contiene los siguientes módulos:</p><ul><li><strong>user-catalog</strong>: catálogo musical del usuario con playlists personales, artistas y canciones favoritas.<li><strong>playlist-catalog</strong>: catálogo de playlists ofrecidas a los usuarios.<li><strong>shared</strong>: componentes compartidos entre los módulos.</ul><h3 id="caso-de-uso-el-catálogo-de-playlists-públicos-debe-actualizarse-si-el-usuario-actualiza-sus-playlists-de-tipo-público"><span class="mr-2">Caso de uso: El catálogo de playlists públicos debe actualizarse si el usuario actualiza sus playlists de tipo público.</span><a href="#caso-de-uso-el-catálogo-de-playlists-públicos-debe-actualizarse-si-el-usuario-actualiza-sus-playlists-de-tipo-público" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Cuando el usuario crea una playlist en su catálogo, si esta es de tipo público, debe agregarse automáticamente al catálogo de playlists de <strong>Spotify-clone</strong> para poder ser indexado de forma eficiente.</p><p>Analizando el caso de uso, lo único que tendríamos que hacer es invocar al repositorio encargado de la playlist de <strong>Spotify-clone</strong> cuando el usuario actualice su playlist. Pero para ejemplos reales, suponiendo que la complejidad del código es alta, acoplar el módulo <code class="language-plaintext highlighter-rouge">user-catalog</code> con <code class="language-plaintext highlighter-rouge">playlist-catalog</code> en el caso de uso de actualizar catálogo de usuario no tiene nada que ver con el caso de uso de actualizar el catálogo de playlist. Esto incluso no nos permite que nuestro código sea escalable. Para solucionar esto, comunicaremos estos 2 módulos mediante eventos de dominio.</p><p>Primero creamos dentro de la librería <code class="language-plaintext highlighter-rouge">libs/utils</code> del proyecto monorepo una librería de utilitarios de DDD llamada <code class="language-plaintext highlighter-rouge">seedwork</code> con clase base para los eventos de dominio.</p><blockquote><p><code class="language-plaintext highlighter-rouge">seedwork</code> El nombre hace referencia a un tipo de mini framework de utilidades propias, pero aplicado a nivel local de tu proyecto. Puedes encontrarlo con otros nombres como shared-kernel, commons, core, etc.</p></blockquote><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c1">//libs/utils/src/seedwork/domain/events/eventbus.ts</span>
<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">DomainEventBus</span> <span class="p">{</span>
    <span class="kd">abstract</span> <span class="nx">publish</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="k">void</span>
<span class="p">}</span>
<span class="c1">//libs/utils/src/seedwork/domain/events/domain.event.ts</span>
<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="nx">T</span> <span class="o">=</span> <span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">readonly</span> <span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="na">occurredOn</span><span class="p">:</span> <span class="nb">Date</span><span class="p">;</span>
    
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">T</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">occurredOn</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Nos ayudamos de la librería <a href="https://docs.nestjs.com/techniques/events">eventemitter</a> de NestJS para crear un eventbus en memoria para poder emitir los eventos.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// libs/utils/src/seedwork/infrastructure/domain-eventbus/services/event-emitter.eventbus.ts</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">EventEmitterEventbus</span> <span class="k">implements</span> <span class="nx">DomainEventBus</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">eventEmitter</span><span class="p">:</span> <span class="nx">EventEmitter2</span><span class="p">)</span> <span class="p">{}</span>
   
    <span class="k">async</span> <span class="nx">publish</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">eventEmitter</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Generamos los eventos de dominio dentro del módulo <code class="language-plaintext highlighter-rouge">shared</code> de <code class="language-plaintext highlighter-rouge">music-discovery</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/shared/domain-events/user-music-catalog/playlist-updated.event.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">PlaylistUpdatedEvent</span> <span class="kd">extends</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="nx">Playlist</span><span class="o">&gt;</span> <span class="p">{</span> 
    
    <span class="kd">constructor</span><span class="p">(</span><span class="na">playlist</span><span class="p">:</span> <span class="nx">Playlist</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">PlaylistUpdatedEvent</span><span class="p">.</span><span class="nx">NAME</span><span class="p">,</span> <span class="nx">playlist</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">readonly</span> <span class="nx">NAME</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">com.clonespotify.discovery.user-music-catalog.domain.playlist-updated</span><span class="dl">'</span><span class="p">;</span>
    
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>Utilizamos el patrón de spotifyclone.<em>FEATURE</em>.domain.<em>EVENT</em> para poder realizar patrones de filtrado sobre eventos en casos más complejos.</p></blockquote><p>Ahora nuestro caso de uso sería el siguiente.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/user-catalog/application/dto/update-playlists.dto.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UpdatePlaylistsDto</span> <span class="p">{</span>
    
    <span class="p">@</span><span class="nd">IsUUID</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="nx">userCatalogId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">({</span> <span class="na">each</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="nx">playlist</span><span class="p">:</span> <span class="nx">Playlist</span><span class="p">;</span>
    
<span class="p">}</span>
<span class="c1">// apps/music-discovery-ms/src/user-catalog/domain/model/playlist.model.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Playlist</span> <span class="kd">extends</span> <span class="nx">Model</span> <span class="p">{</span>
    
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">IsBoolean</span><span class="p">()</span>
    <span class="nx">isPublic</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">IsArray</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">({</span> <span class="na">each</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="p">@</span><span class="nd">Type</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">)</span>
    <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[];</span>

<span class="p">}</span>
<span class="c1">// apps/music-discovery-ms/src/user-catalog/application/user-catalog.use-cases.ts</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserCatalogUseCases</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">catalog</span><span class="p">:</span> <span class="nx">UserCatalogService</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">domainEventbus</span><span class="p">:</span> <span class="nx">DomainEventBus</span>
    <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">async</span> <span class="nx">updatePlaylists</span><span class="p">(</span><span class="nx">dto</span><span class="p">:</span> <span class="nx">UpdatePlaylistsDto</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="nx">playlistNotToUpdate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">playlists</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">playlists</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">dto</span><span class="p">.</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">catalog</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">dto</span><span class="p">.</span><span class="nx">userCatalogId</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">catalog</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">catalog</span><span class="p">.</span><span class="nx">playlists</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">...</span><span class="nx">playlistNotToUpdate</span><span class="p">(</span><span class="nx">catalog</span><span class="p">.</span><span class="nx">playlists</span><span class="p">),</span>
                    <span class="nx">dto</span><span class="p">.</span><span class="nx">playlist</span>
                <span class="p">]</span>
                <span class="k">return</span> <span class="nx">catalog</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="k">async</span> <span class="nx">catalog</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">catalog</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">catalog</span><span class="p">)</span>
                <span class="k">return</span> <span class="nx">catalog</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">catalog</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">domainEventbus</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="k">new</span> <span class="nx">PlaylistUpdatedEvent</span><span class="p">(</span><span class="nx">dto</span><span class="p">.</span><span class="nx">playlist</span><span class="p">));</span>
                <span class="k">return</span> <span class="nx">catalog</span>
            <span class="p">});</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Nuestro caso de uso es simple, solo recibimos un DTO con la información de la playlist a actualizar y enviamos el evento de dominio con <code class="language-plaintext highlighter-rouge">domainEventBus.publish()</code>.</p><p>Gracias a NestJS podremos escuchar este evento mediante anotaciones en cualquier servicio <code class="language-plaintext highlighter-rouge">@Injectable</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/playlist-catalog/infrastructure/domain-events/domain-event.listener.ts</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">DomainEventListener</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">playlist</span><span class="p">:</span> <span class="nx">PlaylistUseCases</span><span class="p">)</span> <span class="p">{}</span>

    <span class="p">@</span><span class="nd">OnEvent</span><span class="p">(</span><span class="dl">'</span><span class="s1">com.clonespotify.discovery.user-music-catalog.domain.playlist-updated</span><span class="dl">'</span><span class="p">)</span>
    <span class="k">async</span> <span class="nx">onPlaylistCreated</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">PlaylistUpdatedEvent</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">playlist</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">payload</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">isPublic</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">playlist</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">playlist</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Finalmente, recibimos la playlist mediante un evento y si esta es pública, se guardará en la base de datos en el módulo de <code class="language-plaintext highlighter-rouge">playlist-catalog</code>. De esta manera, hemos desacoplado 2 casos de uso totalmente distintos donde el modelo de playlist tiene un significado distinto dependiendo del contexto de dominio en que esté.</p><h2 id="casos-de-uso-eventos-de-integración"><span class="mr-2">Casos de Uso Eventos de integración:</span><a href="#casos-de-uso-eventos-de-integración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ya tenemos claro que los eventos de integración nos ayudan a comunicar distintas aplicaciones. Para ejemplificar este concepto, tomaremos el caso de uso de creación de usuario dentro del microservicio <code class="language-plaintext highlighter-rouge">accounts-ms</code>, el cual es dependiente de un caso de uso más grande llamado “Bienvenida de usuario”.</p><h3 id="caso-de-uso-bienvenida-de-usuario"><span class="mr-2">Caso de uso: Bienvenida de usuario</span><a href="#caso-de-uso-bienvenida-de-usuario" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Este caso de uso involucra 3 aplicaciones:</p><ul><li><code class="language-plaintext highlighter-rouge">account-ms</code>: encargado de la gestión de cuentas y usuarios.<li><code class="language-plaintext highlighter-rouge">mailing-ms</code>: encargado de enviar notificaciones de correo electrónico.<li><code class="language-plaintext highlighter-rouge">music-discovery-ms</code>: encargado de gestionar la música que le interesa o puede interesarle al usuario del clonespotify.</ul><p>Nuestro caso de uso es simple. Cuando se cree un usuario dentro de <code class="language-plaintext highlighter-rouge">accounts-ms</code>, necesitamos enviar un correo electrónico de bienvenida al usuario y a su vez necesitamos iniciar el catálogo inicial del usuario.</p><p>Este simple caso de uso involucra diferentes servicios, y como vemos a simple vista, cada uno de estos tiene responsabilidades totalmente distintas entre sí, pero gracias a los eventos de integración podemos lograr un proceso distribuido entre nuestros servicios con un bajo acoplamiento.</p><p>Lo primero será definir la arquitectura de eventos. Para lograrlo, nos ayudaremos del modelo <code class="language-plaintext highlighter-rouge">pub/sub</code>, el cual nos permitirá que múltiples clientes puedan suscribirse a algún evento y realizar sus operaciones.</p><p>Creemos un servicio de Redis en nuestro docker-compose.</p><div class="language-yml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1"># infrastructure/local/docker-compose.yaml</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3'</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="c1"># ... other services</span>
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:6.2-alpine</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">${REDIS_PORT}:6379</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">redis-server --save 20 1 --loglevel warning --requirepass ${REDIS_PASS}</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">microservices-architecture</span>
</pre></table></code></div></div><p>Instalamos la siguiente dependencia.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm i <span class="nt">--save</span> ioredis 
</pre></table></code></div></div><p>NestJS nos ofrece este modelo de <code class="language-plaintext highlighter-rouge">pub/sub</code> basado en un servidor Redis, el cual nos ayudará a aplicar y escuchar eventos a modo de fire and forget, lo que implica la desventaja de que si nadie escucha los mensajes emitidos, estos se perderán. Pero a modo de aprendizaje, esto nos bastará.</p><p>La implementación del <code class="language-plaintext highlighter-rouge">pub/sub</code> es simple, así que definimos la siguiente librería compartida en nuestro monorepo.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre> integration-events
├──  src
│   ├──  config
│   │   └──  constants.ts
│   ├──  events
│   │   ├──  accounts-ms
│   │   │   └──  user-created.event.ts
│   │   ├──  integration.event.ts
│   │   ├──  integration.eventbus.ts
│   │   └──  music-discovery-ms
│   │       └──  user-favorites-updated.event.ts
│   ├──  index.ts
│   ├──  integration-events.module.ts
│   ├──  services
│   │   └──  redis.eventbus.ts
│   └──  transporters
│       ├──  get-microservice-options.ts
│       └──  redis
│           └──  get-redis-options.ts
└──  tsconfig.lib.json
</pre></table></code></div></div><p>Definimos nuestro Eventbus.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre><span class="c1">// libs/integration-events/src/events/integration.eventbus.ts</span>
<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">IntegrationEventBus</span> <span class="p">{</span>

    <span class="kd">abstract</span> <span class="nx">publish</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">IntegrationEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">IntegrationEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>

<span class="p">}</span>
<span class="c1">// libs/integration-events/src/services/redis.eventbus.ts</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">RedisEventBus</span> <span class="kd">extends</span> <span class="nx">IntegrationEventBus</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">REDIS_PRODUCER_CLIENT</span><span class="p">)</span> <span class="k">private</span> <span class="nx">client</span><span class="p">:</span> <span class="nx">ClientProxy</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="nx">publish</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">IntegrationEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">IntegrationEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">event</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="c1">// libs/integration-events/src/integration-events.module.ts</span>
<span class="kd">const</span> <span class="nx">IntegrationEventbusProvider</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">provide</span><span class="p">:</span> <span class="nx">IntegrationEventBus</span><span class="p">,</span>
  <span class="na">useExisting</span><span class="p">:</span> <span class="nx">RedisEventBus</span>
<span class="p">}</span>

<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">RedisEventBus</span><span class="p">,</span>
    <span class="nx">IntegrationEventbusProvider</span>
  <span class="p">],</span>
  <span class="na">exports</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">IntegrationEventbusProvider</span>
  <span class="p">],</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">ClientsModule</span><span class="p">.</span><span class="nx">registerAsync</span><span class="p">([</span>
      <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">REDIS_PRODUCER_CLIENT</span><span class="p">,</span>
        <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
          <span class="nx">ConfigModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">()</span>
        <span class="p">],</span>
        <span class="na">useFactory</span><span class="p">:</span> <span class="p">(</span><span class="na">config</span><span class="p">:</span> <span class="nx">ConfigService</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">REDIS_HOST</span><span class="dl">'</span><span class="p">)</span>
          <span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">REDIS_PORT</span><span class="dl">'</span><span class="p">)</span>
          <span class="kd">const</span> <span class="nx">password</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">REDIS_PASS</span><span class="dl">'</span><span class="p">)</span> 
          <span class="k">return</span> <span class="p">{</span>
            <span class="na">transport</span><span class="p">:</span> <span class="nx">Transport</span><span class="p">.</span><span class="nx">REDIS</span><span class="p">,</span>
            <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
              <span class="nx">host</span><span class="p">,</span>
              <span class="nx">port</span><span class="p">,</span>
              <span class="nx">password</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="na">inject</span><span class="p">:</span> <span class="p">[</span>
          <span class="nx">ConfigService</span>
        <span class="p">]</span>
      <span class="p">},</span>
    <span class="p">]),</span>
  <span class="p">]</span>

<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">IntegrationEventsModule</span> <span class="p">{</span> <span class="p">}</span>
</pre></table></code></div></div><p>Definimos los eventos.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="c1">// libs/integration-events/src/events/integration.event.ts</span>
<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">IntegrationEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">readonly</span> <span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="na">occurredOn</span><span class="p">:</span> <span class="nb">Date</span><span class="p">;</span>
    
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="na">service</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
        <span class="k">public</span> <span class="k">readonly</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">T</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">occurredOn</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="c1">// libs/integration-events/src/events/accounts-ms/user-created.event.ts</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">Payload</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserCreatedEvent</span> <span class="kd">extends</span> <span class="nx">IntegrationEvent</span><span class="o">&lt;</span><span class="nx">Payload</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="na">payload</span><span class="p">:</span> <span class="nx">Payload</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="dl">'</span><span class="s1">accounts-ms</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">com.clonespotify.accounts.users.integration.user-updated</span><span class="dl">'</span><span class="p">,</span> <span class="nx">payload</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="enviar-eventos-de-integración"><span class="mr-2">Enviar eventos de integración</span><a href="#enviar-eventos-de-integración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ahora, dentro del módulo <code class="language-plaintext highlighter-rouge">users</code> de <code class="language-plaintext highlighter-rouge">accounts-ms</code>, importamos nuestra librería para instanciar el eventbus.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// apps/accounts-ms/src/users/users.module.ts</span>
<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
    <span class="c1">// ...more code</span>
    <span class="na">imports</span><span class="p">:[</span>
        <span class="nx">IntegrationEventsModule</span>
    <span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UsersModule</span> <span class="p">{}</span>
</pre></table></code></div></div><p>Y hacemos uso de <code class="language-plaintext highlighter-rouge">IntegrationEventBus</code> dentro de nuestro servicio UserService.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// apps/accounts-ms/src/users/service/user.service.ts</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserService</span> <span class="p">{</span>
  
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="p">@</span><span class="nd">InjectRepository</span><span class="p">(</span><span class="nx">User</span><span class="p">)</span> <span class="k">private</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">Repository</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">integrationEventBus</span><span class="p">:</span> <span class="nx">IntegrationEventBus</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="k">async</span> <span class="nx">create</span><span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="nx">UserModel</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">userCreated</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">integrationEventBus</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserCreatedEvent</span><span class="p">({</span>
      <span class="na">id</span><span class="p">:</span> <span class="nx">userCreated</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
      <span class="na">username</span><span class="p">:</span> <span class="nx">userCreated</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
      <span class="na">email</span><span class="p">:</span> <span class="nx">userCreated</span><span class="p">.</span><span class="nx">email</span>
    <span class="p">}));</span>
    <span class="k">return</span> <span class="nx">userCreated</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Con esto, los eventos serán enviados al servidor Redis y quienes estén a la escucha obtendrán los mensajes.</p><h3 id="escuchar-eventos-de-integración"><span class="mr-2">Escuchar eventos de integración</span><a href="#escuchar-eventos-de-integración" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ahora, para escuchar los eventos, instanciamos nuestro microservicio NestJS en las aplicaciones que necesiten los eventos de integración.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// libs/integration-events/src/transporters/get-microservice-options.ts</span>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">getMicroserviceOptions</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">transport</span><span class="p">:</span> <span class="nx">Transport</span><span class="p">.</span><span class="nx">REDIS</span><span class="p">,</span>
        <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">host</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_HOST</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">port</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_PORT</span> <span class="o">||</span> <span class="mi">6379</span><span class="p">,</span>
            <span class="na">password</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_PASS</span> <span class="o">||</span> <span class="kc">undefined</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Microservicio: <code class="language-plaintext highlighter-rouge">mailing-ms</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">// apps/mailing-ms/src/main.ts</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">bootstrap</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NestFactory</span><span class="p">.</span><span class="nx">createMicroservice</span><span class="p">(</span><span class="nx">MailingMsModule</span><span class="p">,</span> <span class="nx">getMicroserviceOptions</span><span class="p">());</span>
  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Microservicio: <code class="language-plaintext highlighter-rouge">music-discovery-ms</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/main.ts</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">bootstrap</span><span class="p">()</span> <span class="p">{</span>
  
  <span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NestFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">MusicDiscoveryMsModule</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">useGlobalPipes</span><span class="p">(</span><span class="k">new</span> <span class="nx">ValidationPipe</span><span class="p">())</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">connectMicroservice</span><span class="p">(</span><span class="nx">getMicroserviceOptions</span><span class="p">())</span>
<span class="c1">// other features...</span>
  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Music discovery microservice listen on port: </span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Main</span><span class="dl">"</span><span class="p">)</span>
  <span class="p">});</span>
  
<span class="p">}</span>
</pre></table></code></div></div><p>Finalmente, definimos los controladores con su message pattern y ejecutar la lógica de negocio que queramos.</p><p>Envío de email de bienvenida al crearse un usuario en el microservicio <code class="language-plaintext highlighter-rouge">mailing-ms</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">// apps/mailing-ms/src/integration-events/controllers/integration.controller.ts</span>
<span class="p">@</span><span class="nd">Controller</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">IntegrationController</span> <span class="p">{</span>
  
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">email</span><span class="p">:</span> <span class="nx">EmailService</span><span class="p">)</span> <span class="p">{}</span>

  <span class="p">@</span><span class="nd">MessagePattern</span><span class="p">(</span><span class="dl">'</span><span class="s1">com.clonespotify.accounts.users.integration.user-updated</span><span class="dl">'</span><span class="p">)</span>
  <span class="nx">onUserCreated</span><span class="p">(@</span><span class="nd">Payload</span><span class="p">()</span> <span class="nx">data</span><span class="p">:</span> <span class="nx">UserCreatedEvent</span><span class="p">,</span> <span class="p">@</span><span class="nd">Ctx</span><span class="p">()</span> <span class="nx">context</span><span class="p">:</span> <span class="nx">RmqContext</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Event received: </span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> from </span><span class="p">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">service</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="dl">'</span><span class="s1">QueueController</span><span class="dl">'</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">email</span><span class="p">.</span><span class="nx">notifyUserDetails</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Creación del catálogo inicial del usuario al crearse un nuevo usuario en el microservicio <code class="language-plaintext highlighter-rouge">music-discovery-ms</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/user-catalog/infrastructure/integration-events/integration.controller.ts</span>
<span class="p">@</span><span class="nd">Controller</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">IntegrationController</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">catalog</span><span class="p">:</span> <span class="nx">UserCatalogUseCases</span><span class="p">)</span> <span class="p">{}</span>

    <span class="p">@</span><span class="nd">MessagePattern</span><span class="p">(</span><span class="dl">'</span><span class="s1">com.clonespotify.accounts.users.integration.user-updated</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">onUserCreated</span><span class="p">(@</span><span class="nd">Payload</span><span class="p">()</span> <span class="nx">event</span><span class="p">:</span> <span class="nx">UserCreatedEvent</span><span class="p">,</span> <span class="p">@</span><span class="nd">Ctx</span><span class="p">()</span> <span class="nx">context</span><span class="p">:</span> <span class="nx">RedisContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Event received: </span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="s2"> from </span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">service</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="dl">'</span><span class="s1">IntegrationController</span><span class="dl">'</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">catalog</span><span class="p">.</span><span class="nx">createMusicCatalog</span><span class="p">({</span>
            <span class="na">id</span><span class="p">:</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">generateUUID</span><span class="p">(),</span>
            <span class="na">user</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">id</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                <span class="na">username</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">username</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Finalmente, para ver el ejemplo funcionando, ejecuta lo siguiente.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>npm run start:infra
npm run start:accounts
npm run start:mailing
npm run start:music-discovery
</pre></table></code></div></div><p>Y envía un curl a <code class="language-plaintext highlighter-rouge">accounts-ms</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>curl <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-d</span> <span class="s1">'{
  "id": "12345678-1234-1234-1234-123456789abc",
  "username": "john_doe",
  "password": "password123",
  "email": "john.doe@example.com"
}'</span> http://localhost:3013/users
</pre></table></code></div></div><p>Finalmente, verás los logs de la aplicación.</p><p><img data-src="/assets/img/examples/domain-event-vs-integration-event.webp" alt="example" data-proofer-ignore></p><h2 id="conclusión"><span class="mr-2">Conclusión</span><a href="#conclusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Exploramos los eventos de dominio y de integración con un enfoque práctico y fácil de entender. Los eventos de integración nos ayudan a crear sistemas totalmente desacoplados entre sí, y los eventos de dominio nos ayudan a modelar de mejor manera la lógica de negocio, creando un código totalmente desacoplado y con la capacidad de ser mantenible en el tiempo.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/microservices-architecture-nestjs/">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/img/memes/meme2.webp" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/arquitectura/'>Arquitectura</a>, <a href='//categories/software-ddd-events/'>Software,DDD,Events</a>, <a href='//categories/architecture-backend/'>architecture,Backend</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/arquitectura/" class="post-tag no-text-decoration" >arquitectura</a> <a href="//tags/software-ddd-events/" class="post-tag no-text-decoration" >software,ddd,events</a> <a href="//tags/architecture-backend/" class="post-tag no-text-decoration" >architecture,backend</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Arquitecturas+EDA+Eventos+de+dominio+vs+eventos+de+integraci%C3%B3n+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Farquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Arquitecturas+EDA+Eventos+de+dominio+vs+eventos+de+integraci%C3%B3n+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Farquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Farquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion%2F&text=Arquitecturas+EDA+Eventos+de+dominio+vs+eventos+de+integraci%C3%B3n+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Farquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/5-Arquitecturas-de-software-para-tigres-del-codigo/"><div class="card-body"> <em class="small" data-ts="1662977400" data-df="YYYY-MM-DD" > 2022-09-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>5 Arquitecturas de software para tigres del código</h3><div class="text-muted small"><p> 5 arquitecturas de software para proyectos serios Cuando iniciamos a crear nuestros proyectos lo primero que nos enseñaron fue el patrón MVC o la arquitectura por capas con el tiempo Todos los pro...</p></div></div></a></div><div class="card"> <a href="/posts/simplificando-el-testing-unitario-con-arquitectura-hexagonal/"><div class="card-body"> <em class="small" data-ts="1705986000" data-df="YYYY-MM-DD" > 2024-01-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Simplificando el testing unitario con arquitectura hexagonal</h3><div class="text-muted small"><p> El testing con arquitectura hexagonal nos provee una manera limpia de crear pruebas unitarias en nuestro código sin acoplarnos a las librerías de testing o cualquier otra tecnología no relacionad...</p></div></div></a></div><div class="card"> <a href="/posts/sagas-i-transacciones-distribuidas-con-patrones-saga/"><div class="card-body"> <em class="small" data-ts="1710133200" data-df="YYYY-MM-DD" > 2024-03-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Sagas I - Transacciones Distribuidas Con Patrones Saga</h3><div class="text-muted small"><p> Transacciones centralizadas vs distribuidas Las aplicaciones monolíticas tienen la ventaja de poder crear procesos transaccionales de forma sencilla. Las transacciones nos ayudan a mantener la c...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/simplificando-el-testing-unitario-con-arquitectura-hexagonal/" class="btn btn-outline-primary" prompt="Anterior"><p>Simplificando el testing unitario con arquitectura hexagonal</p></a> <a href="//posts/sagas-i-transacciones-distribuidas-con-patrones-saga/" class="btn btn-outline-primary" prompt="Nuevo"><p>Sagas I - Transacciones Distribuidas Con Patrones Saga</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
