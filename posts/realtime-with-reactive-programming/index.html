<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Aplicaciones en tiempo real con programación reactiva" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/realtime-with-reactive-programming/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/realtime-with-reactive-programming/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-02-23T12:32:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Aplicaciones en tiempo real con programación reactiva" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2023-02-24T11:26:49-03:00","datePublished":"2023-02-23T12:32:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Aplicaciones en tiempo real con programación reactiva","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/realtime-with-reactive-programming/"},"url":"https://nullpointer-excelsior.github.io/posts/realtime-with-reactive-programming/"}</script><title>Aplicaciones en tiempo real con programación reactiva | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Aplicaciones en tiempo real con programación reactiva</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Aplicaciones en tiempo real con programación reactiva</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1677166320" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-02-23 </em> </span> <span> Actualizado <em class="" data-ts="1677248809" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-02-24 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2231 palabras"> <em>12 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="https://i.ibb.co/nf88d7N/Screenshot-2023-02-23-at-16-06-51.png" alt="image" data-proofer-ignore></p><p>Las aplicaciones en tiempo real se definen como aquellas que ofrecen una respuesta en tiempo real a eventos del mundo real. Piensa en aplicaciones de chat en línea, aplicaciones de juegos, aplicaciones de seguimiento de eventos en vivo, y aplicaciones de trading en línea. En estas aplicaciones, la información debe ser entregada y procesada en tiempo real para brindar una experiencia de usuario fluida y efectiva.</p><p>Este tipo de aplicaciones pueden ser enfrentadas con programación reactiva que más allá de ser una técnica es un paradigma que nos ofrece la posibilidad de crear aplicaciones complejas y altamente escalables.</p><h2 id="aplicaciones-en-tiempo-real-con-programación-reactiva"><span class="mr-2">Aplicaciones en tiempo real con programación reactiva</span><a href="#aplicaciones-en-tiempo-real-con-programación-reactiva" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>La programación reactiva es una técnica que se utiliza para desarrollar aplicaciones en tiempo real y se basa en el uso de flujos de datos asincrónicos y eventos. En lugar de ejecutar operaciones de forma secuencial, la programación reactiva permite que las operaciones se realicen en paralelo, lo que permite un procesamiento más rápido y una mejor escalabilidad.</p><p>No profundizaré más allá de explicar las bases, pero en forma resumida la programación reactiva proporciona las siguientes características:</p><ul><li><code class="language-plaintext highlighter-rouge">Responsivos:</code> Tiempos de respuestas rápidos y consistentes.<li><code class="language-plaintext highlighter-rouge">Resilientes:</code> Capaces de responder adecuadamente cuando existen errores o problemas.<li><code class="language-plaintext highlighter-rouge">Elásticos:</code> Adaptación a cargas de trabajos variables<li><code class="language-plaintext highlighter-rouge">Orientado a mensajes:</code> Cada flujo o componente se comunica de manera asíncrona mediante mensajes y subscripciones a estos.</ul><p>La capacidad de trabajar con flujos de datos asíncronos nos proporciona una manera efectiva de crear aplicaciones en tiempo real, donde necesitamos priorizar el tratamiento de datos de manera eficiente. Una fuente ilimitada de datos trae los siguientes desafíos:</p><ul><li>Uso de memoria.<li>Escucha de eventos específicos.<li>Procesamiento de datos<li>Asincronismo</ul><p>Para aterrizar esto utilizaremos la librería RxJs y trabajaremos sobre una aplicación que simulará el registro de un ranking de puntos de multiples jugadores. Donde esta aplicación recibirá los puntajes de los jugadores conseguidos en una partida.</p><p>Un ejemplo de petición es el siguiente:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"game"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ghost-of-kiev"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"points"</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w">
    </span><span class="nl">"player"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red-panda"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"playingTime"</span><span class="p">:</span><span class="w"> </span><span class="mi">120</span><span class="p">,</span><span class="w">
    </span><span class="nl">"submittedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2023-01-27"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Entonces con base a esto nuestra aplicación hará lo siguiente:</p><ul><li>Registro de los puntajes<li>Registro de los jugadores nuevos que transmitan puntos<li>Registro de ranking de los mejores 10 jugadores<li>Notificación en tiempo real de la actualización del ranking<li>Notification en tiempo real del jugador que se corone como posición n.°1</ul><h2 id="arquitectura-de-una-aplicación-en-tiempo-real"><span class="mr-2">Arquitectura de una aplicación en tiempo real</span><a href="#arquitectura-de-una-aplicación-en-tiempo-real" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>La arquitectura interna de la aplicación es la siguiente:</p><p><img data-src="https://i.ibb.co/55xtJBp/Screenshot-2023-02-23-at-15-20-56.png" alt="schema" data-proofer-ignore></p><p>Cada operación que involucra código reactivo tiene su responsabilidad definida y puede emitir eventos donde otros componentes podrán escuchar y realizar tareas de forma independiente. Implementaremos una API con GraphQL y tendremos una base de datos MongoDB</p><h2 id="ventajas-de-la-programación-reactiva"><span class="mr-2">Ventajas de la programación Reactiva</span><a href="#ventajas-de-la-programación-reactiva" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Si intentamos desarrollar nuestros casos de uso totalmente con programación imperativa, tendremos muchos desafíos en temas de rendimiento y lógicas complejas de mantener que no serán fácil de adaptar a nuevos requerimientos. Principalmente te daré la idea de que si hablamos de un sistema en tiempo real y queremos trabajar con los datos lo primero que haríamos es adaptar los datos a listas y empezar a desarrollar nuestros casos de uso, pero esa base nos proporciona complejidad en algoritmos y posible código propenso a convertirse en un plato de tallarines. En cambio si consideramos nuestros datos como un flujo podremos realizar operaciones adecuadas ya las implementaciones del paradigma reactivo nos proporciona las siguientes herramientas:</p><ul><li>Poder de escuchar flujos de datos y realizar operaciones<li>Encadenamiento de operaciones a los flujos<li>Operaciones asíncronas<li>Reutilización de flujos u operadores</ul><h2 id="implementando-una-api-con-graphql"><span class="mr-2">Implementando una API con GraphQL</span><a href="#implementando-una-api-con-graphql" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Utilizaremos GraphQL para exponer nuestro modelo de datos y las operaciones que podremos realizar sobre este.</p><p>GraphQL es un lenguaje de consulta y una tecnología de servidor que permite a los clientes solicitar y recibir solo los datos que necesitan, en una sola solicitud, en lugar de múltiples solicitudes como ocurre en REST. Esto hace que la comunicación entre el cliente y el servidor sea más eficiente y flexible, lo que permite un desarrollo de aplicaciones más rápido y escalable. GraphQL nos permite realizar las siguientes operaciones:</p><ul><li><code class="language-plaintext highlighter-rouge">Queries:</code> Permiten solicitar datos al servidor. Podemos definir solo los datos que nos interesan.<li><code class="language-plaintext highlighter-rouge">Mutations:</code> Son operaciones que permiten modificar datos en el servidor.<li><code class="language-plaintext highlighter-rouge">Subscriptions:</code> Permiten establecer una conexión en tiempo real con el servidor, donde podemos recibir actualizaciones automáticas cada vez que ocurra un cambio en los datos que se han suscrito</ul><p>Estas operaciones y el modelo de datos se definen en un esquema de GraphQL. En este caso definiremos las siguientes operaciones:</p><ul><li>Enviar puntaje asociado a un jugador<li>Obtener Jugadores<li>Subscribirse a Ranking top 10<li>Suscribirse a nuevo campeón</ul><p>Y nuestro esquema GraphQL es el siguiente:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre>type Response {
    message: String!
}

type Score {
    id: String!
    game: String!
    points: Int!
    player: String!
    playingTime: Int!
    submitedAt: Date!
}

type Player {
    name: String!
    points: Int!
}

type Ranking {
    place: Int!
    player: String!
    points: Int!
}

type Champion {
    player: String!
    points: Int!
    datetime: Date!
}

"""Date custom scalar type"""
scalar Date

type Query {
    getScores: [Score!]!
    getPlayers: [Player!]!
}

type Mutation {
    createScore(score: ScoreInput!): Response!
}

input ScoreInput {
    game: String!
    points: Int!
    player: String!
    playingTime: Int!
    submitedAt: Date!
}

type Subscription {
    rankingUpdated: [Ranking!]!
    currentChampion: Champion!
}
</pre></table></code></div></div><p>Internamente debemos implementar como resolver las operaciones mediantes funciones llamadas resolvers, pero este no es el foco del artículo asi que con las bases de GraphQL explicadas vamos con los casos de uso sobre una aplicación en tiempo real</p><h2 id="desarrollo-de-los-casos-de-uso"><span class="mr-2">Desarrollo de los casos de uso</span><a href="#desarrollo-de-los-casos-de-uso" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>La implementación tecnológica la haremos sobre una aplicación Nestjs con MongoDB e implementaremos un servidor Graphql. Ciertas partes de la aplicación no se explicarán a detalle, ya que tenemos muchos componentes tanto en la parte de GraphQL y MongoDD. Nos centraremos en los casos de uso que implementan lógica reactiva.</p><h3 id="registro-de-los-puntajes"><span class="mr-2">Registro de los puntajes</span><a href="#registro-de-los-puntajes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>El caso de uso <code class="language-plaintext highlighter-rouge">createScore</code> lo implementa la clase <code class="language-plaintext highlighter-rouge">ScoreService</code> con el método <code class="language-plaintext highlighter-rouge">save()</code>el cual recibe un objeto DTO y realiza las operaciones con código reactivo.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">ScoreService</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">ScoreMongoRepository</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">source</span><span class="p">:</span> <span class="nx">ScoreSubject</span>
    <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nx">save</span><span class="p">(</span><span class="nx">dto</span><span class="p">:</span> <span class="nx">SaveScoreDto</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">Score</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">of</span><span class="p">(</span><span class="nx">dto</span><span class="p">)</span> <span class="c1">// nuestro dto lo transformamos a un observable</span>
            <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span> <span class="c1">// hacemos uso del operador pipe para poder encadenar operadores</span>
                <span class="nx">map</span><span class="p">(</span><span class="nx">dto</span> <span class="o">=&gt;</span> <span class="nx">Score</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">dto</span><span class="p">)),</span> <span class="c1">// transfromamos nuetsro Observable&lt;SaveScoreDto&gt; a Observable&lt;Score&gt;</span>
                <span class="nx">switchMap</span><span class="p">(</span><span class="nx">score</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">score</span><span class="p">)),</span> <span class="c1">// switchMap nos permite terminar neustra subscripcion de Observable&lt;Score&gt; y realizar una operacion de guardado en nuesttra base de datos</span>
                <span class="nx">tap</span><span class="p">(</span><span class="nx">score</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">score</span><span class="p">)),</span> <span class="c1">// tap se ejecutara cada vez que un valor sea emitido en este caso emitimos que un nuevo Score se ha creado</span>
            <span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">findAll</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">Score</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">stream</span><span class="p">().</span><span class="nx">pipe</span><span class="p">(</span>
            <span class="nx">toArray</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">onSaved</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">Score</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">onEmited</span><span class="p">()</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>El objeto <code class="language-plaintext highlighter-rouge">source</code> nos permite notificar eventos a quienes se suscriban al método <code class="language-plaintext highlighter-rouge">onSaved()</code> el funcionamiento interno es el siguiente:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Subject</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">rxjs</span><span class="dl">"</span><span class="p">;</span>
<span class="c1">// clase base</span>
<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">SubjectBase</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="na">subject</span><span class="p">:</span> <span class="nx">Subject</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">()</span>

    <span class="nx">emit</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">onEmited</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">asObservable</span><span class="p">()</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="nx">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">ScoreSubject</span> <span class="kd">extends</span> <span class="nx">SubjectBase</span><span class="o">&lt;</span><span class="nx">Score</span><span class="o">&gt;</span> <span class="p">{</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Simplemente heredamos de SubjectBase y hacemos uso de sus métodos <code class="language-plaintext highlighter-rouge">emit()</code>para enviar un mensaje y <code class="language-plaintext highlighter-rouge">onEmited()</code> para poder escuchar nuestros mensajes La clase Subject es propio de <code class="language-plaintext highlighter-rouge">rxjs</code> y su objetivo es poder emitir valores y obtenerlos existen otras variantes que puedes consultar en su documentación para otros escenarios.</p><h3 id="registro-de-los-jugadores-nuevos-que-transmitan-puntos"><span class="mr-2">Registro de los jugadores nuevos que transmitan puntos</span><a href="#registro-de-los-jugadores-nuevos-que-transmitan-puntos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>La clase <code class="language-plaintext highlighter-rouge">ScoreService</code> registra los puntos y asu vez podemos utilizar su método <code class="language-plaintext highlighter-rouge">onSaved()</code> para realizar operaciones sobre estos eventos de la siguiente manera:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SavePlayerService</span> <span class="k">implements</span> <span class="nx">OnModuleInit</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">player</span><span class="p">:</span> <span class="nx">PlayerService</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">score</span><span class="p">:</span> <span class="nx">ScoreService</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="nx">onModuleInit</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">score</span><span class="p">.</span><span class="nx">onSaved</span><span class="p">()</span> <span class="c1">// nos suscribimos a los eventos de Score Saved</span>
            <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
                <span class="nx">switchMap</span><span class="p">(</span><span class="nx">score</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// nos suscribimos a player.findByName()</span>
                    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">player</span>
                        <span class="p">.</span><span class="nx">findByName</span><span class="p">(</span><span class="nx">score</span><span class="p">.</span><span class="nx">player</span><span class="p">)</span> <span class="c1">// buscamos el jugador asociado al puntaje</span>
                        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
                            <span class="nx">defaultIfEmpty</span><span class="p">(</span><span class="nx">Player</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="nx">score</span><span class="p">.</span><span class="nx">player</span><span class="p">,</span> <span class="na">points</span><span class="p">:</span> <span class="mi">0</span> <span class="p">})),</span> <span class="c1">// si no existe creamos un jugador por defecto con 0 puntos</span>
                            <span class="nx">tap</span><span class="p">(</span><span class="nx">player</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// con tap por cada jugador realizamoa la operación de suma de puntos</span>
                                <span class="nx">player</span><span class="p">.</span><span class="nx">addPoints</span><span class="p">(</span><span class="nx">score</span><span class="p">.</span><span class="nx">points</span><span class="p">)</span>
                            <span class="p">})</span>
                        <span class="p">)</span>
                <span class="p">}),</span>
                <span class="nx">switchMap</span><span class="p">(</span><span class="nx">player</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">saveOrUpdate</span><span class="p">(</span><span class="nx">player</span><span class="p">)),</span> <span class="c1">// del observable de Player nos cambiamos al de Guardar o actualizar jugador</span>
            <span class="p">)</span>
            <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
                <span class="na">next</span><span class="p">:</span> <span class="nx">player</span> <span class="o">=&gt;</span> <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">player</span><span class="p">.</span><span class="nx">toString</span><span class="p">()}</span><span class="s2"> Saved`</span><span class="p">),</span> <span class="c1">// log informativo</span>
                <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">Logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="c1">//cualquier error lo notificamos</span>
            <span class="p">})</span>


    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>SavePlayerService implementa OnModuleInit lo que nos permite ejecutar código cuando inicia el servidor.</p></blockquote><h3 id="registro-de-ranking"><span class="mr-2">Registro de ranking</span><a href="#registro-de-ranking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>El registro del ranking es de una manera similar en este caso hacemos uso de <code class="language-plaintext highlighter-rouge">PlayerService.onSaved()</code> para obtener la actualización de los jugadores y realizar los cálculos para el ranking de jugadores</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SaveRankingService</span> <span class="k">implements</span> <span class="nx">OnModuleInit</span> <span class="p">{</span>

    <span class="nx">ranking$</span><span class="p">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">Ranking</span><span class="p">[]</span><span class="o">&gt;</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">player</span><span class="p">:</span> <span class="nx">PlayerService</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">ranking</span><span class="p">:</span> <span class="nx">RankingService</span>
    <span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="nx">onModuleInit</span><span class="p">()</span> <span class="p">{</span>

        <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">save-rankings STARTED</span><span class="dl">'</span><span class="p">)</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">ranking$</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">onSaved</span><span class="p">()</span> <span class="c1">// suscripcion a los jugadroes</span>
            <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
                <span class="nx">switchMap</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">calculateRanking</span><span class="p">()),</span><span class="c1">// calculamos el ranking</span>
                <span class="nx">switchMap</span><span class="p">(</span><span class="nx">rankings</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">ranking</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">rankings</span><span class="p">))</span> <span class="c1">// guardamos el ranking</span>
            <span class="p">)</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">ranking$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">()</span> <span class="c1">// nos suscribimos para poder realizar los cálculos</span>

    <span class="p">}</span>


    <span class="nx">calculateRanking</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="nx">createRanking</span> <span class="o">=</span> <span class="p">(</span><span class="nx">players</span><span class="p">:</span> <span class="nx">Player</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[...</span><span class="nx">players</span><span class="p">]</span>
                <span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="na">playerA</span><span class="p">:</span> <span class="nx">Player</span><span class="p">,</span> <span class="na">playerB</span><span class="p">:</span> <span class="nx">Player</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">playerB</span><span class="p">.</span><span class="nx">points</span> <span class="o">-</span> <span class="nx">playerA</span><span class="p">.</span><span class="nx">points</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">player</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">Ranking</span><span class="p">({</span>
                    <span class="na">place</span><span class="p">:</span> <span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="na">player</span><span class="p">:</span> <span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                    <span class="na">points</span><span class="p">:</span> <span class="nx">player</span><span class="p">.</span><span class="nx">points</span>
                <span class="p">}))</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">findAll</span><span class="p">()</span> <span class="c1">// obtenemos todos los jugadores</span>
            <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
                <span class="nx">map</span><span class="p">(</span><span class="nx">players</span> <span class="o">=&gt;</span> <span class="nx">createRanking</span><span class="p">(</span><span class="nx">players</span><span class="p">))</span> <span class="c1">// creamos el ranking</span>
            <span class="p">)</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Ahora para crear las notificaciones en tiempo real haremos uso del siguiente componente creado para nuestro server GraphQL</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">PubSubService</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">GRAPHQL_PUB_SUB</span><span class="p">)</span> <span class="k">private</span> <span class="k">readonly</span> <span class="nx">pubsub</span><span class="p">:</span> <span class="nx">PubSub</span><span class="p">)</span> <span class="p">{}</span>

    <span class="nx">publishRankingUpdated</span><span class="p">(</span><span class="nx">rankings</span><span class="p">:</span> <span class="nx">Ranking</span><span class="p">[])</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pubsub</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="dl">'</span><span class="s1">rankingUpdated</span><span class="dl">'</span><span class="p">,</span> <span class="nx">rankings</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">subscribeToRankingUpdated</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pubsub</span><span class="p">.</span><span class="nx">asyncIterator</span><span class="p">(</span><span class="dl">'</span><span class="s1">rankingUpdated</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">publishCurrentChampion</span><span class="p">(</span><span class="nx">champion</span><span class="p">:</span> <span class="nx">Champion</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pubsub</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="dl">'</span><span class="s1">currentChampion</span><span class="dl">'</span><span class="p">,</span> <span class="nx">champion</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">subscribeToCurrentChampion</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">pubsub</span><span class="p">.</span><span class="nx">asyncIterator</span><span class="p">(</span><span class="dl">'</span><span class="s1">currentChampion</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Utilizamos la clase PubSub propia de la librería de Graphql y creamos los métodos de suscripción y los métodos de notificación de mensajes.</p><h3 id="notificación-de-la-actualización-del-ranking"><span class="mr-2">Notificación de la actualización del ranking</span><a href="#notificación-de-la-actualización-del-ranking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Para notificar el ranking en tiempo real implementamos el siguiente código:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">RankingUpdatedService</span> <span class="k">implements</span> <span class="nx">OnModuleInit</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">ranking</span><span class="p">:</span> <span class="nx">RankingService</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">pubsub</span><span class="p">:</span> <span class="nx">PubSubService</span>
    <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nx">onModuleInit</span><span class="p">()</span> <span class="p">{</span>

        <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ranking-updated STARTED</span><span class="dl">'</span><span class="p">)</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">ranking</span>
            <span class="p">.</span><span class="nx">onSaved</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">ranking</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">pubsub</span><span class="p">.</span><span class="nx">publishRankingUpdated</span><span class="p">(</span><span class="nx">ranking</span><span class="p">))</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Solo nos suscribimos al <code class="language-plaintext highlighter-rouge">RankingService.onSaved()</code> y <code class="language-plaintext highlighter-rouge">pubsub.publishRankingUpdated(ranking)</code> hará el resto</p><h3 id="notificación-del-jugador-que-se-corone-como-posición-n1"><span class="mr-2">Notificación del jugador que se corone como posición n.°1</span><a href="#notificación-del-jugador-que-se-corone-como-posición-n1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Para saber quien se corona como número 1 del juego empleamos el siguiente código:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">ChampionUpdatedService</span> <span class="k">implements</span> <span class="nx">OnModuleInit</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">ranking</span><span class="p">:</span> <span class="nx">RankingService</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">pubsub</span><span class="p">:</span> <span class="nx">PubSubService</span>
    <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nx">onModuleInit</span><span class="p">()</span> <span class="p">{</span>

        <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">champion-updated STARTED</span><span class="dl">'</span><span class="p">)</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">ranking</span><span class="p">.</span><span class="nx">onSaved</span><span class="p">().</span><span class="nx">pipe</span><span class="p">(</span>
            <span class="nx">mergeMap</span><span class="p">(</span><span class="nx">rankings</span> <span class="o">=&gt;</span> <span class="nx">rankings</span><span class="p">),</span> <span class="c1">// aplanamos el ranking es decir Observable&lt;Ranking[]&gt; -&gt; Observable&lt;Ranking&gt;</span>
            <span class="nx">filter</span><span class="p">(</span><span class="nx">ranking</span> <span class="o">=&gt;</span> <span class="nx">ranking</span><span class="p">.</span><span class="nx">place</span> <span class="o">===</span> <span class="mi">1</span><span class="p">),</span> <span class="c1">// filtramos el número 1</span>
            <span class="nx">distinctUntilKeyChanged</span><span class="p">(</span><span class="dl">'</span><span class="s1">player</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// hacemos un distinct por la propiedad player y ademas se emitirá el valor cuando un nuevo jugador sea campeón</span>
            <span class="nx">map</span><span class="p">(</span><span class="nx">ranking</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="na">player</span><span class="p">:</span> <span class="nx">ranking</span><span class="p">.</span><span class="nx">player</span><span class="p">,</span> <span class="na">points</span><span class="p">:</span> <span class="nx">ranking</span><span class="p">.</span><span class="nx">points</span><span class="p">,</span> <span class="na">datetime</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="p">})),</span> <span class="c1">// mapeamos a un dto</span>
            <span class="nx">tap</span><span class="p">(</span><span class="nx">champion</span> <span class="o">=&gt;</span> <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Current Champion </span><span class="dl">'</span><span class="p">,</span><span class="nx">champion</span><span class="p">))</span> <span class="c1">// imprimimos el campeon</span>
        <span class="p">)</span>
            <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">champion</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">pubsub</span><span class="p">.</span><span class="nx">publishCurrentChampion</span><span class="p">(</span><span class="nx">champion</span><span class="p">))</span> <span class="c1">// suscripcion y notificacion del campeón</span>
    <span class="p">}</span>


<span class="p">}</span>
</pre></table></code></div></div><h2 id="ejecución-de-pruebas"><span class="mr-2">Ejecución de pruebas</span><a href="#ejecución-de-pruebas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Para levantar la aplicación y realizar pruebas estos son los comandos:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="c"># run mongo db</span>
<span class="nb">export </span><span class="nv">database_name</span><span class="o">=</span><span class="s2">"ranking-db"</span>
docker run <span class="nt">--name</span> <span class="s2">"</span><span class="nv">$database_name</span><span class="s2">"</span> <span class="nt">-e</span> <span class="nv">MONGO_INITDB_DATABASE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$database_name</span><span class="s2">"</span> <span class="nt">-e</span> <span class="nv">MONGO_INITDB_ROOT_USERNAME</span><span class="o">=</span><span class="s2">"</span><span class="nv">$database_name</span><span class="s2">"</span> <span class="se">\</span>
 <span class="nt">-e</span> <span class="nv">MONGO_INITDB_ROOT_PASSWORD</span><span class="o">=</span><span class="s2">"</span><span class="nv">$database_name</span><span class="s2">"</span> <span class="nt">-p</span> 27017:27017 <span class="nt">-d</span> mongo
<span class="c"># show mongodb container</span>
docker ps

<span class="c"># run server</span>
npm run start:dev

<span class="c"># install requests library</span>
pip3 <span class="nb">install </span>requests

<span class="c"># run app client</span>
python3 score_client.py
</pre></table></code></div></div><p>Ahora ve a http://localhost:3000/graphql y verás el Playground de GraphQL donde puedes realizar las consultas que te salga de los cojones:</p><p>Puedes crear un score:</p><p><img data-src="https://i.ibb.co/m0mjSzV/Screenshot-2023-02-23-at-13-01-12.png" alt="score" data-proofer-ignore></p><p>Consultar los puntos:</p><p><img data-src="https://i.ibb.co/xDq269y/Screenshot-2023-02-23-at-13-10-00.png" alt="get-score" data-proofer-ignore></p><p>Consultar el ranking en tiempo real:</p><p><img data-src="https://i.ibb.co/JBXSgdG/Screenshot-2023-02-23-at-13-02-56.png" alt="rank" data-proofer-ignore></p><p>Consultar el campeón de los jugadores:</p><p><img data-src="https://i.ibb.co/GF1g8xh/Screenshot-2023-02-23-at-13-06-58.png" alt="champ" data-proofer-ignore></p><p>Puedes realizar pruebas y crear nuevos casos con programación reactiva este proyecto es una prueba de concepto con la que puedes realizar diversas pruebas.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/realtime-reactive-app">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h2 id="conclusión"><span class="mr-2">Conclusión</span><a href="#conclusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nos acercamos al mundo reactivo con un caso de usos de datos en realtime si bien este caso es básico y en el mundo real la solución también implicaría componentes de infraestructura podemos entender de mejor manera este paradigma en el lado del backend. Finalmente el meme de cortesía</p><p><img data-src="https://i.ibb.co/k1vbddX/Screenshot-2023-02-23-at-16-39-54.png" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/programacion/'>Programacion</a>, <a href='//categories/typescript/'>Typescript</a>, <a href='//categories/graphql/'>GraphQL</a>, <a href='//categories/arquitectura-de-software/'>Arquitectura de software</a>, <a href='//categories/nestjs/'>Nestjs</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/nestjs/" class="post-tag no-text-decoration" >NestJs</a> <a href="//tags/reactive/" class="post-tag no-text-decoration" >Reactive</a> <a href="//tags/typescript/" class="post-tag no-text-decoration" >Typescript</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Aplicaciones+en+tiempo+real+con+programaci%C3%B3n+reactiva+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Frealtime-with-reactive-programming%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Aplicaciones+en+tiempo+real+con+programaci%C3%B3n+reactiva+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Frealtime-with-reactive-programming%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Frealtime-with-reactive-programming%2F&text=Aplicaciones+en+tiempo+real+con+programaci%C3%B3n+reactiva+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Frealtime-with-reactive-programming%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/disenando-microservicios-con-ddd/"><div class="card-body"> <em class="small" data-ts="1673364720" data-df="YYYY-MM-DD" > 2023-01-10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Diseñando Microservicios con Domain Driven Design y NestJS</h3><div class="text-muted small"><p> Domain Driven Design o DDD para los amigos es un enfoque de diseño donde las reglas y modelo de negocio son el corazón de la aplicación. Nos olvidamos de diseños técnicos y nos centramos más en c...</p></div></div></a></div><div class="card"> <a href="/posts/robust-error-handling-beyond-try-catch/"><div class="card-body"> <em class="small" data-ts="1678721520" data-df="YYYY-MM-DD" > 2023-03-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Robusto control de errores más allá del Try Catch</h3><div class="text-muted small"><p> El control de errores en aplicaciones tradicionalmente los manejamos con trycatch si bien esto nos proporciona una manera efectiva y simple de controlar errores y definir lógicas un poco más elab...</p></div></div></a></div><div class="card"> <a href="/posts/state-machine-design-pattern/"><div class="card-body"> <em class="small" data-ts="1686151920" data-df="YYYY-MM-DD" > 2023-06-07 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Conociendo el patrón de diseño state machine.</h3><div class="text-muted small"><p> Sí correcto este es otro post de patrones de diseño. lo distinto es que es uno de los que nadie habla pero se usa muy a menudo y no nos damos ni cuenta. Hoy voy a hablarles del patrón de diseño c...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/high-performance-reactive-applications-with-spring-webflux/" class="btn btn-outline-primary" prompt="Anterior"><p>Aplicaciones Reactivas de Alto Rendimiento con Spring WebFlux</p></a> <a href="//posts/robust-error-handling-beyond-try-catch/" class="btn btn-outline-primary" prompt="Nuevo"><p>Robusto control de errores más allá del Try Catch</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
