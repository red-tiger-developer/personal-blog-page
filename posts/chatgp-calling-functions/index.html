<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="ChatGPT Calling Functions ahora la AI puede llamar funciones de código" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/chatgp-calling-functions/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/chatgp-calling-functions/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-06-19T11:32:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ChatGPT Calling Functions ahora la AI puede llamar funciones de código" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2023-06-19T11:32:00-04:00","datePublished":"2023-06-19T11:32:00-04:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"ChatGPT Calling Functions ahora la AI puede llamar funciones de código","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/chatgp-calling-functions/"},"url":"https://nullpointer-excelsior.github.io/posts/chatgp-calling-functions/"}</script><title>ChatGPT Calling Functions ahora la AI puede llamar funciones de código | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>ChatGPT Calling Functions ahora la AI puede llamar funciones de código</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>ChatGPT Calling Functions ahora la AI puede llamar funciones de código</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1687188720" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-06-19 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2243 palabras"> <em>12 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="https://i.ibb.co/BgZPvw0/Screenshot-2023-06-19-at-20-19-46.png" alt="img" data-proofer-ignore></p><p>Con Chatgpt dimos un salto enorme en el desarrollo de aplicaciones basadas en AI. Anteriormente, necesitábamos recolectar información y procesarla para entrenar nuestros modelos, pero ahora podemos incluso utilizar instrucciones simples para crear asistentes o realizar tareas más complejas mediante técnicas de “prompt engineering”. No obstante, OpenAI ha llevado este progreso un paso más allá con la introducción de las “Function calling”. Esta nueva funcionalidad permite que ChatGPT ejecute funciones personalizadas que hayamos definido previamente.</p><p>Es importante destacar que ChatGPT no ejecutará directamente estas funciones por nosotros. En cambio, nos indicará cuándo es necesario ejecutarlas y qué parámetros se requieren para su funcionamiento. Nosotros seremos responsables de ejecutar la función y devolver el resultado al modelo en formato de texto. A partir de ahí, ChatGPT generará una respuesta amigable para el usuario.</p><p>Sin más bla bla, vamos a un ejemplo con código:</p><p>La forma base de ejecutar las function callings es la siguiente:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">openai</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="c1"># Example dummy function hard coded to return the same weather
# In production, this could be your backend API or an external API
</span><span class="k">def</span> <span class="nf">get_current_weather</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s">"fahrenheit"</span><span class="p">):</span>
    <span class="s">"""Get the current weather in a given location"""</span>
    <span class="n">weather_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"location"</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span>
        <span class="s">"temperature"</span><span class="p">:</span> <span class="s">"72"</span><span class="p">,</span>
        <span class="s">"unit"</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span>
        <span class="s">"forecast"</span><span class="p">:</span> <span class="p">[</span><span class="s">"sunny"</span><span class="p">,</span> <span class="s">"windy"</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">weather_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_function_calls</span><span class="p">():</span>
    <span class="c1"># Step 1: send the conversation and available functions to GPT
</span>    <span class="n">messages</span> <span class="o">=</span> <span class="p">[{</span><span class="s">"role"</span><span class="p">:</span> <span class="s">"user"</span><span class="p">,</span> <span class="s">"content"</span><span class="p">:</span> <span class="s">"What's the weather like in Boston?"</span><span class="p">}]</span>
    <span class="n">functions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">"name"</span><span class="p">:</span> <span class="s">"get_current_weather"</span><span class="p">,</span>
            <span class="s">"description"</span><span class="p">:</span> <span class="s">"Get the current weather in a given location"</span><span class="p">,</span>
            <span class="s">"parameters"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"type"</span><span class="p">:</span> <span class="s">"object"</span><span class="p">,</span>
                <span class="s">"properties"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">"location"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                        <span class="s">"description"</span><span class="p">:</span> <span class="s">"The city and state, e.g. San Francisco, CA"</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="s">"unit"</span><span class="p">:</span> <span class="p">{</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"enum"</span><span class="p">:</span> <span class="p">[</span><span class="s">"celsius"</span><span class="p">,</span> <span class="s">"fahrenheit"</span><span class="p">]},</span>
                <span class="p">},</span>
                <span class="s">"required"</span><span class="p">:</span> <span class="p">[</span><span class="s">"location"</span><span class="p">],</span>
            <span class="p">},</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">openai</span><span class="p">.</span><span class="n">ChatCompletion</span><span class="p">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s">"gpt-3.5-turbo-0613"</span><span class="p">,</span>
        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
        <span class="n">functions</span><span class="o">=</span><span class="n">functions</span><span class="p">,</span>
        <span class="n">function_call</span><span class="o">=</span><span class="s">"auto"</span><span class="p">,</span>  <span class="c1"># auto is default, but we'll be explicit
</span>    <span class="p">)</span>
</pre></table></code></div></div><p>Definimos nuestra función custom y le decimos qué estructura de argumentos tiene. Esto no tiene mayor ciencia, así que haremos un pequeño ejemplo con una aplicación de terminal donde consultaremos los productos de una botillería.</p><p>En base a un objeto JSON con las siguientes propiedades:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CACHANTUN CON GAS"</span><span class="p">,</span><span class="w"> 
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Agua Mineral de gran pureza, embotellada desde 1920 directamente en su vertiente de origen."</span><span class="p">,</span><span class="w"> 
    </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Aguas"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>creamos las siguientes funciones:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'src/calling_functions_chatgpt/liquors.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_products</span><span class="p">(</span><span class="n">search</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span><span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">search</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s">'name'</span><span class="p">].</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="n">search</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s">'description'</span><span class="p">].</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="n">search</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="s">'category'</span><span class="p">].</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">filtered</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">filtered</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">limit</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">get_categories</span><span class="p">():</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="s">'category'</span><span class="p">],</span> <span class="n">products</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">:</span>
            <span class="n">categories</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
</pre></table></code></div></div><p>get_products() obtiene los productos y get_categories() las categorias disponibles de la tienda de licores.</p><h2 id="implementación-de-callfunction"><span class="mr-2">Implementación de CallFunction</span><a href="#implementación-de-callfunction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Definiremos 2 clases principales: <code class="language-plaintext highlighter-rouge">CallFunction</code> y <code class="language-plaintext highlighter-rouge">ChatGPT</code>.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="o">@</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">CallFunction</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">manifest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="p">...</span>

    <span class="o">@</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="p">...</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">function_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">manifest</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
</pre></table></code></div></div><p>La clase <code class="language-plaintext highlighter-rouge">CallFunction</code> es una clase abstracta que actúa como una plantilla para definir funciones personalizadas que pueden ser llamadas desde el modelo de chat <code class="language-plaintext highlighter-rouge">ChatGPT</code>. Tiene los siguientes métodos y propiedades:</p><ul><li><code class="language-plaintext highlighter-rouge">manifest</code>: Es una propiedad que devuelve un diccionario que representa la información de la función.<li><code class="language-plaintext highlighter-rouge">execute</code>: Es un método abstracto que debe ser implementado por las subclases. Representa la ejecución de la función personalizada y toma como argumentos palabras clave (**kwargs).<li><code class="language-plaintext highlighter-rouge">function_name</code>: Es una propiedad que devuelve el nombre de la función obtenido del diccionario manifest.</ul><h2 id="implementación-de-chatgpt"><span class="mr-2">Implementación de ChatGPT</span><a href="#implementación-de-chatgpt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">ChatGPT</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="s">"gpt-3.5-turbo-0613"</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">chat_status</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">call_functions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CallFunction</span><span class="p">]</span> <span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">call_functions</span> <span class="o">=</span> <span class="n">call_functions</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">functions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fn</span><span class="p">:</span> <span class="n">fn</span><span class="p">.</span><span class="n">manifest</span><span class="p">,</span> <span class="n">call_functions</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[{</span> <span class="s">'role'</span><span class="p">:</span> <span class="s">'system'</span><span class="p">,</span> <span class="s">'content'</span><span class="p">:</span> <span class="n">prompt</span> <span class="p">}]</span>

    <span class="k">def</span> <span class="nf">add_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_token_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">tokens</span> <span class="o">+=</span> <span class="n">response</span><span class="p">[</span><span class="s">'usage'</span><span class="p">][</span><span class="s">'total_tokens'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">execute_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">):</span>
        <span class="n">function_arguments</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cf</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">call_functions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cf</span><span class="p">.</span><span class="n">function_name</span> <span class="o">==</span> <span class="n">function_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cf</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="o">**</span><span class="n">function_arguments</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s">"choices"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">"message"</span><span class="p">][</span><span class="s">"content"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">init_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">openai</span><span class="p">.</span><span class="n">ChatCompletion</span><span class="p">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">,</span>
            <span class="n">functions</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">functions</span><span class="p">,</span>
            <span class="n">function_call</span><span class="o">=</span><span class="s">"auto"</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">update_token_usage</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_answer</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_message</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">add_message</span><span class="p">({</span> <span class="s">'role'</span><span class="p">:</span> <span class="s">'user'</span><span class="p">,</span> <span class="s">'content'</span><span class="p">:</span> <span class="n">input_message</span> <span class="p">})</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">openai</span><span class="p">.</span><span class="n">ChatCompletion</span><span class="p">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">,</span>
            <span class="n">functions</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">functions</span><span class="p">,</span>
            <span class="n">function_call</span><span class="o">=</span><span class="s">"auto"</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">update_token_usage</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">"choices"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">"message"</span><span class="p">]</span>
        <span class="c1"># verify function calling
</span>        <span class="n">function_call</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"function_call"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">function_call</span><span class="p">:</span>
            <span class="c1"># execute function
</span>            <span class="n">function_name</span> <span class="o">=</span> <span class="n">function_call</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">chat_status</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="sa">f</span><span class="s">"Llamando a la funcion </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">function_call</span><span class="p">[</span><span class="s">'arguments'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
            <span class="n">function_response</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">execute_function</span><span class="p">(</span><span class="n">function_name</span><span class="p">,</span> <span class="n">function_call</span><span class="p">[</span><span class="s">'arguments'</span><span class="p">])</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">chat_status</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s">() ejecutada."</span><span class="p">)</span>
            <span class="c1"># update messages
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">add_message</span><span class="p">({</span> <span class="s">"role"</span><span class="p">:</span> <span class="s">"function"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="n">function_name</span><span class="p">,</span> <span class="s">"content"</span><span class="p">:</span> <span class="n">function_response</span> <span class="p">})</span>
            <span class="c1"># send messages to chatgpt
</span>            <span class="n">second_response</span> <span class="o">=</span> <span class="n">openai</span><span class="p">.</span><span class="n">ChatCompletion</span><span class="p">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">messages</span><span class="p">,</span>
                <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">update_token_usage</span><span class="p">(</span><span class="n">second_response</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_answer</span><span class="p">(</span><span class="n">second_response</span><span class="p">)</span>
        <span class="c1"># save message to context
</span>        <span class="bp">self</span><span class="p">.</span><span class="n">add_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="c1"># no function calling 
</span>        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_answer</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">chat_status</span> <span class="o">=</span> <span class="n">log</span><span class="p">.</span><span class="n">progress</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">chat_status</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">chat_status</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">chat_status</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">chat_status</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

</pre></table></code></div></div><p>La clase ChatGPT es la clase principal que representa un modelo de chat basado en el modelo <code class="language-plaintext highlighter-rouge">GPT-3.5-turbo-6013</code>. Aquí hay una descripción de sus métodos y propiedades:</p><ul><li><code class="language-plaintext highlighter-rouge">model</code>: Una variable de clase que almacena el nombre del modelo <code class="language-plaintext highlighter-rouge">GPT-3.5-turbo-6013</code> (este es el modelo que soporta function calling) utilizado.<li><code class="language-plaintext highlighter-rouge">tokens</code>: Una variable de clase que realiza un seguimiento del número total de tokens utilizados.<li><code class="language-plaintext highlighter-rouge">chat_status</code>: Una variable de instancia que almacena el estado actual del chat.</ul><p>El método <strong>init</strong> es el constructor de la clase ChatGPT. Recibe una cadena de texto prompt y una lista de objetos CallFunction llamada call_functions como argumentos. Inicializa las variables de instancia y crea una lista functions que contiene los diccionarios manifest de las funciones proporcionadas.</p><p>El método <code class="language-plaintext highlighter-rouge">add_message()</code> agrega un mensaje a la lista messages que se utiliza para almacenar el historial de mensajes del chat.</p><p>El método <code class="language-plaintext highlighter-rouge">update_token_usage()</code> actualiza el contador de tokens utilizando la información proporcionada en la respuesta del modelo de chat.</p><p>El método <code class="language-plaintext highlighter-rouge">execute_function()</code> toma el nombre de una función y sus argumentos como entrada y busca la función correspondiente en la lista de <code class="language-plaintext highlighter-rouge">call_functions</code>. Si encuentra una coincidencia, llama al método execute de la función correspondiente con los argumentos proporcionados y devuelve el resultado.</p><p>El método <code class="language-plaintext highlighter-rouge">get_answer()</code> toma la respuesta del modelo de chat y extrae el contenido del primer mensaje de la respuesta.</p><p>El método <code class="language-plaintext highlighter-rouge">init_chat()</code> inicializa el chat enviando una solicitud al modelo de chat. Utiliza el modelo model, la lista messages, la lista functions, y establece la llamada a la función en “auto” con una temperatura de 0. Actualiza el contador de tokens y devuelve la respuesta del modelo de chat.</p><p>El método <code class="language-plaintext highlighter-rouge">ask()</code> se utiliza para hacer una pregunta o enviar un mensaje al modelo de chat. Toma un mensaje de entrada y una temperatura (opcional) como argumentos. Agrega el mensaje del usuario a la lista messages y envía una solicitud al modelo de chat. Al igual que en <code class="language-plaintext highlighter-rouge">init_chat()</code>, utiliza el modelo model, la lista messages, la lista functions, y establece la llamada a la función en “auto” con la temperatura proporcionada. Actualiza el contador de tokens y procesa la respuesta. Si la respuesta contiene un mensaje de llamada a función, extrae el nombre de la función y sus argumentos, ejecuta la función correspondiente utilizando <code class="language-plaintext highlighter-rouge">execute_function()</code>, agrega los mensajes relevantes a la lista messages, y envía una segunda solicitud al modelo de chat. Finalmente, devuelve la respuesta del modelo de chat.</p><p>Los métodos <code class="language-plaintext highlighter-rouge">progress()</code>, <code class="language-plaintext highlighter-rouge">status()</code>, y <code class="language-plaintext highlighter-rouge">success()</code> nos ayudan a generar mensajes de información al usuario.</p><h2 id="aplicación-de-terminal"><span class="mr-2">Aplicación de terminal</span><a href="#aplicación-de-terminal" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ahora crearemos una aplicación de terminal en la que ejecutaremos las llamadas a la API de ChatGPT. Esta será una función que le preguntará al usuario las acciones a realizar.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">command_line</span><span class="p">(</span><span class="n">chatgpt</span><span class="p">:</span> <span class="n">ChatGPT</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">()</span>
        <span class="n">assistant_progress</span> <span class="o">=</span> <span class="n">log</span><span class="p">.</span><span class="n">progress</span><span class="p">(</span><span class="s">'AI Assistant'</span><span class="p">)</span>
        <span class="n">assistant_progress</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="s">'Iniciando asistente...'</span><span class="p">)</span>
        <span class="n">assistant_input</span> <span class="o">=</span> <span class="n">chatgpt</span><span class="p">.</span><span class="n">init_chat</span><span class="p">()</span>
        <span class="n">assistant_progress</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'Asistente listo!'</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">green_color</span><span class="p">(</span><span class="s">'[Assistant]'</span><span class="p">)</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">assistant_input</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">green_color</span><span class="p">(</span><span class="s">'[User]'</span><span class="p">)</span><span class="si">}</span><span class="s"> "</span><span class="p">)</span>
            <span class="k">print</span><span class="p">()</span>
            <span class="n">chatgpt</span><span class="p">.</span><span class="n">progress</span><span class="p">(</span><span class="s">'Estado chat context'</span><span class="p">)</span>
            <span class="c1"># exit command
</span>            <span class="k">if</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s">'exit'</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="c1"># connecting with openai 
</span>            <span class="n">chatgpt</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="s">'Pensando...'</span><span class="p">)</span>
            <span class="n">assistant_input</span> <span class="o">=</span> <span class="n">chatgpt</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span>
            <span class="n">chatgpt</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">"Listo!"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Saliendo...'</span><span class="p">)</span>
    <span class="n">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">'Total tokens: </span><span class="si">{</span><span class="n">chatgpt</span><span class="p">.</span><span class="n">tokens</span><span class="si">}</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
</pre></table></code></div></div><p>La explicaión de la función <code class="language-plaintext highlighter-rouge">command_line()</code> es la siguiente:</p><ul><li><p>La función <code class="language-plaintext highlighter-rouge">command_line()</code> toma un objeto <code class="language-plaintext highlighter-rouge">ChatGPT</code> como argumento.</p><li><p>Dentro de la función, se inicializa una barra de progreso llamada <code class="language-plaintext highlighter-rouge">assistant_progress</code> que muestra el estado del asistente. Se establece un mensaje de estado inicial indicando que el asistente se está iniciando.</p><li><p>Se llama al método <code class="language-plaintext highlighter-rouge">init_chat()</code> del objeto chatgpt para iniciar el chat con el asistente. El resultado se asigna a la variable <code class="language-plaintext highlighter-rouge">assistant_input</code>, que contiene la respuesta inicial del asistente.</p><li><p>La barra de progreso se actualiza para indicar que el asistente está listo.</p><li><p>Se inicia un bucle while que se ejecutará continuamente hasta que se ingrese el comando “exit”.</p><li><p>Se solicita la entrada del usuario con el mensaje [User] y se asigna a la variable <code class="language-plaintext highlighter-rouge">user_input</code>.</p><li><p>Si el valor de user_input es igual a “exit”, se rompe el bucle y se sale de la función.</p><li><p>Si no es un comando de salida, se actualiza la barra de progreso.</p><li><p>Se llama al método <code class="language-plaintext highlighter-rouge">ask()</code> del objeto chatgpt pasando la <code class="language-plaintext highlighter-rouge">user_input</code> como argumento. Esto envía la entrada del usuario al asistente y devuelve la respuesta del asistente. La respuesta se asigna a <code class="language-plaintext highlighter-rouge">assistant_input</code>.</p><li><p>La barra de progreso se actualiza para indicar que el asistente ha completado su tarea y está listo para responder.</p><li><p>Si se produce una excepción de interrupción de teclado (por ejemplo, cuando se presiona Ctrl+C), se imprime un mensaje indicando que se está saliendo del programa.</p><li><p>Finalmente Se imprime la cantidad total de tokens utilizados durante la ejecución del asistente.</p></ul><p>Ahora definiremos nuestras CallFunction que ChatGPT ejecutará según corresponda.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">GetProductsCallFunction</span><span class="p">(</span><span class="n">CallFunction</span><span class="p">):</span>
    <span class="n">manifest</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="s">"get_products"</span><span class="p">,</span>
        <span class="s">"description"</span><span class="p">:</span> <span class="s">"Obtiene los productos disponibles de la botilleria"</span><span class="p">,</span>
        <span class="s">"parameters"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="p">:</span> <span class="s">"object"</span><span class="p">,</span>
            <span class="s">"properties"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"search"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                    <span class="s">"description"</span><span class="p">:</span> <span class="s">"busqueda por palabra clave"</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s">"limit"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"number"</span><span class="p">,</span>
                    <span class="s">"description"</span><span class="p">:</span> <span class="s">"cantidad limite de datos a traer"</span>
                <span class="p">},</span>
                <span class="s">"offset"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s">"type"</span><span class="p">:</span> <span class="s">"number"</span><span class="p">,</span>
                    <span class="s">"description"</span><span class="p">:</span> <span class="s">"indice donde empieza a traer datos"</span>
                <span class="p">}</span>
            <span class="p">}</span>
          <span class="c1"># "required": ["search"],
</span>        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_products</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    

<span class="k">class</span> <span class="nc">GetCategoriesCallFunction</span><span class="p">(</span><span class="n">CallFunction</span><span class="p">):</span>
    <span class="n">manifest</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="s">"get_categories"</span><span class="p">,</span>
        <span class="s">"description"</span><span class="p">:</span> <span class="s">"Obtiene las categorias disponibles de la botilleria"</span><span class="p">,</span>
        <span class="s">"parameters"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="p">:</span> <span class="s">"object"</span><span class="p">,</span>
            <span class="s">"properties"</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_categories</span><span class="p">()</span>

</pre></table></code></div></div><p>Implementamos las clases <code class="language-plaintext highlighter-rouge">GetProductsCallFunction</code> y <code class="language-plaintext highlighter-rouge">GetCategoriesCallFunction</code> que heredan de <code class="language-plaintext highlighter-rouge">CallFunction</code> con sus correspondientes descripciones de los argumentos y las funciones que ChatGPT podrá usar. Ya con estas clases definidas instanciaremos la clase <code class="language-plaintext highlighter-rouge">ChatGPT</code> con la siguiente configuración:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">chatgpt</span> <span class="o">=</span> <span class="n">ChatGPT</span><span class="p">(</span>
    <span class="n">prompt</span><span class="o">=</span><span class="s">"Se un util y amable asistente de una botilleria, que resolvera consultas sobre sus productos existentes. trabajaras con un limite de 15 items por consulta"</span><span class="p">,</span>
    <span class="n">call_functions</span><span class="o">=</span><span class="p">[</span>
        <span class="n">GetProductsCallFunction</span><span class="p">(),</span>
        <span class="n">GetCategoriesCallFunction</span><span class="p">()</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></table></code></div></div><p>A la clase <code class="language-plaintext highlighter-rouge">ChatGPT</code> le entregamos el parámetro <code class="language-plaintext highlighter-rouge">prompt</code>, donde definimos las instrucciones deseadas, y definimos el parámetro <code class="language-plaintext highlighter-rouge">call_functions</code>, donde les entregamos las <code class="language-plaintext highlighter-rouge">CallFunctions</code> definidas previamente.</p><p>Finalmente hacemos uso de la función <code class="language-plaintext highlighter-rouge">command_line()</code>:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>
<span class="n">command_line</span><span class="p">(</span><span class="n">chatgpt</span><span class="o">=</span><span class="n">chatgpt</span><span class="p">)</span>

</pre></table></code></div></div><p>Ahora ejecutamos</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
python src/calling_function_chatgpt/app.py
</pre></table></code></div></div><p>Nuestro asistente inicia:</p><p><img data-src="https://i.ibb.co/B2P52NJ/Screenshot-2023-06-19-at-19-38-42.png" alt="img2" data-proofer-ignore></p><p>Y le realizaremos 2 preguntas:</p><ul><li>¿Qué categorías de bebidas existen?<li>¿Qué cervezas tienes disponibles?</ul><p>Obtendremos las siguientes respuestas:</p><p>Preguntamos por las categorias.</p><p><img data-src="https://i.ibb.co/jWQjvRw/Screenshot-2023-06-19-at-19-39-14.png" alt="img2" data-proofer-ignore></p><p>y preguntamos por los productos de la categoria que queramos en este caso preguntamos por cervezas.</p><p><img data-src="https://i.ibb.co/r6FqcMN/Screenshot-2023-06-19-at-19-39-46.png" alt="img3" data-proofer-ignore></p><h2 id="conclusiones"><span class="mr-2">Conclusiones</span><a href="#conclusiones" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>ChatGPT ha demostrado ser una herramienta valiosa al responder nuestras preguntas utilizando las funciones que le hemos indicado. Sin embargo, sus capacidades van más allá de simplemente proporcionar respuestas. Esta nueva característica de <code class="language-plaintext highlighter-rouge">calling function</code> le brinda una mayor versatilidad al desarrollo de aplicaciones basadas en IA.</p><p>Con el uso de <code class="language-plaintext highlighter-rouge">calling function</code> podemos lograr lo siguiente:</p><ul><li><p>Orquestar acciones fuera de ChatGPT: Ahora podemos utilizar ChatGPT para coordinar y controlar acciones en otros sistemas o servicios, lo que amplía sus posibilidades de uso.</p><li><p>Ejecutar acciones que ChatGPT no puede hacer: Gracias a la capacidad de integrar funciones externas, podemos realizar tareas complejas que están fuera del alcance de ChatGPT por sí solo. Esto permite abordar una variedad más amplia de problemas y escenarios.</p><li><p>Integraciones más rápidas y sencillas: La funcionalidad de “calling function” facilita la integración de ChatGPT con otros sistemas y servicios. Esto agiliza el proceso de desarrollo de aplicaciones y permite crear soluciones más completas de manera más eficiente.</p><li><p>Evitar dependencias con librerías de terceros: Al poder ejecutar acciones externas directamente desde ChatGPT, se reduce la necesidad de depender de librerías o herramientas adicionales. Esto simplifica el proceso de desarrollo y reduce posibles problemas de compatibilidad.</p></ul><p>Este ejemplo simple y fácil demuestra cómo podemos aprovechar la nueva funcionalidad de “calling function” para crear aplicaciones innovadoras más allá del típico asistente de chat. Las posibilidades son amplias y prometen un futuro emocionante para el desarrollo de aplicaciones basadas en IA.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/python-examples/tree/master/src/calling_function_chatgpt">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Meme de cortesía</p><p><img data-src="https://i.ibb.co/PQYfyDY/Screenshot-2023-06-19-at-19-58-50.png" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/programacion/'>Programacion</a>, <a href='//categories/python/'>Python</a>, <a href='//categories/ai/'>AI</a>, <a href='//categories/chatgpt/'>ChatGPT</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/programacion/" class="post-tag no-text-decoration" >Programacion</a> <a href="//tags/python/" class="post-tag no-text-decoration" >Python</a> <a href="//tags/ai/" class="post-tag no-text-decoration" >AI</a> <a href="//tags/chatgpt/" class="post-tag no-text-decoration" >ChatGPT</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ChatGPT+Calling+Functions+ahora+la+AI+puede+llamar+funciones+de+c%C3%B3digo+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fchatgp-calling-functions%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ChatGPT+Calling+Functions+ahora+la+AI+puede+llamar+funciones+de+c%C3%B3digo+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fchatgp-calling-functions%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fchatgp-calling-functions%2F&text=ChatGPT+Calling+Functions+ahora+la+AI+puede+llamar+funciones+de+c%C3%B3digo+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fchatgp-calling-functions%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/como-implementar-un-eventbus-y-rxjs-en-conjunto/"><div class="card-body"> <em class="small" data-ts="1692189120" data-df="YYYY-MM-DD" > 2023-08-16 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitecturas Orientadas a Eventos. Implementando un EventBus y RxJS en Conjunto</h3><div class="text-muted small"><p> En el mundo de la arquitectura de software, especialmente en entornos orientados a microservicios, la comunicación y la coordinación entre componentes son cruciales. Una forma efectiva de lograrl...</p></div></div></a></div><div class="card"> <a href="/posts/sqli/"><div class="card-body"> <em class="small" data-ts="1664926320" data-df="YYYY-MM-DD" > 2022-10-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cuando un SQL Injection deja a tu aplicación como un chiste</h3><div class="text-muted small"><p> El título suena rudo, pero a decir verdad en muchas empresas y desarrolladores la seguridad la dejan a la ligera. A sí que veamos que podemos hacer con sqlijection. Increiblemente aún son reporta...</p></div></div></a></div><div class="card"> <a href="/posts/Specification-pattern/"><div class="card-body"> <em class="small" data-ts="1663457520" data-df="YYYY-MM-DD" > 2022-09-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>¿Que es el Patron especification?</h3><div class="text-muted small"><p> ¿Que es el Patron especification? El patrón Specification nos permite encapsular reglas de negocio, ya sean estas sencillas o complejas, de manera que sean reutilizables y fáciles de cambiar. Es...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/state-machine-design-pattern/" class="btn btn-outline-primary" prompt="Anterior"><p>Conociendo el patrón de diseño state machine.</p></a> <a href="//posts/como-implementar-un-eventbus-y-rxjs-en-conjunto/" class="btn btn-outline-primary" prompt="Nuevo"><p>Arquitecturas Orientadas a Eventos. Implementando un EventBus y RxJS en Conjunto</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
