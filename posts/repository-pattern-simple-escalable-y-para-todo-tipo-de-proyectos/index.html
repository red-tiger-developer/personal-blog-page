<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Repository pattern simple escalable y para todo tipo de proyectos" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/repository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/repository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-05-29T01:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Repository pattern simple escalable y para todo tipo de proyectos" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2024-05-29T01:00:00-04:00","datePublished":"2024-05-29T01:00:00-04:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Repository pattern simple escalable y para todo tipo de proyectos","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/repository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos/"},"url":"https://nullpointer-excelsior.github.io/posts/repository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos/"}</script><title>Repository pattern simple escalable y para todo tipo de proyectos | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Repository pattern simple escalable y para todo tipo de proyectos</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Repository pattern simple escalable y para todo tipo de proyectos</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1716958800" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2024-05-29 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1168 palabras"> <em>6 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/intros/intro7.webp" alt="intro" data-proofer-ignore></p><p>El patrón de diseño Repository se utiliza para abstraer la lógica de acceso a datos de la lógica de negocio. Su objetivo es encapsular el acceso a los datos y ocultarlo a cualquier componente que utilice el repositorio. De esta manera, la capa de negocio no necesita preocuparse por cómo se accede a los datos, sino que simplemente interactúa con el repositorio para obtener la información que requiere.</p><h2 id="por-qué-usar-el-repository-pattern"><span class="mr-2">¿Por qué usar el Repository pattern?</span><a href="#por-qué-usar-el-repository-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>El Repository pattern es una buena opción cuando se quiere desacoplar la lógica de negocio de la lógica de acceso a datos. Esto permite que la lógica de negocio sea más fácil de entender y de mantener.</p><p>Más que permitirnos tener un acceso a los datos desacoplados, la realidad es que el Repository pattern nos permite tener las siguientes ventajas:</p><ul><li>Lógica de negocio desacoplada de la lógica de acceso a datos nos permite crear un dominio más limpio y más relacionado al negocio que a implementaciones tecnológicas.<li>Facilita la implementación de pruebas unitarias y de integración, ya que podemos simular el acceso a datos mediante mocks.<li>Facilita la implementación de código limpio y patrones de diseño como el patrón de inyección de dependencias.</ul><h2 id="ejemplo-sencillo-y-elegante"><span class="mr-2">Ejemplo sencillo y elegante</span><a href="#ejemplo-sencillo-y-elegante" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nos basaremos en el proyecto <code class="language-plaintext highlighter-rouge">spotify-clone</code> tomando la entidad <code class="language-plaintext highlighter-rouge">Album</code>, la cual representa un álbum de música.</p><h3 id="componente-entidad"><span class="mr-2">Componente Entidad</span><a href="#componente-entidad" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Una entidad es un objeto del dominio que tiene una identidad única y distintiva, que persiste a lo largo del tiempo y puede cambiar su estado. Las entidades poseen atributos y métodos que permiten manipular su estado.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Album</span> <span class="p">{</span>

    <span class="p">@</span><span class="nd">IsUUID</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The ID of the album</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The title of the album</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">title</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The photo of the album</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">photo</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsNumber</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The year the album was released</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">year</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>


<span class="p">}</span>
</pre></table></code></div></div><p>En este caso, nuestra entidad <code class="language-plaintext highlighter-rouge">Album</code> no posee comportamiento, solo atributos y lógica de validaciones.</p><h3 id="componente-repositorio"><span class="mr-2">Componente Repositorio</span><a href="#componente-repositorio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>El repositorio es el encargado de acceder a los datos de la entidad <code class="language-plaintext highlighter-rouge">Album</code>. En este caso, el repositorio se encarga de acceder a los datos de los álbumes desde una base de datos. El repositorio es definido a través de una interfaz que define los métodos que se pueden utilizar para acceder a los datos de los álbumes. No nos preocuparemos de cómo se accede a los datos, simplemente el repositorio nos indica las operaciones que podemos realizar sobre nuestra entidad.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">AlbumRepository</span> <span class="p">{</span>
    <span class="kd">abstract</span> <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="kd">abstract</span> <span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="kd">abstract</span> <span class="nx">findByArtistId</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

</pre></table></code></div></div><h3 id="implementaciones-del-repositorio"><span class="mr-2">Implementaciones del Repositorio</span><a href="#implementaciones-del-repositorio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Como hemos mencionado, el repositorio nos abstrae del acceso de datos, esto nos permitirá definir una implementación dependiendo del caso. También nos permitirá cambiar la fuente de datos sin tener que modificar la lógica de negocio en caso de que se requiera cambiar el tipo de almacenamiento por algún motivo.</p><h4 id="implementación-productiva-con-typeorm-y-postgres"><span class="mr-2">Implementación productiva con TypeORM y Postgres</span><a href="#implementación-productiva-con-typeorm-y-postgres" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>En esta implementación utilizamos Postgres como base de datos y TypeORM como librería para acceder a los datos. Esta es nuestra implementación productiva:</p><p>Definimos una Entidad de TypeORM que mapea la tabla <code class="language-plaintext highlighter-rouge">albums</code> en la base de datos. Entidad ORM (<code class="language-plaintext highlighter-rouge">AlbumEntity</code>) es distinta a la entidad del dominio <code class="language-plaintext highlighter-rouge">Album</code>, ya que la entidad de TypeORM es específica para el acceso a datos. Mientras que la entidad del dominio es específica para la lógica de negocio.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre>
<span class="p">@</span><span class="nd">Entity</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">albums</span><span class="dl">"</span> <span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AlbumEntity</span> <span class="p">{</span>

    <span class="p">@</span><span class="nd">PrimaryGeneratedColumn</span><span class="p">(</span><span class="dl">'</span><span class="s1">uuid</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">title</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">photo</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">Column</span><span class="p">()</span>
    <span class="nx">year</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">ManyToOne</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">ArtistEntity</span><span class="p">,</span> <span class="nx">artist</span> <span class="o">=&gt;</span> <span class="nx">artist</span><span class="p">.</span><span class="nx">albums</span><span class="p">)</span>
    <span class="nx">artist</span><span class="p">:</span> <span class="nx">ArtistEntity</span><span class="p">;</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Definimos un repositorio que implementa la interfaz <code class="language-plaintext highlighter-rouge">AlbumRepository</code>. En este caso, utilizamos NestJs para injectar el repositorio de TypeORM mediante el decorador <code class="language-plaintext highlighter-rouge">@InjectRepository</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">PostgresAlbumRepository</span> <span class="kd">extends</span> <span class="nx">AlbumRepository</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(@</span><span class="nd">InjectRepository</span><span class="p">(</span><span class="nx">AlbumEntity</span><span class="p">)</span> <span class="k">private</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">Repository</span><span class="o">&lt;</span><span class="nx">AlbumEntity</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findOneBy</span><span class="p">({</span> <span class="nx">id</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">findByArtistId</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findBy</span><span class="p">({</span> <span class="na">artist</span><span class="p">:</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="p">});</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><h4 id="implementación-de-pruebas-con-un-mock-en-memoria"><span class="mr-2">Implementación de pruebas con un mock en memoria</span><a href="#implementación-de-pruebas-con-un-mock-en-memoria" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>En este caso, utilizamos un mock en memoria para simular el acceso a datos. Esta implementación es útil para pruebas unitarias y de integración.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">InMemoryAlbumRepository</span> <span class="kd">extends</span> <span class="nx">AlbumRepository</span> <span class="p">{</span>

    <span class="k">private</span> <span class="nx">albums</span><span class="p">:</span> <span class="nx">Album</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Album 1</span><span class="dl">'</span><span class="p">,</span> <span class="na">photo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">photo1.jpg</span><span class="dl">'</span><span class="p">,</span> <span class="na">year</span><span class="p">:</span> <span class="mi">2021</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">2</span><span class="dl">'</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Album 2</span><span class="dl">'</span><span class="p">,</span> <span class="na">photo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">photo2.jpg</span><span class="dl">'</span><span class="p">,</span> <span class="na">year</span><span class="p">:</span> <span class="mi">2021</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">3</span><span class="dl">'</span><span class="p">,</span> <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Album 3</span><span class="dl">'</span><span class="p">,</span> <span class="na">photo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">photo3.jpg</span><span class="dl">'</span><span class="p">,</span> <span class="na">year</span><span class="p">:</span> <span class="mi">2021</span> <span class="p">},</span>
    <span class="p">];</span>

    <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">albums</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">albums</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">album</span> <span class="o">=&gt;</span> <span class="nx">album</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="nx">findByArtistId</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">albums</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">album</span> <span class="o">=&gt;</span> <span class="nx">album</span><span class="p">.</span><span class="nx">artist</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">id</span><span class="p">));</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><h3 id="usando-repository-pattern-en-lógica-de-negocio"><span class="mr-2">Usando repository pattern en lógica de negocio</span><a href="#usando-repository-pattern-en-lógica-de-negocio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>En este caso, <code class="language-plaintext highlighter-rouge">AlbumService</code> es el encargado de la lógica de negocio relacionada con los álbumes. Este se comunica con el repositorio para obtener los datos que necesita. <code class="language-plaintext highlighter-rouge">AlbumService</code> no tiene que preocuparse de cómo se accede a los datos, simplemente se comunica con el repositorio para obtener los datos que necesita.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AlbumService</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">AlbumRepository</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">getAlbums</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findAll</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">getAlbum</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">album</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">album</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundException</span><span class="p">(</span><span class="s2">`Album with id </span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2"> not found`</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">album</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">getAlbumsByArtist</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Album</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findByArtistId</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><h3 id="inyectando-dependencias"><span class="mr-2">Inyectando dependencias</span><a href="#inyectando-dependencias" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Para usar Repository Pattern generalmente se utiliza junto a la inyección de dependencias. En este caso, utilizamos NestJS como framework y el módulo TypeORM para la inyección de dependencias.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
    <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
        <span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forFeature</span><span class="p">([</span><span class="nx">AlbumEntity</span><span class="p">])</span>
    <span class="p">],</span>
    <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
        <span class="nx">AlbumService</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="na">provide</span><span class="p">:</span> <span class="nx">AlbumRepository</span><span class="p">,</span>
            <span class="na">useClass</span><span class="p">:</span> <span class="nx">PostgresAlbumRepository</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">exports</span><span class="p">:</span> <span class="p">[</span><span class="nx">AlbumService</span><span class="p">]</span>
<span class="p">})</span>
</pre></table></code></div></div><p>Y si queremos probar nuestro servicio sin framework o librería, por ejemplo en el contexto de pruebas unitarias, podemos crear nuestro servicio de la siguiente manera:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>
<span class="c1">// in memory repository</span>
<span class="kd">const</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">AlbumRepository</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InMemoryAlbumRepository</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AlbumService</span><span class="p">(</span><span class="nx">repository</span><span class="p">);</span>

<span class="c1">// json repository</span>
<span class="kd">const</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">AlbumRepository</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JsonAlbumRepository</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">service</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AlbumService</span><span class="p">(</span><span class="nx">repository</span><span class="p">);</span>

</pre></table></code></div></div><h2 id="conclusión"><span class="mr-2">Conclusión</span><a href="#conclusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>El verdadero poder del patrón Repository no es permitirnos cambiar la fuente de datos de manera sencilla. Este nos permite tener una lógica de negocio totalmente desacoplada de la implementación tecnológica del acceso de datos. Este sencillo enfoque, nos permite definir un dominio más limpio y testeable.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/microservices-architecture-nestjs/">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="meme-de-despedida"><span class="mr-2">Meme de despedida</span><a href="#meme-de-despedida" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/img/memes/meme5.webp" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/software-arquitectura-patrones-orm/'>Software,Arquitectura,Patrones,ORM</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/software-arquitectura-patrones-orm/" class="post-tag no-text-decoration" >software,arquitectura,patrones,orm</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Repository+pattern+simple+escalable+y+para+todo+tipo+de+proyectos+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Frepository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Repository+pattern+simple+escalable+y+para+todo+tipo+de+proyectos+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Frepository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Frepository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos%2F&text=Repository+pattern+simple+escalable+y+para+todo+tipo+de+proyectos+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Frepository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/resena-del-libro-enterprise-integration-patterns/"><div class="card-body"> <em class="small" data-ts="1739854800" data-df="YYYY-MM-DD" > 2025-02-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Reseña del Libro Enterprise Integration Patterns</h3><div class="text-muted small"><p> Resumen General Enterprise Integration Patterns: Designing, Building, and Deploying Messaging Solutions es un libro escrito en 2003 por Gregor Hohpe y Bobby Woolf que explora cómo integrar soluci...</p></div></div></a></div><div class="card"> <a href="/posts/que-es-cqrs-y-como-funciona-con-un-ejemplo-practico/"><div class="card-body"> <em class="small" data-ts="1738645200" data-df="YYYY-MM-DD" > 2025-02-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>¿Qué es CQRS y cómo funciona? Con un ejemplo práctico.</h3><div class="text-muted small"><p> ¿Qué es CQRS y qué problema soluciona? CQRS (Command Query Responsibility Segregation) es un patrón arquitectónico que separa las operaciones de lectura y escritura en una aplicación. En lugar d...</p></div></div></a></div><div class="card"> <a href="/posts/que-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico/"><div class="card-body"> <em class="small" data-ts="1738040400" data-df="YYYY-MM-DD" > 2025-01-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>¿Qué es y cómo funciona el Event Sourcing con un ejemplo práctico?</h3><div class="text-muted small"><p> ¿Qué es Event Sourcing? Event Sourcing es un patrón de arquitectura de software que trata cada cambio en el estado de una aplicación como un evento. En lugar de almacenar el estado actual de un ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/patrones-de-resiliencia/" class="btn btn-outline-primary" prompt="Anterior"><p>Patrones de resiliencia</p></a> <a href="//posts/backend-for-frontend-pattern/" class="btn btn-outline-primary" prompt="Nuevo"><p>Backend for Frontend pattern</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
