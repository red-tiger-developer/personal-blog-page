<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Simplificando el testing unitario con arquitectura hexagonal" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/simplificando-el-testing-unitario-con-arquitectura-hexagonal/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/simplificando-el-testing-unitario-con-arquitectura-hexagonal/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-01-23T02:00:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Simplificando el testing unitario con arquitectura hexagonal" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2024-01-23T02:00:00-03:00","datePublished":"2024-01-23T02:00:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Simplificando el testing unitario con arquitectura hexagonal","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/simplificando-el-testing-unitario-con-arquitectura-hexagonal/"},"url":"https://nullpointer-excelsior.github.io/posts/simplificando-el-testing-unitario-con-arquitectura-hexagonal/"}</script><title>Simplificando el testing unitario con arquitectura hexagonal | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Simplificando el testing unitario con arquitectura hexagonal</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Simplificando el testing unitario con arquitectura hexagonal</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1705986000" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2024-01-23 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2295 palabras"> <em>12 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/intros/intro3.webp" alt="intro" data-proofer-ignore></p><p>El testing con arquitectura hexagonal nos provee una manera limpia de crear pruebas unitarias en nuestro código sin acoplarnos a las librerías de testing o cualquier otra tecnología no relacionada a los casos de uso o reglas de negocio que queramos implementar.</p><p>El testing unitario nos ayudará a evitar muchos dolores de cabeza y tiene un montón de beneficios. Al tratar de aplicarlo en códigos que no siguen buenas prácticas, se hace complejo y en muchas ocasiones duplica o triplica el tiempo de desarrollo de una funcionalidad con pruebas incluidas. En esta ocasión te voy a decir por qué las arquitecturas clean son tan valoradas por la ingeniería de software sobre proyectos complejos.</p><h2 id="por-qué-hexagonal-ayuda-al-testing-unitario"><span class="mr-2">Por qué hexagonal ayuda al testing unitario</span><a href="#por-qué-hexagonal-ayuda-al-testing-unitario" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>La elección de una arquitectura hexagonal para desarrollar nuestras aplicaciones no solo tiene beneficios durante la implementación, sino que también mejora significativamente el proceso de pruebas unitarias. Aquí te presento algunas razones clave:</p><ul><li><p><strong>Desacoplamiento del Código de Dominio de Frameworks o Librerías:</strong> La arquitectura hexagonal nos permite mantener nuestro código de dominio completamente desacoplado de frameworks o librerías externas. Este desacoplamiento facilita la creación de pruebas unitarias, ya que podemos concentrarnos en evaluar la lógica de negocio sin preocuparnos por detalles de implementación específicos de la tecnología.</p><li><p><strong>Azúcar Sintáctica para las Pruebas del Código de Dominio:</strong> La estructura limpia y desacoplada de la arquitectura hexagonal proporciona un azúcar sintáctica para escribir pruebas del código de dominio. Esto se traduce en pruebas más legibles y mantenibles, ya que podemos enfocarnos en expresar directamente los casos de uso y las reglas de negocio sin distracciones innecesarias.</p><li><p><strong>Creación de Pruebas Acorde a Casos de Uso y Reglas de Negocio:</strong> La flexibilidad inherente de la arquitectura hexagonal nos permite crear pruebas que se alinean directamente con los casos de uso y las reglas de negocio de nuestra aplicación. Esto garantiza que nuestras pruebas sean más precisas y relevantes, abordando de manera efectiva los aspectos críticos del sistema.</p><li><p><strong>Creación Sencilla de Mocks:</strong> En el entorno de pruebas unitarias, la necesidad de crear mocks es común. La arquitectura hexagonal simplifica este proceso, permitiéndonos generar mocks de componentes de forma sencilla. Esto facilita la simulación de escenarios específicos para validar el comportamiento del sistema.</p><li><p><strong>Mocks sin Acoplamiento con Tecnologías:</strong> La creación de mocks dentro de la arquitectura hexagonal se realiza de manera que no se acoplan con tecnologías específicas. Esto significa que nuestras pruebas unitarias no dependerán de detalles de implementación tecnológica, lo que las hace más robustas y menos propensas a fallos debido a cambios en el entorno tecnológico.</p></ul><p>Ahora, para ejemplificar los beneficios de la Clean Architecture, nos ayudaremos con <strong>Spotify-clone</strong>.</p><h2 id="ejemplo-con-el-microservicio-music-discovery-ms"><span class="mr-2">Ejemplo con el microservicio <code class="language-plaintext highlighter-rouge">music-discovery-ms</code></span><a href="#ejemplo-con-el-microservicio-music-discovery-ms" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nuestro ejemplo práctico se basa en el módulo <code class="language-plaintext highlighter-rouge">radio</code> de la aplicación <code class="language-plaintext highlighter-rouge">music-discovery-ms</code>, el microservicio encargado de descubrir nueva música para el usuario en nuestra <strong>Spotify-clone-architecture</strong>. Ahora nos centraremos en el caso de uso de <code class="language-plaintext highlighter-rouge">updateSongs</code>, el cual actualiza las canciones de una radio de Spotify (playlist de varios artistas con temática especial).</p><h3 id="arquitectura"><span class="mr-2">Arquitectura</span><a href="#arquitectura" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>La estructura del módulo <code class="language-plaintext highlighter-rouge">radio</code> de la aplicación <code class="language-plaintext highlighter-rouge">music-discovery-ms</code> es la siguiente:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre> radio
├──  application
│   ├──  dto
│   │   ├──  create-radio.dto.ts
│   │   ├──  update-songs-by-radio.dto.ts
│   │   └──  update-songs.dto.ts
│   ├──  radio.use-cases.spec.ts
│   └──  radio.use-cases.ts
├──  domain
│   ├──  model
│   │   ├──  radio.model.ts
│   │   └──  song.model.ts
│   └──  repositories
│       └──  radio.repository.ts
├──  infrastructure
│   ├──  mongo
│   │   ├──  repositories
│   │   │   └──  mongo-radio.repository.ts
│   │   └──  schemas
│   │       ├──  radio.schema.ts
│   │       └──  song.schema.ts
│   ├──  restful
│   │   └──  radio.controller.ts
│   └──  validate-model.ts
└──  radio.module.ts
</pre></table></code></div></div><ul><li><strong>Application</strong>: Casos de uso del módulo. También puede contener ciertas clases de tipo servicio.<li><strong>Domain</strong>: Modelo de entidades de dominio del módulo <code class="language-plaintext highlighter-rouge">radio</code>. El dominio se encarga de especificar el contrato o la especificación de las operaciones de persistencia de las entidades, mediante puertos (en este caso <code class="language-plaintext highlighter-rouge">radio.repository.ts</code>).<li><strong>Infraestructura</strong>: Todos los componentes de software que implementarán los adaptadores de las capas de dominio o aplicación. En este caso, tenemos el adaptador <code class="language-plaintext highlighter-rouge">mongo-radio.repository.ts</code>. Esta capa también contendrá los componentes de servicios como conexión a base de datos, servidor HTTP o cualquier otra dependencia tecnológica.</ul><h3 id="caso-de-uso-updatesongs"><span class="mr-2">Caso de uso <strong>updateSongs</strong></span><a href="#caso-de-uso-updatesongs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Aquí nos enfocaremos en el caso de uso de <code class="language-plaintext highlighter-rouge">updateSongs()</code>, el cual recibe un DTO <code class="language-plaintext highlighter-rouge">UpdateSongsByRadioDTO</code> que posee la id de la radio a actualizar y las canciones que se actualizarán de la radio.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/radio/application/radio.use-case.ts</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">RadioUseCases</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">RadioRepository</span><span class="p">)</span> <span class="p">{}</span>

    <span class="nx">create</span><span class="p">(</span><span class="nx">dto</span><span class="p">:</span> <span class="nx">CreateRadioDTO</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">dto</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">updateSongs</span><span class="p">(</span><span class="nx">dto</span><span class="p">:</span> <span class="nx">UpdateSongsByRadioDTO</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">findRadioById</span><span class="p">(</span><span class="nx">dto</span><span class="p">.</span><span class="nx">radioId</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">radio</span> <span class="o">=&gt;</span> <span class="nx">Radio</span><span class="p">.</span><span class="nx">updateSongs</span><span class="p">(</span><span class="nx">radio</span><span class="p">,</span> <span class="nx">dto</span><span class="p">.</span><span class="nx">songs</span><span class="p">))</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">radio</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateRadio</span><span class="p">(</span><span class="nx">radio</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">findAll</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findAll</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="p">@</span><span class="nd">NotFoundExceptionIfUndefined</span><span class="p">(</span><span class="dl">'</span><span class="s1">Radio no encontrada</span><span class="dl">'</span><span class="p">)</span>
    <span class="k">private</span> <span class="nx">findRadioById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="p">@</span><span class="nd">ValidateArgumentModel</span>
    <span class="k">private</span> <span class="k">async</span> <span class="nx">updateRadio</span><span class="p">(</span><span class="nx">radio</span><span class="p">:</span> <span class="nx">Radio</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">radio</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><h2 id="dominio"><span class="mr-2">Dominio</span><a href="#dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Las entidades del módulo son <code class="language-plaintext highlighter-rouge">Radio</code> y <code class="language-plaintext highlighter-rouge">Song</code>. Estas entidades utilizan la librería <code class="language-plaintext highlighter-rouge">class-validator</code> para validar el estado de sus valores. Si bien nos acoplamos a una librería de terceros, en este caso usar <code class="language-plaintext highlighter-rouge">class-validator</code> nos da más ventajas que desventajas, ya que las validaciones no tienen un acople fuerte gracias al patrón <code class="language-plaintext highlighter-rouge">@Decorator</code>, el cual agrega nuevas funcionalidades a los componentes sin tener que tocar el código principal de nuestras clases.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/radio/domain/model/radio.model.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Radio</span> <span class="p">{</span>

    <span class="p">@</span><span class="nd">IsUUID</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The ID of the radio</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The name of the radio</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsArray</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">({</span> <span class="na">each</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
    <span class="p">@</span><span class="nd">Type</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Songs of the radio</span><span class="dl">'</span><span class="p">,</span> <span class="na">type</span><span class="p">:[</span><span class="nx">Song</span><span class="p">]</span> <span class="p">})</span>
    <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[]</span>

    <span class="k">static</span> <span class="nx">create</span><span class="p">({</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">songs</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[]})</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">radio</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Radio</span><span class="p">()</span>
        <span class="nx">radio</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span>
        <span class="nx">radio</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span>
        <span class="nx">radio</span><span class="p">.</span><span class="nx">songs</span> <span class="o">=</span> <span class="nx">songs</span>
        <span class="k">return</span> <span class="nx">radio</span>
    <span class="p">}</span>
    
    <span class="k">static</span> <span class="nx">updateSongs</span><span class="p">(</span><span class="nx">radio</span><span class="p">:</span> <span class="nx">Radio</span><span class="p">,</span> <span class="nx">songs</span><span class="p">:</span> <span class="nx">Song</span><span class="p">[]):</span> <span class="nx">Radio</span> <span class="p">{</span>
        <span class="nx">radio</span><span class="p">.</span><span class="nx">songs</span> <span class="o">=</span> <span class="nx">songs</span>
        <span class="k">return</span> <span class="nx">radio</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="c1">// apps/music-discovery-ms/src/radio/domain/model/song.model.ts</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Song</span> <span class="p">{</span>

    <span class="p">@</span><span class="nd">IsUUID</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The ID of the song</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The title of the song</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">title</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The artist name of the song</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">artist</span><span class="p">:</span> <span class="kr">string</span>
    
    <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The album name of the song</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">album</span><span class="p">:</span> <span class="kr">string</span>

    <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">ApiProperty</span><span class="p">({</span> <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">The genre of the song</span><span class="dl">'</span> <span class="p">})</span>
    <span class="nx">genre</span><span class="p">:</span> <span class="kr">string</span>

    <span class="k">static</span> <span class="nx">create</span><span class="p">({</span><span class="nx">id</span><span class="p">,</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">artist</span><span class="p">,</span> <span class="nx">album</span><span class="p">,</span> <span class="nx">genre</span> <span class="p">}:</span> <span class="p">{</span> <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">title</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">artist</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">album</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">genre</span><span class="p">:</span> <span class="kr">string</span> <span class="p">}){</span>
        <span class="kd">const</span> <span class="nx">song</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Song</span><span class="p">()</span>
        <span class="nx">song</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span>
        <span class="nx">song</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">title</span>
        <span class="nx">song</span><span class="p">.</span><span class="nx">album</span> <span class="o">=</span> <span class="nx">album</span>
        <span class="nx">song</span><span class="p">.</span><span class="nx">artist</span> <span class="o">=</span> <span class="nx">artist</span>
        <span class="nx">song</span><span class="p">.</span><span class="nx">genre</span> <span class="o">=</span> <span class="nx">genre</span>
        <span class="k">return</span> <span class="nx">song</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><h3 id="puertos-del-dominio"><span class="mr-2">Puertos del dominio</span><a href="#puertos-del-dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Se ha definido el puerto <code class="language-plaintext highlighter-rouge">RadioRepository</code>, el cual describe las operaciones de persistencia.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/radio/domain/repositories/radio.repository.ts</span>
<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">RadioRepository</span> <span class="p">{</span>
    <span class="kd">abstract</span> <span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Radio</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Radio</span><span class="p">[]</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">save</span><span class="p">(</span><span class="nx">radio</span><span class="p">:</span> <span class="nx">Radio</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Radio</span><span class="o">&gt;</span>
    <span class="kd">abstract</span> <span class="nx">update</span><span class="p">(</span><span class="nx">radio</span><span class="p">:</span> <span class="nx">Radio</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Radio</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="infraestructura-del-módulo-radio"><span class="mr-2">Infraestructura del módulo <code class="language-plaintext highlighter-rouge">radio</code></span><a href="#infraestructura-del-módulo-radio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>La infraestructura está dada por un módulo de persistencia basado en <code class="language-plaintext highlighter-rouge">mongodb</code>, donde definimos el adaptador <code class="language-plaintext highlighter-rouge">MongoRadioRepository</code>, el cual hereda del puerto <code class="language-plaintext highlighter-rouge">RadioRepository</code> e implementa la lógica de persistencia asociada a la librería <code class="language-plaintext highlighter-rouge">mongoose</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/radio/infrastructure/mongo/repositories/mongo-radio.repository.ts</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">MongoRadioRepository</span> <span class="kd">extends</span> <span class="nx">RadioRepository</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(@</span><span class="nd">InjectModel</span><span class="p">(</span><span class="nx">RadioDocument</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">private</span> <span class="nx">model</span><span class="p">:</span> <span class="nx">Model</span><span class="o">&lt;</span><span class="nx">RadioDocument</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">save</span><span class="p">(</span><span class="nx">radio</span><span class="p">:</span> <span class="nx">Radio</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Radio</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">songs</span> <span class="o">=</span> <span class="nx">radio</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="p">({</span> 
            <span class="na">_id</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> 
            <span class="na">title</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> 
            <span class="na">album</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">album</span><span class="p">,</span>
            <span class="na">artist</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">artist</span><span class="p">,</span>
            <span class="na">genre</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">genre</span>
        <span class="p">}))</span>
        <span class="kd">const</span> <span class="nx">radioCreated</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">({</span>
            <span class="p">...</span><span class="nx">radio</span><span class="p">,</span>
            <span class="na">_id</span><span class="p">:</span> <span class="nx">radio</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="na">songs</span><span class="p">:</span> <span class="nx">songs</span>
        <span class="p">})</span>
        <span class="k">await</span> <span class="nx">radioCreated</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="nx">radio</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Radio</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">radioFound</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">Radio</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> 
            <span class="na">id</span><span class="p">:</span> <span class="nx">radioFound</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="na">name</span><span class="p">:</span> <span class="nx">radioFound</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="na">songs</span><span class="p">:</span> <span class="nx">radioFound</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> 
                <span class="na">id</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                <span class="na">title</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
                <span class="na">artist</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">artist</span><span class="p">,</span>
                <span class="na">album</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">album</span><span class="p">,</span>
                <span class="na">genre</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">genre</span>
            <span class="p">}))</span>
        <span class="p">})</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">findAll</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Radio</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">find</span><span class="p">()).</span><span class="nx">map</span><span class="p">(</span><span class="nx">doc</span> <span class="o">=&gt;</span> <span class="nx">Radio</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
            <span class="na">id</span><span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="na">name</span><span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="na">songs</span><span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> 
                <span class="na">id</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span>
                <span class="na">title</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
                <span class="na">artist</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">artist</span><span class="p">,</span>
                <span class="na">album</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">album</span><span class="p">,</span>
                <span class="na">genre</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">genre</span>
            <span class="p">}))</span>
        <span class="p">}))</span>
    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">update</span><span class="p">(</span><span class="nx">radio</span><span class="p">:</span> <span class="nx">Radio</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Radio</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">songs</span> <span class="o">=</span> <span class="nx">radio</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="p">({</span> 
            <span class="na">_id</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> 
            <span class="na">title</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span> 
            <span class="na">album</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">album</span><span class="p">,</span>
            <span class="na">artist</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">artist</span><span class="p">,</span>
            <span class="na">genre</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">genre</span>
        <span class="p">}))</span>
        <span class="kd">const</span> <span class="nx">radioUpdated</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">findByIdAndUpdate</span><span class="p">(</span><span class="nx">radio</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="p">...</span><span class="nx">radio</span><span class="p">,</span>
            <span class="nx">songs</span>
        <span class="p">},</span> <span class="p">{</span> <span class="na">new</span><span class="p">:</span> <span class="kc">true</span> <span class="p">})</span>
        
        <span class="k">return</span> <span class="nx">Radio</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> 
            <span class="na">id</span><span class="p">:</span> <span class="nx">radioUpdated</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
            <span class="na">name</span><span class="p">:</span> <span class="nx">radioUpdated</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="na">songs</span><span class="p">:</span> <span class="nx">radioUpdated</span><span class="p">.</span><span class="nx">songs</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">Song</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> 
                <span class="na">id</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
                <span class="na">title</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
                <span class="na">artist</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">artist</span><span class="p">,</span>
                <span class="na">album</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">album</span><span class="p">,</span>
                <span class="na">genre</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">genre</span>
            <span class="p">}))</span>
        <span class="p">})</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Finalmente, tenemos un módulo <code class="language-plaintext highlighter-rouge">restful</code> para crear nuestro servidor HTTP que expondrá nuestros casos de uso mediante una API REST.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/radio/infrastructure/restful/radio.controller.ts</span>

<span class="p">@</span><span class="nd">ApiTags</span><span class="p">(</span><span class="dl">'</span><span class="s1">Radios</span><span class="dl">'</span><span class="p">)</span>
<span class="p">@</span><span class="nd">Controller</span><span class="p">(</span><span class="dl">'</span><span class="s1">radios</span><span class="dl">'</span><span class="p">)</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">RadioController</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">radio</span><span class="p">:</span> <span class="nx">RadioUseCases</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="p">@</span><span class="nd">Put</span><span class="p">(</span><span class="dl">'</span><span class="s1">:id/songs</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">@</span><span class="nd">ApiOperation</span><span class="p">({</span> <span class="na">summary</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Add song to radio</span><span class="dl">"</span> <span class="p">})</span>
    <span class="p">@</span><span class="nd">ApiResponse</span><span class="p">({</span> <span class="na">status</span><span class="p">:</span> <span class="mi">201</span><span class="p">,</span> <span class="na">description</span><span class="p">:</span> <span class="dl">"</span><span class="s2">The song was added</span><span class="dl">"</span> <span class="p">})</span>
    <span class="nx">updateSongs</span><span class="p">(@</span><span class="nd">Param</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="nx">ParseUUIDPipe</span><span class="p">)</span> <span class="nx">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="p">@</span><span class="nd">Body</span><span class="p">()</span> <span class="nx">updateSongs</span><span class="p">:</span> <span class="nx">UpdateSongsDTO</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">radio</span><span class="p">.</span><span class="nx">updateSongs</span><span class="p">({</span> <span class="na">radioId</span><span class="p">:</span> <span class="nx">id</span><span class="p">,</span> <span class="p">...</span><span class="nx">updateSongs</span> <span class="p">})</span>
    <span class="p">}</span>
    <span class="c1">// other methods</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="definiendo-las-pruebas-unitarias"><span class="mr-2">Definiendo las pruebas unitarias</span><a href="#definiendo-las-pruebas-unitarias" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Definimos el siguiente set de pruebas:</p><ul><li><p><strong>Songs updated</strong>: Las canciones deben actualizarse.</p><li><p><strong>Throw NotFoundException if radio is not in database</strong>: Si tratamos de actualizar una radio que no existe, debe arrojar un <code class="language-plaintext highlighter-rouge">NotFoundException</code>.</p></ul><p>Archivo <code class="language-plaintext highlighter-rouge">radio.use-case.spec.ts</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="c1">// apps/music-discovery-ms/src/radio/application/radio.use-cases.spec.ts</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">NotFoundException</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/common</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RadioUseCases</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./radio.use-cases</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RadioRepository</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../domain/repositories/radio.repository</span><span class="dl">"</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">RadioUseCase</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="na">usecase</span><span class="p">:</span> <span class="nx">RadioUseCases</span>

    <span class="c1">// Prueba para verificar que se lance una NotFoundException si la radio no está en la base de datos.</span>
    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">updateSongs: throw NotFoundException if radio is not in database</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        
        <span class="c1">// Se crea un mock del repositorio con un método `findById` que devuelve undefined.</span>
        <span class="kd">const</span> <span class="nx">mockRepository</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">findById</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockReturnValue</span><span class="p">(</span><span class="kc">undefined</span><span class="p">),</span>
            <span class="na">save</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
            <span class="na">update</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
            <span class="na">findAll</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nx">usecase</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RadioUseCases</span><span class="p">(</span><span class="nx">mockRepository</span><span class="p">)</span>

        <span class="c1">// Se define un objeto para actualizar las canciones de una radio inexistente.</span>
        <span class="kd">const</span> <span class="nx">updateSongs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">radioId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A48BCD55-B248-4377-8BCD-E9687768BA07</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">songs</span><span class="p">:</span> <span class="p">[{</span>
                <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A48BCD55-B248-4377-8BCD-E9687768BA07</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">runaway</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">album</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bonjovi</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">artist</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bonjovi</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">genre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rock</span><span class="dl">"</span>
            <span class="p">}]</span>
        <span class="p">}</span>
        <span class="c1">// Se espera que llamar al método `updateSongs` lance una NotFoundException.</span>
        <span class="k">await</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">usecase</span><span class="p">.</span><span class="nx">updateSongs</span><span class="p">(</span><span class="nx">updateSongs</span><span class="p">)).</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="nx">NotFoundException</span><span class="p">);</span>

    <span class="p">})</span>

    <span class="c1">// Prueba para verificar que las canciones se actualizan correctamente en una radio existente.</span>
    <span class="nx">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">updateSongs: songs updated</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Se crea un mock del repositorio con un método `findById` que devuelve información de una radio existente.</span>
        <span class="kd">const</span> <span class="na">mockRepository</span><span class="p">:</span> <span class="nx">RadioRepository</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">findById</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockReturnValue</span><span class="p">({</span>
                <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">A48BCD55-B248-4377-8BCD-E9687768BA07</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rock radio</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">songs</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}),</span>
            <span class="na">save</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
            <span class="na">update</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
            <span class="na">findAll</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nx">usecase</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RadioUseCases</span><span class="p">(</span><span class="nx">mockRepository</span><span class="p">)</span>

        <span class="c1">// Se define un objeto para actualizar las canciones de una radio existente.</span>
        <span class="kd">const</span> <span class="nx">updateSongs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">radioId</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A48BCD55-B248-4377-8BCD-E9687768BA07</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">songs</span><span class="p">:</span> <span class="p">[{</span>
                <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">A48BCD55-B248-4377-8BCD-E9687768BA07</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">title</span><span class="p">:</span> <span class="dl">"</span><span class="s2">runaway</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">album</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bonjovi</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">artist</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bonjovi</span><span class="dl">"</span><span class="p">,</span>
                <span class="na">genre</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rock</span><span class="dl">"</span>
            <span class="p">}]</span>
        <span class="p">}</span>
        <span class="k">await</span> <span class="nx">usecase</span><span class="p">.</span><span class="nx">updateSongs</span><span class="p">(</span><span class="nx">updateSongs</span><span class="p">)</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockRepository</span><span class="p">.</span><span class="nx">update</span><span class="p">).</span><span class="nx">toBeCalledTimes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">})</span>
</pre></table></code></div></div><p>Este set de pruebas nos garantizará el comportamiento de nuestro caso de uso. Ahora, si analizamos el siguiente código:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// Se crea un mock del repositorio con un método `findById` que devuelve undefined.</span>
<span class="kd">const</span> <span class="nx">mockRepository</span><span class="p">:</span> <span class="nx">RadioRepository</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">findById</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">().</span><span class="nx">mockReturnValue</span><span class="p">(</span><span class="kc">undefined</span><span class="p">),</span>
    <span class="na">save</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
    <span class="na">update</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">(),</span>
    <span class="na">findAll</span><span class="p">:</span> <span class="nx">jest</span><span class="p">.</span><span class="nx">fn</span><span class="p">()</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Hemos creado el mock de <code class="language-plaintext highlighter-rouge">RadioRepository</code> con el contrato específico para las operaciones de persistencia. Si en vez de crear <code class="language-plaintext highlighter-rouge">RadioRepository</code> hubiéramos hecho uso de las clases proporcionadas directamente por la librería de MongoDB como en este ejemplo:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">// model: Model&lt;RadioDocument&gt; componente complejo de crear un Mock por su gran cantidad de metodos que dependiendo de neustro caso de uso usaremos unos pocos.</span>
<span class="kd">constructor</span><span class="p">(@</span><span class="nd">InjectModel</span><span class="p">(</span><span class="nx">RadioDocument</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="k">private</span> <span class="nx">model</span><span class="p">:</span> <span class="nx">Model</span><span class="o">&lt;</span><span class="nx">RadioDocument</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p>El mock no sería sencillo, ya que estos componentes de tipo repositorio vienen con un montón de métodos que no nos aportan nada en el contexto de casos de uso o reglas de negocio que queramos probar. Para crear pruebas unitarias de forma limpia y sencilla, solo debemos probar las partes de forma aislada y, dependiendo del caso, definir el comportamiento específico del mock.</p><p>Y ahora, gracias a la inyección de dependencias, podemos crear nuestro Caso de uso <code class="language-plaintext highlighter-rouge">RadioUseCases</code>:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">usecase</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RadioUseCases</span><span class="p">(</span><span class="nx">mockRepository</span><span class="p">)</span>
</pre></table></code></div></div><p>Este enfoque nos permite no tener que usar las dependencias o componentes de testing que nos ofrece NestJs, ya que estos nos generarían un montón de boilerplate en testing unitario.</p><p>Si quieres ejecutar las pruebas unitarias, ejecuta lo siguiente:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm run <span class="nb">test</span>
</pre></table></code></div></div><h2 id="conclusión"><span class="mr-2">Conclusión</span><a href="#conclusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Al dar un pequeño vistazo a un set de pruebas unitarias sobre una arquitectura limpia, examinamos las ventajas, simplicidad, elegancia y desacople del código en aspectos más de infraestructura como pueden ser HTTP, MongoDB, Nestjs o cualquier otro componente tecnológico. Este enfoque nos asegura crear un código más mantenible y escalable.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/microservices-architecture-nestjs/">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/img/memes/meme-test.webp" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/arquitectura/'>Arquitectura</a>, <a href='//categories/software-testing/'>Software,Testing</a>, <a href='//categories/unitario-arquitectura/'>Unitario,Arquitectura</a>, <a href='//categories/hexagonal/'>Hexagonal</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/arquitectura/" class="post-tag no-text-decoration" >arquitectura</a> <a href="//tags/software-testing/" class="post-tag no-text-decoration" >software,testing</a> <a href="//tags/unitario-hexagonal/" class="post-tag no-text-decoration" >unitario,hexagonal</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Simplificando+el+testing+unitario+con+arquitectura+hexagonal+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fsimplificando-el-testing-unitario-con-arquitectura-hexagonal%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Simplificando+el+testing+unitario+con+arquitectura+hexagonal+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fsimplificando-el-testing-unitario-con-arquitectura-hexagonal%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fsimplificando-el-testing-unitario-con-arquitectura-hexagonal%2F&text=Simplificando+el+testing+unitario+con+arquitectura+hexagonal+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fsimplificando-el-testing-unitario-con-arquitectura-hexagonal%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/5-Arquitecturas-de-software-para-tigres-del-codigo/"><div class="card-body"> <em class="small" data-ts="1662977400" data-df="YYYY-MM-DD" > 2022-09-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>5 Arquitecturas de software para tigres del código</h3><div class="text-muted small"><p> 5 arquitecturas de software para proyectos serios Cuando iniciamos a crear nuestros proyectos lo primero que nos enseñaron fue el patrón MVC o la arquitectura por capas con el tiempo Todos los pro...</p></div></div></a></div><div class="card"> <a href="/posts/arquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion/"><div class="card-body"> <em class="small" data-ts="1707714000" data-df="YYYY-MM-DD" > 2024-02-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitecturas EDA Eventos de dominio vs eventos de integración</h3><div class="text-muted small"><p> La comunicación asíncrona entre microservicios nos ayuda a crear procesos complejos donde las responsabilidades del sistema están repartidas entre distintas aplicaciones. Como es la filosofía de ...</p></div></div></a></div><div class="card"> <a href="/posts/sagas-i-transacciones-distribuidas-con-patrones-saga/"><div class="card-body"> <em class="small" data-ts="1710133200" data-df="YYYY-MM-DD" > 2024-03-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Sagas I - Transacciones Distribuidas Con Patrones Saga</h3><div class="text-muted small"><p> Transacciones centralizadas vs distribuidas Las aplicaciones monolíticas tienen la ventaja de poder crear procesos transaccionales de forma sencilla. Las transacciones nos ayudan a mantener la c...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/simplificando-el-testing-e2e-con-object-mother/" class="btn btn-outline-primary" prompt="Anterior"><p>Simplificando el Testing e2e con Object Mother</p></a> <a href="//posts/arquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion/" class="btn btn-outline-primary" prompt="Nuevo"><p>Arquitecturas EDA Eventos de dominio vs eventos de integración</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
