<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Patrones de resiliencia" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/patrones-de-resiliencia/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/patrones-de-resiliencia/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-05-09T01:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Patrones de resiliencia" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2024-05-09T01:00:00-04:00","datePublished":"2024-05-09T01:00:00-04:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Patrones de resiliencia","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/patrones-de-resiliencia/"},"url":"https://nullpointer-excelsior.github.io/posts/patrones-de-resiliencia/"}</script><title>Patrones de resiliencia | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Patrones de resiliencia</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Patrones de resiliencia</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1715230800" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2024-05-09 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1274 palabras"> <em>7 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/intros/intro6.webp" alt="intro" data-proofer-ignore></p><h2 id="qué-es-la-resiliencia"><span class="mr-2">¿Qué es la resiliencia?</span><a href="#qué-es-la-resiliencia" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>La resiliencia es la capacidad de un sistema de poder recuperarse de un escenario adverso. En el desarrollo de software, podemos aplicar este concepto para crear aplicaciones robustas, las cuales sean capaces de manejar errores sin comprometer el sistema entero.</p><p>Los patrones de resiliencia son sencillos de entender e implementar con ayuda de la programación reactiva. A continuación, veremos los patrones más usados tanto en sistemas críticos como en procesos sencillos que, si bien pueden fallar y aislar el problema, un sistema resiliente hará todo lo posible para recuperarse antes de arrojar el error a una capa superior del sistema.</p><h3 id="timeout"><span class="mr-2">Timeout</span><a href="#timeout" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Este patrón define un tiempo límite de una petición. Esto nos ayuda a eliminar latencias grandes donde el sistema dará la impresión de estar pegado o cargando infinitamente. Generalmente, se usa en peticiones HTTP donde, cuando se cumpla un tiempo límite, nos indicará que este servicio está fallando.</p><h3 id="retry"><span class="mr-2">Retry</span><a href="#retry" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Retry nos permite reintentar una petición cuando esta falla. Generalmente, un reintento viene con un tiempo de espera antes de volver a realizar la petición y generalmente se define un número finito de reintentos para no llegar a crear un loop infinito de peticiones fallidas.</p><h3 id="fallback"><span class="mr-2">Fallback</span><a href="#fallback" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Este patrón nos permite definir una respuesta por defecto cuando el servicio o petición falla. Nos ayuda a no romper el sistema por arrojar alguna excepción o error. Se utiliza en peticiones que su respuesta no representa algo crítico en el proceso principal. Un ejemplo sería cuando nuestra aplicación de Spotify no encuentra las letras de alguna canción y este servicio responde simplemente con un texto de “letras no encontradas”.</p><h2 id="las-aplicaciones-robustas-utilizan-una-combinación-de-estos-patrones"><span class="mr-2">Las aplicaciones robustas utilizan una combinación de estos patrones</span><a href="#las-aplicaciones-robustas-utilizan-una-combinación-de-estos-patrones" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Estos sencillos patrones son fáciles de implementar, pero la complejidad crece cuando queremos combinarlos entre sí, ya que este escenario planteado es más probable de encontrar en desarrollos serios.</p><h3 id="cómo-podemos-implementar-la-resiliencia-de-forma-elegante"><span class="mr-2">¿Cómo podemos implementar la resiliencia de forma elegante?</span><a href="#cómo-podemos-implementar-la-resiliencia-de-forma-elegante" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Cuando hablamos de combinar o componer funcionalidades, podemos hacer uso de la programación funcional, donde cada patrón sería una función y, si queremos combinarlas, nos ayudamos de la composición de funciones o funciones de orden superior. En este caso, usaremos RxJS, una librería de JavaScript que nos permite trabajar con flujos de datos de manera reactiva e implementa en su corazon la programación funcional.</p><h3 id="paradigma-reactivo"><span class="mr-2">Paradigma reactivo</span><a href="#paradigma-reactivo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>El paradigma reactivo combina la programación funcional, la comunicación mediante eventos y el trato de los datos mediante un flujo. Una de las características de la programación reactiva que impulsa es la resiliencia, es por eso que aplicaremos los patrones antes vistos de manera sencilla con RxJS.</p><h3 id="entendiendo-los-observables"><span class="mr-2">Entendiendo los observables</span><a href="#entendiendo-los-observables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Un observable es un componente que emite un valor y podemos suscribirnos para escuchar los cambios de este flujo. Bajo esta definición, podremos crear un observable que escuchara las peticiones y podremos aplicar resiliencia.</p><p>Ejemplo de observable:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Creamos un observable que emite un array de números del 1 al 5</span>
<span class="kd">const</span> <span class="nx">observable$</span> <span class="o">=</span> <span class="k">of</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>

<span class="c1">// Nos suscribimos al observable para escuchar los cambios en el flujo de datos</span>
<span class="nx">observable$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="c1">// La función next se ejecuta cuando se emite un nuevo valor en el observable</span>
    <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span>
    <span class="c1">// La función error se ejecuta cuando ocurre un error en el observable</span>
    <span class="na">error</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">),</span>
    <span class="c1">// La función complete se ejecuta cuando el observable ha completado su emisión de valores</span>
    <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">complete</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>

</pre></table></code></div></div><p>Ya explicada la base de Rxjs, podemos implementar los patrones de resiliencia de manera sencilla. En el siguiente ejemplo, crearemos una función que agregará resiliencia a un Observable. La función tomará un Observable y devolverá una nueva función que tomará un objeto de opciones de resiliencia. Las opciones incluirán un tiempo de espera, un número de reintentos y un valor de respaldo opcional.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span><span class="p">,</span> <span class="nx">catchError</span><span class="p">,</span> <span class="nx">iif</span><span class="p">,</span> <span class="k">of</span><span class="p">,</span> <span class="nx">retry</span><span class="p">,</span> <span class="nx">throwError</span><span class="p">,</span> <span class="nx">timeout</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">rxjs</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">ResilenceOptions</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">timeout</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
    <span class="na">retry</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">count</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
        <span class="na">delay</span><span class="p">:</span> <span class="kr">number</span>
    <span class="p">},</span>
    <span class="nx">fallback</span><span class="p">?:</span> <span class="nx">T</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">addResilence</span><span class="o">&lt;</span><span class="nx">T</span> <span class="o">=</span> <span class="kr">any</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">source$</span><span class="p">:</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="o">&lt;</span><span class="nx">T</span> <span class="o">=</span> <span class="kr">any</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">options</span><span class="p">:</span> <span class="nx">ResilenceOptions</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="p">{</span> <span class="na">timeout</span><span class="p">:</span> <span class="nx">timeoutMilliseconds</span><span class="p">,</span> <span class="na">retry</span><span class="p">:</span> <span class="nx">retryOptions</span><span class="p">,</span> <span class="nx">fallback</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">source$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
            <span class="nx">timeout</span><span class="p">({</span>
                <span class="na">each</span><span class="p">:</span> <span class="nx">timeoutMilliseconds</span><span class="p">,</span>
            <span class="p">}),</span>
            <span class="nx">retry</span><span class="p">({</span>
                <span class="na">count</span><span class="p">:</span> <span class="nx">retryOptions</span><span class="p">.</span><span class="nx">count</span><span class="p">,</span>
                <span class="na">delay</span><span class="p">:</span> <span class="nx">retryOptions</span><span class="p">.</span><span class="nx">delay</span>
            <span class="p">}),</span>
            <span class="nx">catchError</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">iif</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">fallback</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">,</span> <span class="k">of</span><span class="p">(</span><span class="nx">fallback</span><span class="p">),</span> <span class="nx">throwError</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">err</span><span class="p">)))</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Este código define una función <code class="language-plaintext highlighter-rouge">addResilence</code> que agrega resiliencia a un Observable. La función <code class="language-plaintext highlighter-rouge">addResilence</code> toma un Observable <code class="language-plaintext highlighter-rouge">source$</code> y devuelve una función que toma un objeto de opciones <code class="language-plaintext highlighter-rouge">ResilenceOptions</code>. Las opciones incluyen un tiempo de espera <code class="language-plaintext highlighter-rouge">timeout</code>, un objeto de reintento <code class="language-plaintext highlighter-rouge">retry</code> con un conteo y un retraso, y un valor de respaldo opcional <code class="language-plaintext highlighter-rouge">fallback</code>.</p><p>La función devuelta configura el Observable para que se agote después de un cierto tiempo de espera <code class="language-plaintext highlighter-rouge">timeout</code>, que se reintente un número específico de veces con un cierto retraso <code class="language-plaintext highlighter-rouge">retry</code>, y que, en caso de error, devuelva el valor de respaldo si se proporciona uno <code class="language-plaintext highlighter-rouge">fallback</code>, o lance el error si no se proporciona un valor de respaldo.</p><p>El operador <code class="language-plaintext highlighter-rouge">catchError</code> se utiliza para manejar los errores que pueden ocurrir durante la ejecución del Observable. Si se proporciona un valor de respaldo, se devuelve un Observable del valor de respaldo. Si no se proporciona un valor de respaldo, se lanza el error.</p><h2 id="ejemplos-concretos"><span class="mr-2">Ejemplos concretos</span><a href="#ejemplos-concretos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Implementaremos los siguientes ejemplos:</p><ul><li><strong>Fallback sobre errores:</strong> Simularemos un error controlado y manejaremos el error con un valor de respaldo<li><strong>Timeout y reintentos:</strong> Simularemos una operación con un tiempo de espera y reintentos</ul><p>Definiremos las opciones de resilencia para todos los ejemplos:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">options</span><span class="p">:</span> <span class="nx">ResilenceOptions</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">timeout</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="na">retry</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">count</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="na">delay</span><span class="p">:</span> <span class="mi">3000</span>
    <span class="p">},</span>
    <span class="na">fallback</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Ops, something went wrong</span><span class="dl">"</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="fallback-para-tratar-errores"><span class="mr-2">Fallback para tratar errores</span><a href="#fallback-para-tratar-errores" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Crearemos la siguiente función que simula un error</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">failedRequest$</span> <span class="o">=</span> <span class="nx">throwError</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">throwing a controlled error 😨</span><span class="dl">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">controlled error</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>
</pre></table></code></div></div><p>Ahora al agregar la resilencia al observable <code class="language-plaintext highlighter-rouge">failedRequest$</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">fallbackRequest</span> <span class="o">=</span> <span class="nx">addResilence</span><span class="p">(</span><span class="nx">failedRequest$</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">fallbackObservable$</span> <span class="o">=</span> <span class="nx">fallbackRequest</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

<span class="nx">fallbackObservable$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`fallback-response: </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span><span class="s2">`</span><span class="p">),</span>
    <span class="na">error</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`resilence-error: </span><span class="p">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">error</span><span class="p">),</span>
<span class="p">})</span>
</pre></table></code></div></div><p>Recibiremos la siguiente salida:</p><p><img data-src="/assets/img/examples/resilence-ex1.webp" alt="ex1" data-proofer-ignore></p><h3 id="timeout-y-reintentos"><span class="mr-2">Timeout y reintentos</span><a href="#timeout-y-reintentos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Para simular una operación con timeot, creamos el siguiente observable:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">intent</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kd">const</span> <span class="nx">calculateDelay</span> <span class="o">=</span> <span class="p">(</span><span class="nx">intent</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">intent</span> <span class="o">===</span> <span class="mi">3</span> <span class="p">?</span> <span class="mi">100</span> <span class="p">:</span> <span class="mi">3000</span>

<span class="kd">const</span> <span class="nx">retriedRequest$</span> <span class="o">=</span> <span class="k">from</span><span class="p">(</span><span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()).</span><span class="nx">pipe</span><span class="p">(</span>
    <span class="nx">tap</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">intent</span><span class="o">++</span><span class="p">),</span>
    <span class="nx">tap</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">intent</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`executing retry number: </span><span class="p">${</span><span class="nx">intent</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    <span class="p">}),</span>
    <span class="nx">switchMap</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">of</span><span class="p">(</span><span class="dl">"</span><span class="s2">Retry example 🧐</span><span class="dl">"</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">delay</span><span class="p">(</span><span class="nx">calculateDelay</span><span class="p">(</span><span class="nx">intent</span><span class="p">))))</span>
<span class="p">);</span>
</pre></table></code></div></div><p>Y al observable <code class="language-plaintext highlighter-rouge">retriedRequest$</code> le agregamos resilencia</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">retryRequest</span> <span class="o">=</span> <span class="nx">addResilence</span><span class="p">(</span><span class="nx">retriedRequest$</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">retryObservable$</span> <span class="o">=</span> <span class="nx">retryRequest</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

<span class="nx">retryObservable$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`retry-response: </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span><span class="s2">`</span><span class="p">),</span>
    <span class="na">error</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`resilence-error: </span><span class="p">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">error</span><span class="p">),</span>
<span class="p">})</span>

</pre></table></code></div></div><p>Obtendremos la siguiente salida:</p><p><img data-src="/assets/img/examples/resilence-ex2.webp" alt="ex2" data-proofer-ignore></p><p>Y si queremos simular una operacion sin errores lo hacemos así:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>
<span class="kd">const</span> <span class="nx">successRequest$</span> <span class="o">=</span> <span class="k">of</span><span class="p">(</span><span class="dl">'</span><span class="s1">success request 😎</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">successRequest</span> <span class="o">=</span> <span class="nx">addResilence</span><span class="p">(</span><span class="nx">successRequest$</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">successObservable$</span> <span class="o">=</span> <span class="nx">successRequest</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>

<span class="nx">successObservable$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">`success-response: </span><span class="p">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span><span class="s2">`</span><span class="p">),</span>
    <span class="na">error</span><span class="p">:</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">logger</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`resilence-error: </span><span class="p">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">error</span><span class="p">),</span>
<span class="p">})</span>
</pre></table></code></div></div><p><img data-src="/assets/img/examples/resilence-ex3.webp" alt="ex3" data-proofer-ignore></p><h2 id="conclusiones"><span class="mr-2">Conclusiones</span><a href="#conclusiones" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Los patrones de resiliencia nos permiten crear aplicaciones robustas y preparadas para actuar ante cualquier error o intermitencia que algun servicio u operacion presente en el flujo de una aplicacion. RXjs nos provee una manera adecuada de tratar flujos complejos con la posibilidad de extender las capacidades actuales de un codigo basado en el paradigma reactivo</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/advanced-design-patterns-with-typescript/tree/master/src/resilience">Github Repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="meme-de-regalo"><span class="mr-2">Meme de regalo</span><a href="#meme-de-regalo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/img/memes/meme4.webp" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/arquitectura/'>Arquitectura</a>, <a href='//categories/software/'>Software,</a>, <a href='//categories/microservicios/'>Microservicios,</a>, <a href='//categories/patrones/'>Patrones,</a>, <a href='//categories/programacion/'>Programacion,</a>, <a href='//categories/software/'>Software</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/arquitectura/" class="post-tag no-text-decoration" >arquitectura</a> <a href="//tags/software/" class="post-tag no-text-decoration" >software,</a> <a href="//tags/microservicios/" class="post-tag no-text-decoration" >microservicios,</a> <a href="//tags/patrones/" class="post-tag no-text-decoration" >patrones,</a> <a href="//tags/programacion/" class="post-tag no-text-decoration" >programacion,</a> <a href="//tags/software/" class="post-tag no-text-decoration" >software</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Patrones+de+resiliencia+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fpatrones-de-resiliencia%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Patrones+de+resiliencia+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fpatrones-de-resiliencia%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fpatrones-de-resiliencia%2F&text=Patrones+de+resiliencia+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fpatrones-de-resiliencia%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/microservicios-1-construyendo-aplicaciones-escalables-y-mantenibles/"><div class="card-body"> <em class="small" data-ts="1698382800" data-df="YYYY-MM-DD" > 2023-10-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MicroServicios 1 Construyendo aplicaciones escalables y mantenibles</h3><div class="text-muted small"><p> En este capítulo tomaremos nota de pequeños tips para generar aplicaciones escalables y mantenibles, las cuales podrán ayudarte de manera más sencilla en una posible transición de monolito a micr...</p></div></div></a></div><div class="card"> <a href="/posts/sagas-i-transacciones-distribuidas-con-patrones-saga/"><div class="card-body"> <em class="small" data-ts="1710133200" data-df="YYYY-MM-DD" > 2024-03-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Sagas I - Transacciones Distribuidas Con Patrones Saga</h3><div class="text-muted small"><p> Transacciones centralizadas vs distribuidas Las aplicaciones monolíticas tienen la ventaja de poder crear procesos transaccionales de forma sencilla. Las transacciones nos ayudan a mantener la c...</p></div></div></a></div><div class="card"> <a href="/posts/5-Arquitecturas-de-software-para-tigres-del-codigo/"><div class="card-body"> <em class="small" data-ts="1662977400" data-df="YYYY-MM-DD" > 2022-09-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>5 Arquitecturas de software para tigres del código</h3><div class="text-muted small"><p> 5 arquitecturas de software para proyectos serios Cuando iniciamos a crear nuestros proyectos lo primero que nos enseñaron fue el patrón MVC o la arquitectura por capas con el tiempo Todos los pro...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/sagas-i-transacciones-distribuidas-con-patrones-saga/" class="btn btn-outline-primary" prompt="Anterior"><p>Sagas I - Transacciones Distribuidas Con Patrones Saga</p></a> <a href="//posts/repository-pattern-simple-escalable-y-para-todo-tipo-de-proyectos/" class="btn btn-outline-primary" prompt="Nuevo"><p>Repository pattern simple escalable y para todo tipo de proyectos</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
