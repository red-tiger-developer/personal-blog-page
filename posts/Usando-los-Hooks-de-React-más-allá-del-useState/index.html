<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Usando los Hooks de React más allá del useState" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Usando los Hooks de React más allá del useState" /><meta property="og:description" content="Usando los Hooks de React más allá del useState" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/Usando-los-Hooks-de-React-m%C3%A1s-all%C3%A1-del-useState/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/Usando-los-Hooks-de-React-m%C3%A1s-all%C3%A1-del-useState/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-21T20:32:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Usando los Hooks de React más allá del useState" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2022-09-21T20:32:00-03:00","datePublished":"2022-09-21T20:32:00-03:00","description":"Usando los Hooks de React más allá del useState","headline":"Usando los Hooks de React más allá del useState","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/Usando-los-Hooks-de-React-m%C3%A1s-all%C3%A1-del-useState/"},"url":"https://nullpointer-excelsior.github.io/posts/Usando-los-Hooks-de-React-m%C3%A1s-all%C3%A1-del-useState/"}</script><title>Usando los Hooks de React más allá del useState | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Usando los Hooks de React más allá del useState</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Usando los Hooks de React más allá del useState</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1663803120" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-09-21 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4598 palabras"> <em>25 min</em> de lectura</span></div></div></div><div class="post-content"><h1 id="usando-los-hooks-de-react-más-allá-del-usestate">Usando los Hooks de React más allá del useState</h1><h3 id="hack-1---petición-asíncrona-con-usestate-y-useeffect-juntos"><span class="mr-2">Hack 1 - Petición asíncrona con useState() y useEffect() juntos</span><a href="#hack-1---petición-asíncrona-con-usestate-y-useeffect-juntos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>El siguiente componente muestra los datos obtenidos mediante una operación asíncrona como lo puede ser una petición hacia alguna API.</p><p>Se define el Hook useState() para almacenar el estado del componente y se define el Hook useEffect() para poder implementar la lógica de actualización del estado. useEffect() recibe una función la cual será la operación deseada a realizar y recibe un array de dependencias el cual si cualquier valor del array cambia el Hook se gatilla y ejecuta la función definida. Como no existe aún alguna dependencia debemos agregar un array vacio, ya que de lo contrario el Hook no funcionara correctamente.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">getPieChartData</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../core/application/getPieChartData</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PieChartData</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../core/domain/model/PieChartData</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">PieChart</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../components/PieChart</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">PieChartFromAPI</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="kd">const</span> <span class="p">[</span><span class="nx">data</span><span class="p">,</span> <span class="nx">setData</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">PieChartData</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">getPieChartData</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">pieChart</span> <span class="o">=&gt;</span> <span class="nx">setData</span><span class="p">(</span><span class="nx">pieChart</span><span class="p">))</span>
    <span class="p">},</span> <span class="p">[])</span>

    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">PieChart</span> <span class="nx">data</span><span class="o">=</span><span class="p">{</span><span class="nx">data</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Falsearemos la petición asíncrona con un retraso de 1 segundo con la siguiente función.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">awaitTimeout</span> <span class="o">=</span> <span class="p">(</span><span class="nx">delay</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">delay</span><span class="p">));</span>
</pre></table></code></div></div><p>Crearemos nuestra función que simula una API.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PieChartData</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../domain/model/PieChartData</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">awaitTimeout</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../libs/awaitTimeout</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">PIE_DATA</span><span class="p">:</span> <span class="nx">PieChartData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">labels</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Red</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Blue</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Yellow</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Green</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Purple</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Orange</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">datasets</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="na">label</span><span class="p">:</span> <span class="dl">'</span><span class="s1"># of Votes</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">data</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="na">backgroundColor</span><span class="p">:</span> <span class="p">[</span>
                <span class="dl">'</span><span class="s1">rgba(255, 99, 132, 0.2)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(54, 162, 235, 0.2)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(255, 206, 86, 0.2)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(75, 192, 192, 0.2)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(153, 102, 255, 0.2)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(255, 159, 64, 0.2)</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="na">borderColor</span><span class="p">:</span> <span class="p">[</span>
                <span class="dl">'</span><span class="s1">rgba(255, 99, 132, 1)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(54, 162, 235, 1)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(255, 206, 86, 1)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(75, 192, 192, 1)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(153, 102, 255, 1)</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">rgba(255, 159, 64, 1)</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="na">borderWidth</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">],</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">getPieChartData</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">PieChartData</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">awaitTimeout</span><span class="p">(</span><span class="mi">1200</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">PIE_DATA</span><span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Nuestra aplicación funciona perfecto, pero esa demora implementada debemos hacerla notar mediante un aviso para nuestros usuarios agregaremos un nuevo estado de la siguiente manera.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>

    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="nx">getPieChartData</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">pieChart</span> <span class="o">=&gt;</span> <span class="nx">setData</span><span class="p">(</span><span class="nx">pieChart</span><span class="p">))</span>
            <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
    <span class="p">},</span> <span class="p">[])</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span><span class="nx">Loading</span> <span class="nx">motherfucking</span> <span class="nx">data</span><span class="p">...</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">}</span>

</pre></table></code></div></div><p>Perfecto muchachos hemos usado esta pareja explosiva con un ejemplo práctico que de seguro los verás muy a menudo, ahora te haré la siguiente pregunta ¿qué pasaría si necesitamos manejar estados más complejos? ¿Qué pasaría si nuestro componente tiene una gran cantidad de valores, objetos primitivos o arreglos, y por último ¿y si un valor dependiera de otro? La solución simple es usar un objeto con useState() pero no siempre será la mejor solución especialmente cuando React usa el concepto de inmutabilidad para realizar los renderizados de componentes un objeto o un arreglo en Javascript no es un objeto completamente inmutable y debes tener ciertas precauciones cuando actualizas un arreglo o un objeto para que se gatille un useEffect() o un renderizado. Bueno en el siguiente ejemplo emplearemos el mismo ejemplo despachamos para la casa a useState() y le daremos la bienvenida a useReducer() te parece conocido el nombre verdad si has usado Redux o la función reducer sabrás de lo que hablo</p><h2 id="hack-2----petición-asíncrona-con-usereducer-y-useeffect"><span class="mr-2">Hack 2 - Petición asíncrona con useReducer y useEffect</span><a href="#hack-2----petición-asíncrona-con-usereducer-y-useeffect" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Tomando como base el hack anterior vamos a reemplazar el Hook useState() por useReducer() y usando sus valores como estado para mostrar los datos del gráfico del ejemplo anterior agregaremos unos cuantos valores más para poder ver el patrón reducer el cual lo podemos encontrar en aplicaciones con manejo de estado mediante Redux.</p><h3 id="como-diablos-funciona-el-patron-reducer"><span class="mr-2">Como diablos funciona el patron reducer</span><a href="#como-diablos-funciona-el-patron-reducer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>EL patrón reducer básicamente es definir una función reductora la cual recibe el estado actual de los datos y el nuevo estado que queremos definir entonces nuestra función reductora puede definir cálculos o lógicas a partir de estos 2 valores y retornar un nuevo estado. Si vamos a la programación funcional el típico ejemplo es sumar el valor anterior y el nuevo valor para generar una sumatoria entonces el resultado sería un acumulado de los datos. Ahora veamos como se implementa en React. En React el Hook useReducer() recibe una función reductora la cual recibe 2 parámetros el estado actual del componente y un acción el cual tiene las siguientes propiedades type y payload donde type es un nombre de acción único nos dice que debe hacer el reducer y por último payload sería el nuevo estado o valores que usara nuestra función reductora. Lo sé esto suena enredado, pero vamos al maldito ejemplo.</p><p>Definiremos el modelo de nuestro reducer.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="c1">// estado del componente</span>
<span class="kr">interface</span> <span class="nx">State</span> <span class="p">{</span>
    <span class="nl">title</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">data</span><span class="p">:</span> <span class="nx">PieChartData</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nl">quantity</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">loading</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// modelo de la accion</span>
<span class="kr">interface</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="nx">Type</span><span class="p">;</span>
    <span class="nl">payload</span><span class="p">?:</span> <span class="kr">any</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// tipos de aciones que puede realizar nuestra funcion reductora</span>
<span class="kr">enum</span> <span class="nx">Type</span> <span class="p">{</span>
    <span class="nx">SET_DATA</span><span class="p">,</span>
    <span class="nx">LOADING</span><span class="p">,</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Muy bien ahora esta es la implementación de la función reductora:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">Type</span><span class="p">.</span><span class="na">LOADING</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
                <span class="na">loading</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="nx">Type</span><span class="p">.</span><span class="na">SET_DATA</span><span class="p">:</span>
            <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
                <span class="na">data</span><span class="p">:</span> <span class="nx">payload</span><span class="p">,</span>
                <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> 
                <span class="na">quantity</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Como ves la función recibe el estado y una acción entonces mediante un case realizaremos operaciones sobre el estado anterior y el payload suministrado como puedes apreciar no siempre necesitaremos definir un payload.</p><p>Ahora llamaremos el hook useReducer() de la siguiente manera</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span>  <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span>  <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">data</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">quantity</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my fucking chart</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">})</span>
</pre></table></code></div></div><p>useReducer() recibe la función reductora y un estado inicial y nos devuelve un arreglo con el estado del componente y una función llamada dispatch() esto es muy parecido a useState() con la diferencia que la función dispatch() recibe un objeto Action el cual definimos anteriormente.</p><p>Ahora para realizar cambios al estado nada usamos la funcion dispatch().</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nx">Type</span><span class="p">.</span><span class="nx">LOADING</span> <span class="p">})</span>
    <span class="nx">getPieChartData</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">pieChart</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nx">Type</span><span class="p">.</span><span class="nx">SET_DATA</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">pieChart</span> <span class="p">}))</span>
</pre></table></code></div></div><p>Vemos el primer llamado a la acción LOADING el cual cambia el estado y asigna a la variable loading el valor true y finalmente al recibir data desde nuestra petición asíncrona usamos la acción SET_DATA y el detalle es que no necesitamos una accion como STOP_LOADING para volver a asignar la variable a false, ya que lo hacemos en el propio reducer.</p><p>Terminando nuestro Hack component queda así.</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useReducer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">getPieChartData</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../core/application/getPieChartData</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">PieChartData</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../core/domain/model/PieChartData</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">PieChart</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../components/PieChart</span><span class="dl">'</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">State</span> <span class="p">{</span>
    <span class="nl">title</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span>
    <span class="nl">data</span><span class="p">:</span> <span class="nx">PieChartData</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nl">quantity</span><span class="p">:</span> <span class="nx">number</span><span class="p">;</span>
    <span class="nl">loading</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="nl">type</span><span class="p">:</span> <span class="nx">Type</span><span class="p">;</span>
    <span class="nx">payload</span><span class="p">?:</span> <span class="nx">any</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">enum</span> <span class="nx">Type</span> <span class="p">{</span>
    <span class="nx">SET_DATA</span><span class="p">,</span>
    <span class="nx">LOADING</span><span class="p">,</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">reducer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">,</span> <span class="nx">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">Type</span><span class="p">.</span><span class="na">LOADING</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
                <span class="na">loading</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">}</span>
        <span class="k">case</span> <span class="nx">Type</span><span class="p">.</span><span class="na">SET_DATA</span><span class="p">:</span>
            <span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="nx">action</span><span class="p">.</span><span class="nx">payload</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
                <span class="na">data</span><span class="p">:</span> <span class="nx">payload</span><span class="p">,</span>
                <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> 
                <span class="na">quantity</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">PieChartUseReducerUseEffect</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="kd">const</span> <span class="p">[</span><span class="nx">state</span><span class="p">,</span>  <span class="nx">dispatch</span><span class="p">]</span> <span class="o">=</span>  <span class="nx">useReducer</span><span class="p">(</span><span class="nx">reducer</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">data</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="na">quantity</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my fucking chart</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">loading</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="kd">const</span> <span class="p">{</span> <span class="nx">loading</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">quantity</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">state</span>

    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nx">Type</span><span class="p">.</span><span class="nx">LOADING</span> <span class="p">})</span>
        <span class="nx">getPieChartData</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">pieChart</span> <span class="o">=&gt;</span> <span class="nx">dispatch</span><span class="p">({</span> <span class="na">type</span><span class="p">:</span> <span class="nx">Type</span><span class="p">.</span><span class="nx">SET_DATA</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">pieChart</span> <span class="p">}))</span>

    <span class="p">},</span> <span class="p">[])</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Loading motherfucking data...<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;&gt;</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Total de datos <span class="si">{</span><span class="nx">quantity</span><span class="si">}</span><span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">PieChart</span> <span class="na">data</span><span class="p">=</span><span class="si">{</span><span class="nx">data</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/&gt;</span>
    <span class="p">)</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Terminamos con nuestro ejemplos de uso de useState() vs useReducer() ahora podemos tener una noción de cuando usar useReducer() en vez del clásico useState() esto dependerá de la complejidad del componente y el modelo de datos del estado. También debemos tener la sabiduría para dividir el problema en vez de crear componentes enormes llenos de Hooks y lógicas complejas en modelos de datos enormes.</p><h3 id="hack-3---tabla-con-paginado-desde-una-api"><span class="mr-2">Hack 3 - Tabla con paginado desde una API</span><a href="#hack-3---tabla-con-paginado-desde-una-api" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ahora vamos a crear un ejemplo con la simulación de un llamado a una API con paginado usando la misma lógica anterior, pero con la maldita diferencia que usaremos el array de dependencias el Hook useEffect() para detectar la petición del usuario de cambiar de página. La misma idea puede ser aplicada para un filtro dinámico donde se necesite ejecutar la actualización de la data mediante la interacción del usuario. Crearemos nuestro nuevo caso de uso getUsersPaginated() con el siguiente código</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>
<span class="kr">interface</span> <span class="nx">Params</span> <span class="p">{</span>
    <span class="nl">page</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">Response</span> <span class="p">{</span>
    <span class="nl">users</span><span class="p">:</span> <span class="nx">User</span><span class="p">[];</span>
    <span class="nl">total</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">getUsersPaginated</span><span class="p">({</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">size</span> <span class="p">}:</span> <span class="nx">Params</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Response</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">return</span> <span class="nx">awaitTimeout</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">USERS</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">users</span> <span class="o">=&gt;</span> <span class="nx">users</span><span class="p">.</span><span class="nx">slice</span><span class="p">((</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">page</span> <span class="o">*</span> <span class="nx">size</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">users</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="nx">users</span><span class="p">,</span> <span class="na">total</span><span class="p">:</span> <span class="nx">USERS</span><span class="p">.</span><span class="nx">length</span> <span class="p">}));</span>
<span class="p">}</span>
</pre></table></code></div></div><p>La lista de usuarios la transformamos a una constante y nos ayudamos del encadenamiento de promesas para un código más simple a la vista y nos ayudamos del método slice() para el paginado.</p><p>Ahora implementamos nuestro componente con paginado queda de la siguiente manera</p><p>Definimos nuestros nuevos estados para el paginado. Las propiedades importantes acá son page (página actual de la tabla) y total (tamaño de todos los datos) las cuales serán las que irán mutando mediante las peticiones del usuario, size también puede mutar si se implementa el selector de tamaño por páginas en este caso será omitido</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
<span class="kd">const</span> <span class="p">[</span><span class="nx">page</span><span class="p">,</span> <span class="nx">setPage</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">size</span><span class="p">,</span> <span class="nx">setSize</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">total</span><span class="p">,</span> <span class="nx">setTotal</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

</pre></table></code></div></div><p>A continuación definimos nuestro useEffect(). El cual invoca nuestro caso de uso getUsersPaginated() y recibe los parámetros de page y size definiendo la porción de datos a buscar desde nuestra API simulada. Al recibir una respuesta modificamos el estado de los datos de la tabla y el estado total el cual nos indica el total de registros existente en la API, finalmente definimos las dependencias del Hook que indican que si esas dependencias cambian el Hook useEffect() debe ejecutarse estas variables [page, size] serán actualizadas mediante las peticiones del usuario</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>
<span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
    <span class="nx">getUsersPaginated</span><span class="p">({</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">size</span> <span class="p">})</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">setDatatable</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">users</span><span class="p">)</span>
            <span class="nx">setTotal</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
<span class="p">},</span> <span class="p">[</span><span class="nx">page</span><span class="p">,</span> <span class="nx">size</span><span class="p">])</span>

</pre></table></code></div></div><p>El uso importante de useEffect es definir correctamente las dependencias que harán que se gatille el efecto estas dependencias podrían ser valores de un filtro con lo cual lograríamos crear una funcionalidad de consulta de datos</p><p>Ahora definimos la función que ejecutar el usuario al cambiar el paginado de los datos. Es una simple función callback que actualizara el estado de la variable page y esta función callback lo recibirá el componente de paginado que creemos</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
<span class="kd">const</span> <span class="nx">onPageChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setPage</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>No entraremos en detalle de la implementación de la tabla y el paginado, ya que estamos estudiando los Hooks y esta implementación estará presente el repositorio</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>
<span class="p">&lt;</span><span class="nc">Container</span> <span class="na">maxWidth</span><span class="p">=</span><span class="s">"md"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Data from async api<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">UserTable</span>
        <span class="na">datatable</span><span class="p">=</span><span class="si">{</span><span class="nx">datatable</span><span class="si">}</span>
        <span class="na">page</span><span class="p">=</span><span class="si">{</span><span class="nx">page</span><span class="si">}</span>
        <span class="na">size</span><span class="p">=</span><span class="si">{</span><span class="nx">size</span><span class="si">}</span>
        <span class="na">total</span><span class="p">=</span><span class="si">{</span><span class="nx">total</span><span class="si">}</span>
        <span class="na">onPageChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onPageChange</span><span class="si">}</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nc">Container</span><span class="p">&gt;</span>
</pre></table></code></div></div><p>Nuestro componente final seria el siguiente:</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Container</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@mui/material</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">getUsersPaginated</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../core/application/getUsersPaginated</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../core/domain/model/User</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">UserTable</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../components/UserTable</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">DatatableFromAPIPaginated</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">const</span> <span class="p">[</span><span class="nx">datatable</span><span class="p">,</span> <span class="nx">setDatatable</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([]</span> <span class="k">as</span> <span class="nx">User</span><span class="p">[])</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">page</span><span class="p">,</span> <span class="nx">setPage</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">size</span><span class="p">,</span> <span class="nx">setSize</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">total</span><span class="p">,</span> <span class="nx">setTotal</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="nx">getUsersPaginated</span><span class="p">({</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">size</span> <span class="p">})</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">setDatatable</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">users</span><span class="p">)</span>
                <span class="nx">setTotal</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
    <span class="p">},</span> <span class="p">[</span><span class="nx">page</span><span class="p">,</span> <span class="nx">size</span><span class="p">])</span>

    <span class="kd">const</span> <span class="nx">onPageChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setPage</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Loading data...<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">Container</span> <span class="na">maxWidth</span><span class="p">=</span><span class="s">"md"</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Data from async api<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">UserTable</span>
                <span class="na">datatable</span><span class="p">=</span><span class="si">{</span><span class="nx">datatable</span><span class="si">}</span>
                <span class="na">page</span><span class="p">=</span><span class="si">{</span><span class="nx">page</span><span class="si">}</span>
                <span class="na">size</span><span class="p">=</span><span class="si">{</span><span class="nx">size</span><span class="si">}</span>
                <span class="na">total</span><span class="p">=</span><span class="si">{</span><span class="nx">total</span><span class="si">}</span>
                <span class="na">onPageChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onPageChange</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nc">Container</span><span class="p">&gt;</span>
    <span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Nuestro componente esta de putas maravillas funciona correctamente en su funcionalidad básica, pero en un componente real debemos tener un control de errores el cual puede ser incluso una variable de estado al igual que loading implementando la misma estrategia, pero dejame decirte que existen opciones más desacopladas como usar interceptores en las peticiones y controlar desde ahí los errores, pero eso es mejor explicarlo en otra instancia con mas detalle.</p><p>Nuestro siguiente paso será refactorizar el componente con un Hook personalizado.</p><p>Este componente es pequeño y nuestro deber es seguir manteniéndolo así para que nuestra aplicacion sea mantenible y resiliente al cambio esto nos suena a S.O.L.I.D. verdad, en el frontend se olvidan a menudo de este concepto principalmente el de RESPONSABILIDAD ÚNICA así que vamos a aplicar un reactor.</p><p>Bienvenido Custom Hook</p><h3 id="hack-4---tabla-con-paginado-con-custom-hook"><span class="mr-2">Hack 4 - Tabla con paginado con custom hook</span><a href="#hack-4---tabla-con-paginado-con-custom-hook" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>En nuestro componente anterior utilizamos un montón de useState() y useEfffect() para crear una API mínima de usuarios, ahora moveremos toda la lógica de estos Hooks a uno personalizado.</p><p>Para crear un Hook personalizado solo basto con mover toda la lógica de los Hooks usados en una simple función, esta función puede recibir parámetros y devolver valores de estado o funciones que puedan realizar código definido dentro del Hook creado entonces el código lo movemos a la siguiente función</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>
<span class="k">import</span> <span class="nx">getUsersPaginated</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../core/application/getUsersPaginated</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">User</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../core/domain/model/User</span><span class="dl">"</span>

<span class="kr">interface</span> <span class="nx">Hook</span> <span class="p">{</span>
    <span class="nl">users</span><span class="p">:</span> <span class="nx">User</span><span class="p">[];</span>
    <span class="nl">loading</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">page</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">total</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">requestGetUsers</span><span class="p">:</span> <span class="p">(</span><span class="nx">page</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">useGetUsers</span><span class="p">():</span> <span class="nx">Hook</span> <span class="p">{</span>
    
    <span class="kd">const</span> <span class="p">[</span><span class="nx">users</span><span class="p">,</span> <span class="nx">setUsers</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">([]</span> <span class="k">as</span> <span class="nx">User</span><span class="p">[])</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">page</span><span class="p">,</span> <span class="nx">setPage</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">size</span><span class="p">,</span> <span class="nx">setSize</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">total</span><span class="p">,</span> <span class="nx">setTotal</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="nx">getUsersPaginated</span><span class="p">({</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">size</span> <span class="p">})</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">setUsers</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">users</span><span class="p">)</span>
                <span class="nx">setTotal</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
    <span class="p">},</span> <span class="p">[</span><span class="nx">page</span><span class="p">,</span> <span class="nx">size</span><span class="p">])</span>

    <span class="kd">const</span> <span class="nx">requestGetUsers</span> <span class="o">=</span> <span class="p">(</span><span class="nx">page</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setPage</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span>
        <span class="nx">setSize</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">users</span><span class="p">,</span>
        <span class="nx">loading</span><span class="p">,</span>
        <span class="nx">page</span><span class="p">,</span>
        <span class="nx">size</span><span class="p">,</span>
        <span class="nx">total</span><span class="p">,</span>
        <span class="nx">requestGetUsers</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>y finalmente nuestro componente queda de esta forma</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Container</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@mui/material</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">UserTable</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../components/UserTable</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">useGetUsers</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../hooks/useGetUsers</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">DatatablePaginatedCustomHook</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">const</span> <span class="p">{</span> <span class="nx">users</span><span class="p">,</span> <span class="nx">page</span><span class="p">,</span> <span class="nx">total</span><span class="p">,</span> <span class="nx">size</span><span class="p">,</span> <span class="nx">loading</span><span class="p">,</span> <span class="nx">requestGetUsers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useGetUsers</span><span class="p">()</span>

    <span class="kd">const</span> <span class="nx">onPageChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">requestGetUsers</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">loading</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Loading data...<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">Container</span> <span class="na">maxWidth</span><span class="p">=</span><span class="s">"md"</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Data from async api<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nc">UserTable</span>
                <span class="na">datatable</span><span class="p">=</span><span class="si">{</span><span class="nx">users</span><span class="si">}</span>
                <span class="na">page</span><span class="p">=</span><span class="si">{</span><span class="nx">page</span><span class="si">}</span>
                <span class="na">size</span><span class="p">=</span><span class="si">{</span><span class="nx">size</span><span class="si">}</span>
                <span class="na">total</span><span class="p">=</span><span class="si">{</span><span class="nx">total</span><span class="si">}</span>
                <span class="na">onPageChange</span><span class="p">=</span><span class="si">{</span><span class="nx">onPageChange</span><span class="si">}</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nc">Container</span><span class="p">&gt;</span>
    <span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Una gran diferencia con nuestro componente anterior. Este es mucho más limpio, con lógica encapsulada, separamos las responsabilidades y podemos escalar de mejor manera</p><h2 id="hack-5-custom-hook-para-cancelar-peticiones-http"><span class="mr-2">Hack 5 Custom Hook para cancelar peticiones http</span><a href="#hack-5-custom-hook-para-cancelar-peticiones-http" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Muchass veces hemos perdido la paciencia con páginas lentas y nos ponemos en modo loco y a darle al click como 20 mil veces como si eso solucionar el asunto y la página la muy cabrona se vuelve más lenta. Cuantas veces nos ha pasado y me imagino como desarrolladores cuantas veces hemos creado páginas con el mismo problema en donde en cierto comportamiento ocurre esto</p><p>Bueno en este post vamos a abordar una solución a uno de los problemas que causa esto.</p><h2 id="como-manejar-peticiones-http-cancelables"><span class="mr-2">Como manejar peticiones http cancelables</span><a href="#como-manejar-peticiones-http-cancelables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Cuando lanzamos una petición http al servidor desde un cliente generalmente el “happy path” es realizar la petición recibir los datos mostrarlos y si existe un error tratarlo pero muchas veces existen escenarios donde una petición http puede ser lanzada múltiples veces sin que el desarrollador haya predicho que el usuario haciendo ciertas acciones lograría mandar un montón de peticiones entonces el backend puede quedar en espera tramitando la petición dando la sensación de que estamos en un Internet Explorer generalmente para evitar eso se bloquean botones o se pone el típico loading, pero ojo que hay interacciones complejas en el frontend donde no todos los bloqueos o validaciones cubrirán los casos</p><p>Un caso típico es el de las pestañas o un menú de navegación en una aplicación, imaginate crear un menú y que cuando el usuario hace click en un módulo del menú empieza a cargarse el módulo, pero después el usuario hace click en otro módulo y empieza otra petición y así puede hacerlo si la página es lenta lo más probable que se ponga en modo loco y haga click por todos lados en estos caso lo ideal es que las peticiones se puedan cancelar entonces cada vez que cambie de módulo o haga click la petición que estaba en curso sea cancelada de lo contrario veríamos una respuesta más lenta en servidores que no aguanten mucha carga por el lado de React también puede ocurrir un warning de que no podemos actualizar el estado en un componente desmontado lo cual ocurre porque una petición se procesó y el resultado se quiere escribir en un componente inexistente porque ahora se está tratando de cargar otro, React nos advierte que puede ser un posible “memory leak” y es mejor evitarlo así que vamos a crear el maldito ejemplo que es mucha cháchara para un par de líneas de código</p><h2 id="el-caso-de-ejemplo"><span class="mr-2">El caso de ejemplo</span><a href="#el-caso-de-ejemplo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Crearemos un módulo que muestra las aves chilenas en esta ocasión están no nombre en inglés, la funcionalidad más ridícula que se me ocurrió, pero sirve para mostrar el problema</p><p>Instalaremos axios para manejar las peticiones http</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm <span class="nb">install </span>axios
</pre></table></code></div></div><p>Ahora creamos la estructura de la respuesta de la API y la función fecthAllChileanBirds() que hace un llamado a la api <a href="https://aves.ninjas.cl/api/birds">Aves ninja</a></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">axios</span><span class="p">,</span> <span class="p">{</span> <span class="nx">AxiosResponse</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">ChileanBirdResponse</span> <span class="p">{</span>
    <span class="nl">uid</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">name</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">spanish</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">english</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">latin</span><span class="p">:</span>   <span class="kr">string</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nl">images</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">main</span><span class="p">:</span>  <span class="kr">string</span><span class="p">;</span>
        <span class="nl">full</span><span class="p">:</span>  <span class="kr">string</span><span class="p">;</span>
        <span class="nl">thumb</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">_links</span><span class="p">:</span> <span class="p">{</span>
        <span class="nl">self</span><span class="p">:</span>   <span class="kr">string</span><span class="p">;</span>
        <span class="nl">parent</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">sort</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">fecthAllChileanBirds</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">AxiosResponse</span><span class="o">&lt;</span><span class="nx">ChileanBirdResponse</span><span class="p">[]</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://aves.ninjas.cl/api/birds</span><span class="dl">'</span><span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Ahora crearemos nuestro caso de uso que hará un llamado a la API y nos devolverá las aves chilenas con su nombre en ingles y su nombre en latín para que nuestro post parezca más intelectual me vea la nasa y me saque de Latinoamérica</p><p>Modelo</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kr">interface</span> <span class="nx">Bird</span> <span class="p">{</span>
    <span class="nl">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">latinname</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Función Adapter</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">ChileanBirdResponse</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../api/ChileanBirdsApi</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Bird</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../model/Bird</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">ChileanBirdToEnglishBirdAdapter</span><span class="p">(</span><span class="nx">response</span><span class="p">:</span> <span class="nx">ChileanBirdResponse</span><span class="p">):</span> <span class="nx">Bird</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">id</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">uid</span><span class="p">,</span>
        <span class="na">name</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">english</span><span class="p">,</span>
        <span class="na">latinname</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">latin</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Caso de uso</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">fecthAllChileanBirds</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../api/ChileanBirdsApi</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ChileanBirdToEnglishBirdAdapter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../domain/adapter/ChileanBirdToEnglishBirdAdapter</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Bird</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../domain/model/Bird</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">getEnglishNameBirds</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Bird</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fecthAllChileanBirds</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">birds</span> <span class="o">=&gt;</span> <span class="nx">birds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">b</span> <span class="o">=&gt;</span> <span class="nx">ChileanBirdToEnglishBirdAdapter</span><span class="p">(</span><span class="nx">b</span><span class="p">)))</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Ojo nótese la función ChileanBirdToEnglishBirdAdapter() la cual es usada como patrón Adapter donde recibirá un objeto externo al “Dominio” o lógica “core” de la aplicación y nos devolverá un objeto de tipo Modelo o entidad la cual será usado por nuestros casos de usos, ¿que ventajas hay usando esto? Bueno principalmente desacopla él la lógica de negocio frente a implementaciones u objetos externos los cuales podrían ser una respuesta de una API o cualquier implementación de una librería de terceros imagina que después cambiemos la API de aves chilenas por otra cuya respuesta sea distinta entonces centralizamos el cambio en un solo punto que sería la función adaptadora.</p><h2 id="hook-personalizado-para-funciones-asíncronas"><span class="mr-2">Hook personalizado para funciones asíncronas</span><a href="#hook-personalizado-para-funciones-asíncronas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ahora crearemos un Hook personalizado para hacer uso de funciones asíncronas con lo cual usaremos para obtener las aves chilenas con su nombre en ingles y pintarlos sobre un componente de React</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>

<span class="nx">type</span> <span class="nx">Callback</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span>

<span class="kr">interface</span> <span class="nx">Hook</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="na">loading</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">data</span><span class="p">:</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nl">error</span><span class="p">:</span> <span class="nx">any</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">useAsync</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">callback</span><span class="p">:</span> <span class="nx">Callback</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">Hook</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">{</span>
    
    <span class="kd">const</span> <span class="p">[</span><span class="nx">data</span><span class="p">,</span> <span class="nx">setData</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">error</span><span class="p">,</span> <span class="nx">setError</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="nx">callback</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">setData</span><span class="p">(</span><span class="nx">response</span><span class="p">))</span>
            <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
            <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>

    <span class="p">},</span> <span class="p">[])</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">loading</span><span class="p">,</span>
        <span class="nx">data</span><span class="p">,</span>
        <span class="nx">error</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Este Hook no tien mayor gracia usa el useState() y useEffect() de toda la vida tiene un loading un estado de posibles errores. Ahora crearemos otro componente que reflejará el caso de uso</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">getEnglishNameBirds</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../../../core/application/getEnglishNameBirds</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Bird</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../../../../../core/domain/model/Bird</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">useAsync</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./useAsync</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">useEnglishBirds</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">useAsync</span><span class="o">&lt;</span><span class="nx">Bird</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">getEnglishNameBirds</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Este hook importa la función getEnglishNameBirds() como caso de uso y la agrega como parámetro al Hook useAsync() y es todo</p><h2 id="el-componente-de-aves-en-inglés"><span class="mr-2">El componente de Aves en inglés</span><a href="#el-componente-de-aves-en-inglés" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">useEnglishBirds</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../hooks/useEnglishBirds</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">BirdContainer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../shared/components/BirdContainer</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">EnglishTranslateBirds</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">loading</span><span class="p">,</span> <span class="nx">data</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useEnglishBirds</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">BirdContainer</span> <span class="na">datatable</span><span class="p">=</span><span class="si">{</span><span class="nx">data</span><span class="si">}</span> <span class="na">loading</span><span class="p">=</span><span class="si">{</span><span class="nx">loading</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">)</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Ahora crearemos el componete que hará uso del hook useEnglishBirds() para mostrar las aves chilenas en ingles la implementación del componente es lo de menos, ya que es una clase de Hooks</p><p>Nuestro frontend luce así</p><p>FOTO_FRONT</p><p>Ahora si hacemos múltiples clicks sobre el menú de aves y sobre el cualquier otro</p><p>FOTO_MENU Y CILCK</p><p>Ahora vamos a inspeccionar página y nos vamos a networking y si hacemos múltiples clicks sobre el menú de aves y sobre el cualquier otro obtendremos las siguientes peticiones</p><p>FOTO_NETWORKING</p><p>Como ves quedaron pendientes muchas peticiones y todas terminaran, pero es total ineficiente y más cuando hay apis que son síncronas que lanzan un hilo nuevo por cada petición necesitamos cancelar las petición. Para lograr esto necesitamos crear un objeto AbortController propio de la API nativa del navegador esta solución que te presentaré funciona tanto en axios como con la Fetch opción nativa del navegador para hacer peticiones.</p><p>Cambiaremos la implementación de la petición de las aves chilenas agregando a la petición de axios un parámetro llamado signal el cual es de tipo AbortSignal con el cual axios se dará cuenta de qué la petición debe ser cancelada</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kd">function</span> <span class="nx">fecthCancellableChileanBirds</span><span class="p">(</span><span class="nx">signal</span><span class="p">?:</span> <span class="nx">AbortSignal</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">AxiosResponse</span><span class="o">&lt;</span><span class="nx">ChileanBirdResponse</span><span class="p">[]</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://aves.ninjas.cl/api/birds</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">signal</span> <span class="p">})</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Nuestro caso de uso ahora no solo devolverá una petición para obtener las aves sino que también devolverá una función para cancelar la petición, esta vez obtendremos las aves chilenas en idioma español</p><p>Definimos la estructura de la respuesta del caso de uso</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>
<span class="kr">interface</span> <span class="nx">GetSpanishBirdServices</span> <span class="p">{</span>
    <span class="nl">fetchBirds</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Bird</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nl">cancelFetchBirds</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Y ahora definimos la lógica de la petición y de cancelación</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">getSpanishBirdsServices</span><span class="p">():</span> <span class="nx">GetSpanishBirdServices</span> <span class="p">{</span>
    
    <span class="kd">const</span> <span class="nx">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AbortController</span><span class="p">()</span>
    
    <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">fecthCancellableChileanBirds</span><span class="p">(</span><span class="nx">controller</span><span class="p">.</span><span class="nx">signal</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">birds</span> <span class="o">=&gt;</span> <span class="nx">birds</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">b</span> <span class="o">=&gt;</span> <span class="nx">ChileanBirdToSpanishBirdAdapter</span><span class="p">(</span><span class="nx">b</span><span class="p">)))</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="na">fetchBirds</span><span class="p">:</span> <span class="nx">request</span><span class="p">,</span>
        <span class="na">cancelFetchBirds</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">controller</span><span class="p">.</span><span class="nx">abort</span><span class="p">()</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Ya ahora nuestro caso de uso devuelve un objeto que simula un típico componente “Service”</p><h2 id="entendiendo-el-ciclo-de-vida-en-react"><span class="mr-2">Entendiendo el ciclo de vida en React</span><a href="#entendiendo-el-ciclo-de-vida-en-react" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Es momento de entender el ciclo de vida de los Hooks en React para poder implementar nuestra cancelación de petición cuando usamos el Hook useEffect() este recibe una función callback que se ejecutara cuando se actualiza alguna dependencia definida en un array definido como segundo parámetro del Hook en la mayoría de los casos necesitamos solo definir una función que haga una acción y termine ahí, pero la función callback que definimos en useEffect puede devolver un función y ¿para qué rayos sirve esta función? Esta función es llamada “cleanup” y se ejecuta cada vez que el componente se desmonta es ideal para ejecutar acciones como es el cerrado de una conexión por websocket por ejemplo o un clearInterval si se usa la función useInterval() en Hooks entonces esta función es ideal para nuestro propósito de cancelar un petición http</p><p>Entonces nuestro Hook quedara de la siguiente manera</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span>

<span class="kr">interface</span> <span class="nx">Hook</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="na">loading</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">data</span><span class="p">:</span> <span class="nx">T</span> <span class="o">|</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nl">error</span><span class="p">:</span> <span class="nx">any</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">CancellableRequest</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="na">execute</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nl">cancel</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">useCancelableAsync</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">cancellablerequest</span><span class="p">:</span> <span class="nx">CancellableRequest</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">Hook</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">{</span>
    
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">execute</span><span class="p">,</span> <span class="nx">cancel</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">cancellablerequest</span><span class="p">;</span>

    <span class="kd">const</span> <span class="p">[</span><span class="nx">data</span><span class="p">,</span> <span class="nx">setData</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
    <span class="kd">const</span> <span class="p">[</span><span class="nx">error</span><span class="p">,</span> <span class="nx">setError</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
   
    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        
        <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        
        <span class="nx">execute</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">setData</span><span class="p">(</span><span class="nx">response</span><span class="p">))</span>
            <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">setError</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
            <span class="p">.</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span><span class="p">{</span>
            <span class="nx">cancel</span><span class="p">()</span>
        <span class="p">}</span>
        
    <span class="p">},</span> <span class="p">[])</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">loading</span><span class="p">,</span>
        <span class="nx">data</span><span class="p">,</span>
        <span class="nx">error</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Los únicos cambios son las propiedades de nuestro Hook serán la petición asíncrona que debe realizar una función que cancel la operación así quienes implementen el uso de hook se preocuparan de realizar las operaciones de limpieza del hook finalmente en el useEffec() la función callback definida devolverá una función que se encargara de realizar la cancelación de la petición</p><h2 id="useasynccancellable-en-acción"><span class="mr-2">useAsyncCancellable en acción</span><a href="#useasynccancellable-en-acción" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ahora definimos el componente que usara nuestro custom Hook</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">BirdContainer</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../shared/components/BirdContainer</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">getSpanishBirdsServices</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../../../core/application/getSpanishNameBirdsCancellable</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">useCancelableAsync</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../hooks/useCancelableAsync</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Bird</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../../../core/domain/model/Bird</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">SpanishTranslateBirdsCancellable</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">fetchBirds</span><span class="p">,</span> <span class="nx">cancelFetchBirds</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">getSpanishBirdsServices</span><span class="p">()</span>

    <span class="kd">const</span> <span class="p">{</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">loading</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useCancelableAsync</span><span class="o">&lt;</span><span class="nx">Bird</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">({</span>
        <span class="na">execute</span><span class="p">:</span> <span class="nx">fetchBirds</span><span class="p">,</span>
        <span class="na">cancel</span><span class="p">:</span> <span class="nx">cancelFetchBirds</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="p">&lt;</span><span class="nc">BirdContainer</span> <span class="na">datatable</span><span class="p">=</span><span class="si">{</span><span class="nx">data</span><span class="si">}</span> <span class="na">loading</span><span class="p">=</span><span class="si">{</span><span class="nx">loading</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">)</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Y así de simple usamos nuestro Hook definimos nombres de funciones y variables claras que expresan totalmente la intención de la aplicación. Finalmente vemos los resultados de múltiples clicks en distintos módulos y como en la sección networking apreciamos los benditos canceled. Un respiro para el backend y una optimización excelente para nuestro frontend</p><p>FOTOS RESULTADOS</p><h2 id="conclusión"><span class="mr-2">Conclusión</span><a href="#conclusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Las conclusiones debes sacarlas por ti mismo leer implementar y seguir aprendiendo de otros recursos. por mientras un meme</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/programacion/'>Programacion</a>, <a href='//categories/react/'>React</a>, <a href='//categories/javascript/'>Javascript</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/typescript/" class="post-tag no-text-decoration" >typescript</a> <a href="//tags/javascript/" class="post-tag no-text-decoration" >javascript</a> <a href="//tags/frontend/" class="post-tag no-text-decoration" >frontend</a> <a href="//tags/hooks/" class="post-tag no-text-decoration" >hooks</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Usando+los+Hooks+de+React+m%C3%A1s+all%C3%A1+del+useState+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2FUsando-los-Hooks-de-React-m%25C3%25A1s-all%25C3%25A1-del-useState%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Usando+los+Hooks+de+React+m%C3%A1s+all%C3%A1+del+useState+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2FUsando-los-Hooks-de-React-m%25C3%25A1s-all%25C3%25A1-del-useState%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2FUsando-los-Hooks-de-React-m%25C3%25A1s-all%25C3%25A1-del-useState%2F&text=Usando+los+Hooks+de+React+m%C3%A1s+all%C3%A1+del+useState+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2FUsando-los-Hooks-de-React-m%25C3%25A1s-all%25C3%25A1-del-useState%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/arquitectura-frontend-1-como-integrar-rxjs-4-react-para-aplicaciones-asincronas-complejas/"><div class="card-body"> <em class="small" data-ts="1692640120" data-df="YYYY-MM-DD" > 2023-08-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitectura Frontend 1. Cómo integrar RxJS en React para aplicaciones asíncronas complejas</h3><div class="text-muted small"><p> React es una excelente librería para crear componentes visuales. También nos brinda los hooks, con los cuales podemos trabajar con estados y efectos secundarios en situaciones asíncronas. Si bien...</p></div></div></a></div><div class="card"> <a href="/posts/arquitectura-frontend-2-como-implementar-clean-arquitecture/"><div class="card-body"> <em class="small" data-ts="1697002727" data-df="YYYY-MM-DD" > 2023-10-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitectura Frontend 2. Cómo implementar Clean Architecture en el Frontend.</h3><div class="text-muted small"><p> La aplicación de los principios de la arquitectura limpia (Clean Architecture) no se limita al ámbito del backend; de hecho, pueden ser igualmente beneficiosos cuando se aplican al frontend, ofre...</p></div></div></a></div><div class="card"> <a href="/posts/Ejemplo-programaci%C3%B3n-reactiva-100-Real-No-Fake/"><div class="card-body"> <em class="small" data-ts="1663716720" data-df="YYYY-MM-DD" > 2022-09-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ejemplo programación reactiva 100% Real No Fake</h3><div class="text-muted small"><p> Ejemplo programación reactiva 100% Real No Fake La programación reactiva es un paradigma enfocado en el trabajo con flujos de datos finitos o infinitos de manera asíncrona. Su concepción y evoluci...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/Ejemplo-programaci%C3%B3n-reactiva-100-Real-No-Fake/" class="btn btn-outline-primary" prompt="Anterior"><p>Ejemplo programación reactiva 100% Real No Fake</p></a> <a href="//posts/sqli/" class="btn btn-outline-primary" prompt="Nuevo"><p>Cuando un SQL Injection deja a tu aplicación como un chiste</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
