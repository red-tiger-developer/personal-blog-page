<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Trabajando con 1 millón de registros con Java Stream" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/tranajando-con-1millon-de-registros-con-java-stream/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/tranajando-con-1millon-de-registros-con-java-stream/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-30T12:32:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Trabajando con 1 millón de registros con Java Stream" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2023-01-30T18:51:26-03:00","datePublished":"2023-01-30T12:32:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Trabajando con 1 millón de registros con Java Stream","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/tranajando-con-1millon-de-registros-con-java-stream/"},"url":"https://nullpointer-excelsior.github.io/posts/tranajando-con-1millon-de-registros-con-java-stream/"}</script><title>Trabajando con 1 millón de registros con Java Stream | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Trabajando con 1 millón de registros con Java Stream</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Trabajando con 1 millón de registros con Java Stream</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1675092720" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-01-30 </em> </span> <span> Actualizado <em class="" data-ts="1675115486" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-01-30 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1897 palabras"> <em>10 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="https://i.ibb.co/wwrWnGq/Screen-Shot-2023-01-30-at-18-14-41.png" alt="image" data-proofer-ignore></p><h1 id="trabajando-con-1-millón-de-registros-con-java-stream">Trabajando con 1 millón de registros con Java Stream</h1><p>Cuando trabajamos con grandes cantidades de datos lo primero que hacemos es definir un filtrado de la fuente de datos para poder trabajar con lo que realmente nos interesa, pero cuando el filtrado no basta y nuestro universo de datos resultante es considerable en Java podemos hacer uso de su API Streams.</p><p>Java streams nos proporciona una manera eficiente de recorrer y realizar operaciones sobre una secuencia de elementos. Para demostrar las bondades y la facilidad de uso de esta API montaremos un pequeño ejemplo donde trabajaremos con un universo de <code class="language-plaintext highlighter-rouge">1 millón de registros</code> rescatados de una base de datos.</p><h2 id="streams-vs-arrays"><span class="mr-2">Streams vs Arrays</span><a href="#streams-vs-arrays" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Java Stream nos trae el concepto de flujo de datos donde cada valor del stream es obtenido de forma secuencial con la posibilidad de realizar operaciones individuales sobre cada elemento, sobre un subconjunto de ellos, o sobre la totalidad de los mismos. Estas operaciones pueden ser ejecutadas de forma secuencial o paralela. Este enfoque promueve la programación funcional y la posibilidad de encadenamiento de estas operaciones a modo de pipelines.</p><p>Diferencia entre Streams y Arreglos:</p><ul><li>No son almacenes ni estructura de datos.<li>Los valores son obtenidos desde una fuente y pasan a través de una cadena de operaciones.<li>Están orientados a la programación funcional.<li>No modifican la fuente de la que se obtienen datos.<li>No realizan side effects.<li>Promueven la inicialización y evaluación perezosa (lazy) e implementan sus operaciones de forma perezosa cuando sea posible.<li>Un elemento es visitado solo una vez.<li>No tienen un tamaño fijo. Un stream puede alimentarse de una fuente de datos infinita.</ul><h2 id="programación-imperativa-vs-funcional"><span class="mr-2">Programación imperativa vs Funcional</span><a href="#programación-imperativa-vs-funcional" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>La capacidad de utilizar programación funcional nos da la posibilidad de crear código más legible y mantenible cuando las lógicas de negocio van cambiando y el volumen de datos empieza a ser un problema y necesitamos agregar nuevas operaciones.</p><p>Un pequeño ejemplo de programación imperativa es este:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ages</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">45</span><span class="o">,</span> <span class="mi">28</span><span class="o">,</span> <span class="mi">32</span><span class="o">);</span>

<span class="kt">var</span> <span class="n">totalAges</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="nl">age:</span> <span class="n">ages</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">totalAges</span> <span class="o">+=</span> <span class="n">age</span><span class="o">;</span>
<span class="o">}</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">totalAges</span><span class="o">);</span>


</pre></table></code></div></div><p>Y el enfoque funcional es el siguiente:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ages</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="mi">25</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">45</span><span class="o">,</span> <span class="mi">28</span><span class="o">,</span> <span class="mi">32</span><span class="o">);</span>

<span class="kt">int</span> <span class="n">computedAges</span> <span class="o">=</span> <span class="n">ages</span>
        <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
        <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">computedAges</span><span class="o">);</span>

</pre></table></code></div></div><p>Ambos códigos hacen lo mismo, pero no se comportarán de igual manera cuando la cantidad de registros sea más grande y aumenten los requerimientos de lógicas de negocio. El rendimiento también será comprometido intentaremos evitar realizar más bucles de los necesarios sobre nuestros registros, pero esto hará el código menos legible. Con Streams nuestros registros serán recorridos de forma secuencial nuestras operaciones podrán ser encadenadas y cada una de ellas tendrá su responsabilidad definida mejorando el testing y la posibilidad de reutilización.</p><p>Basta de explicaciones esto lo veremos con código y sus correspondientes hacks 😉, a sí que manos a la obra.</p><h2 id="levantando-1-millón-de-datos"><span class="mr-2">Levantando 1 millón de datos</span><a href="#levantando-1-millón-de-datos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Puedes descargar este <a href="https://github.com/nullpointer-excelsior/java-high-performance-api.git">repositorio</a> y ver en detalle el código y si quieres realizar las pruebas a tu gusto, Ahora levantamos nuestra base de datos haciendo uso del script <code class="language-plaintext highlighter-rouge">product.sql</code> el que contiene nuestro universo.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

unzip database.zip

docker run <span class="nt">--name</span> streamdata <span class="nt">-e</span> <span class="nv">POSTGRES_USER</span><span class="o">=</span>streamdata <span class="nt">-e</span> <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>streamdata <span class="nt">-e</span> <span class="nv">POSTGRES_DATABASE</span><span class="o">=</span>streamdata <span class="nt">-p</span> 5432:5432 <span class="nt">-v</span> <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">/product.sql:/docker-entrypoint-initdb.d/product.sql"</span> <span class="nt">-d</span> postgres

</pre></table></code></div></div><h2 id="arquitectura-de-software"><span class="mr-2">Arquitectura de software</span><a href="#arquitectura-de-software" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nuestro proyecto implementa una arquitectura hexagonal para un mejor entendimiento de nuestros componentes. Además hacemos uso de spring-boot.</p><h3 id="capa-de-dominio"><span class="mr-2">Capa de dominio</span><a href="#capa-de-dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>nuestro dominio es simple:</p><p><code class="language-plaintext highlighter-rouge">Entidad: Product</code></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>
<span class="nd">@Builder</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">sku</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Double</span> <span class="n">price</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">stock</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">department</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">brand</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Puerto: ProductRepository</code></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductRepository</span> <span class="o">{</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="nf">findByPaginated</span><span class="o">(</span><span class="kt">int</span> <span class="n">limit</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">);</span>

<span class="o">}</span>
</pre></table></code></div></div><p>Nuestro repositorio tiene un único método que se encarga de leer los productos de forma paginada este enfoque nos permitirá crear un Stream de Products de forma eficiente sin tener que leer toda la tabla.</p><h3 id="capa-de-infraestructura"><span class="mr-2">Capa de Infraestructura</span><a href="#capa-de-infraestructura" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Nuestra base de datos empleada es postgres la configuración de las credenciales está dada en el archivo <code class="language-plaintext highlighter-rouge">application.yml</code></p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="na">spring.jpa</span><span class="pi">:</span>
  <span class="na">database</span><span class="pi">:</span> <span class="s">POSTGRESQL</span>
  <span class="na">hibernate</span><span class="pi">:</span>
    <span class="na">ddl-auto</span><span class="pi">:</span> <span class="s">none</span>
  <span class="na">show-sql</span><span class="pi">:</span> <span class="no">false</span>

<span class="na">spring.datasource</span><span class="pi">:</span>
  <span class="na">platform</span><span class="pi">:</span> <span class="s">postgres</span>
  <span class="na">driverClassName</span><span class="pi">:</span> <span class="s">org.postgresql.Driver</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:postgresql://localhost:5432/streamdata</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">streamdata</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">streamdata</span>
</pre></table></code></div></div><p>La definición de nuestra entidad y repositorio JPA son las siguientes:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ToString</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"product"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductEntity</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"sku"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">sku</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"name"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"price"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Double</span> <span class="n">price</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"stock"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">stock</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"department"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">department</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"brand"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">brand</span><span class="o">;</span>

<span class="o">}</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">JpaProductRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">ProductEntity</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span>  <span class="o">{</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"SELECT * FROM product p ORDER BY p.sku LIMIT :limit OFFSET :offset "</span><span class="o">,</span> <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ProductEntity</span><span class="o">&gt;</span> <span class="nf">findByPaginated</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"limit"</span><span class="o">)</span><span class="kt">int</span> <span class="n">limit</span><span class="o">,</span> <span class="nd">@Param</span><span class="o">(</span><span class="s">"offset"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">);</span>

<span class="o">}</span>
</pre></table></code></div></div><p>Para integrar la persistencia con el dominio implementamos nuestro adaptador <code class="language-plaintext highlighter-rouge">ProductRepositoryAdapter</code></p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductRepositoryAdapter</span> <span class="kd">implements</span> <span class="nc">ProductRepository</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">JpaProductRepository</span> <span class="n">repository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="nf">findByPaginated</span><span class="o">(</span><span class="kt">int</span> <span class="n">limit</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">repository</span><span class="o">.</span><span class="na">findByPaginated</span><span class="o">(</span><span class="n">limit</span><span class="o">,</span> <span class="n">offset</span><span class="o">)</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">mapToProduct</span><span class="o">)</span>
                <span class="o">.</span><span class="na">toList</span><span class="o">();</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">Product</span> <span class="nf">mapToProduct</span><span class="o">(</span><span class="nc">ProductEntity</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Product</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">sku</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getSku</span><span class="o">())</span>
                <span class="o">.</span><span class="na">stock</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getStock</span><span class="o">())</span>
                <span class="o">.</span><span class="na">brand</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getBrand</span><span class="o">())</span>
                <span class="o">.</span><span class="na">department</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">())</span>
                <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
                <span class="o">.</span><span class="na">price</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getPrice</span><span class="o">())</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>Nuestra primera aproximación con Streams nos la da el llamado al método <code class="language-plaintext highlighter-rouge">findByPaginated()</code> el cual devuelve un Array que nos proporciona el método <code class="language-plaintext highlighter-rouge">stream()</code> el cual transforma nuestro objeto Array a Stream lo primero que hacemos es hacer llamado al método <code class="language-plaintext highlighter-rouge">map()</code> en el cual recibiremos uns Entidad ORM y devolveremos una Entidad de dominio.</p><h2 id="generación-de-stream-de-productos"><span class="mr-2">Generación de Stream de productos</span><a href="#generación-de-stream-de-productos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="paginado-infinito"><span class="mr-2">Paginado infinito</span><a href="#paginado-infinito" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ahora teniendo la base de nuestro proyecto podremos hacer uso de Stream para una proceso de alto rendimiento. Lo que haremos será leer nuestra tabla product y obtener su universo completo (1 millón de registros) lo haremos eficientemente seleccionando los datos en Arrays de 10.000 registros e iremos transformando la lista obtenida en un stream de datos. Para leer nuestra tabla lo que haremos es ir leyendo los registros basados en limit y offset para lograr esto crearemos un Stream infinito que nos devuelva la siguiente secuencia:</p><ul><li>limit=10000 , offset=0<li>limit=10000 , offset=10000<li>limit=10000 , offset=20000<li>limit=10000 , offset=30000<li>…<li>limit=10000, offset= …N</ul><p>Nuestro Stream generador será la siguiente clase:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StreamPaginated</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">limit</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">StreamPaginated</span><span class="o">&gt;</span> <span class="nf">paginate</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">IntStream</span>
                <span class="o">.</span><span class="na">iterate</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">+</span> <span class="n">size</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">skip</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">StreamPaginated</span><span class="o">(</span><span class="n">size</span><span class="o">,</span> <span class="n">skip</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h3 id="definición-de-nuestro-servicio-de-dominio"><span class="mr-2">Definición de nuestro Servicio de Dominio</span><a href="#definición-de-nuestro-servicio-de-dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Este código generará en base a un tamaño dado nuestro stream nos ayudamos de <code class="language-plaintext highlighter-rouge">IntStream</code> una clase que nos ayuda a generar Streams de Integers que generará una secuencia de 10.000 en 10.000. Finalmente llamamos a <code class="language-plaintext highlighter-rouge">map()</code> para transformar nuestra secuencia de enteros en un objeto <code class="language-plaintext highlighter-rouge">StreamPaginated</code>.</p><p>Ahora creamos nuestro servicio de dominio y utilizamos nuestro <code class="language-plaintext highlighter-rouge">StreamPaginated</code> para crear una secuencia infinita de este objeto.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductService</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ProductRepository</span> <span class="n">repository</span><span class="o">;</span>

    <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="nf">getStream</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">StreamPaginated</span>
                <span class="o">.</span><span class="na">paginate</span><span class="o">(</span><span class="mi">10000</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">page</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">repository</span><span class="o">.</span><span class="na">findByPaginated</span><span class="o">(</span><span class="n">page</span><span class="o">.</span><span class="na">getLimit</span><span class="o">(),</span> <span class="n">page</span><span class="o">.</span><span class="na">getOffset</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">takeWhile</span><span class="o">(</span><span class="n">records</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">records</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">Collection:</span><span class="o">:</span><span class="n">stream</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Ahora la lógica de nuestro Stream se divide en lo siguiente:</p><ul><li><code class="language-plaintext highlighter-rouge">.paginated(10000)</code>: creamos un paginado de 10.000 en 10.000 de forma infinita para obtener todos los registros de nuestra tabla productos. Con esto nos aseguramos de leer todos los registros.<li><code class="language-plaintext highlighter-rouge">.map(page -&gt; this.repository.findByPaginated(page.getLimit(), page.getOffset())))</code>: nuestro paginado lo transformaremos en un Array de Product haciendo llamado a nuestro repositorio y su método de búsqueda de productos.<li><code class="language-plaintext highlighter-rouge">.takeWhile(records -&gt; !records.isEmpty())</code>: Acá está la magia que detendrá nuestra secuencia de paginado, Consumiremos nuestro Stream Mientras los registros que obtengamos no estén vacíos. Es decir cuando venga un Array vacío el Stream terminará.<li><code class="language-plaintext highlighter-rouge">.flatMap(Collection::stream)</code>: Aplanaremos nuestro Array de Productos de una lista de productos a una secuencia de productos con esto nuestro quién haga llamado del método getStream() obtendrá los registros de 1 en 1 no importando que estemos obteniendo los datos de 10.000 en 10.000.</ul><p>En resumen el flujo generado realizo las siguientes cambios:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="c"># StreamPaginated -&gt; List&lt;Product&gt; -&gt; Stream&lt;Product&gt;</span>
</pre></table></code></div></div><p>Nuestro Stream de product está listo para poder ser consumido y realizar las operaciones que queramos.</p><h2 id="definición-de-nuestros-casos-de-uso"><span class="mr-2">Definición de Nuestros casos de uso</span><a href="#definición-de-nuestros-casos-de-uso" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ahora crearemos el siguiente servicio que representará nuestros casos de uso</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductUseCases</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ProductService</span> <span class="n">products</span><span class="o">;</span>

    <span class="c1">// ... Your imagination making code</span>

<span class="o">}</span>

</pre></table></code></div></div><p>Crearemos casos de uso para realizar operaciones sobre nuestro Stream</p><h3 id="obtener-las-marcas-de-nuestros-productos"><span class="mr-2">Obtener las marcas de nuestros productos</span><a href="#obtener-las-marcas-de-nuestros-productos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getBrands</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">products</span><span class="o">.</span><span class="na">getStream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Product:</span><span class="o">:</span><span class="n">getBrand</span><span class="o">)</span> <span class="c1">// seleccionamos solo el campo brand de nuestro objeto Product </span>
                <span class="o">.</span><span class="na">distinct</span><span class="o">()</span> <span class="c1">// de las marcas obtenidas obtneemos los objetos únicos</span>
                <span class="o">.</span><span class="na">toList</span><span class="o">();</span> <span class="c1">// transformamos nuestro Stream&lt;String&gt; a List&lt;String&gt;</span>
    <span class="o">}</span>
</pre></table></code></div></div><h3 id="productos-sin-stock"><span class="mr-2">productos sin stock</span><a href="#productos-sin-stock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="nf">getSkuWithoutStock</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">products</span><span class="o">.</span><span class="na">getStream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">product</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// filtraremos todos los productos con stock igual o menor a zero</span>
    <span class="o">}</span>
</pre></table></code></div></div><h3 id="conteo-de-productos-sin-stock"><span class="mr-2">conteo de productos sin stock</span><a href="#conteo-de-productos-sin-stock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">long</span> <span class="nf">countSkuWithoutStock</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">products</span><span class="o">.</span><span class="na">getStream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">product</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="na">getStock</span><span class="o">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="c1">// filtraremos todos los productos con stock igual o menor a zero</span>
                <span class="o">.</span><span class="na">count</span><span class="o">();</span> <span class="c1">// de los productos filtrados realizaremos un conteo y devolveremos el valor numerico</span>
    <span class="o">}</span>
</pre></table></code></div></div><h3 id="suma-de-stock-del-departamento-604"><span class="mr-2">Suma de Stock del departamento 604</span><a href="#suma-de-stock-del-departamento-604" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">long</span> <span class="nf">sumStockDepartment604</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">products</span><span class="o">.</span><span class="na">getStream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">product</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"604"</span><span class="o">))</span> <span class="c1">// filtramos productos del depto 604</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Product:</span><span class="o">:</span><span class="n">getStock</span><span class="o">)</span> <span class="c1">// mapeamos de Product a Integer</span>
                <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">)</span> <span class="c1">// realizamos una suma con el tradicional reduce()</span>
                <span class="o">.</span><span class="na">longValue</span><span class="o">();</span> <span class="c1">// devolvemos el valor como un long</span>
    <span class="o">}</span>
</pre></table></code></div></div><h3 id="agrupar-por-marca-productos-del-departamento-604"><span class="mr-2">Agrupar por marca productos del departamento 604</span><a href="#agrupar-por-marca-productos-del-departamento-604" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;&gt;</span> <span class="nf">groupByDepartment604Brand</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">products</span><span class="o">.</span><span class="na">getStream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">product</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"604"</span><span class="o">))</span> <span class="c1">// filtramos productos del depto 604</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">p</span><span class="o">.</span><span class="na">getBrand</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">p</span><span class="o">.</span><span class="na">getBrand</span><span class="o">()</span> <span class="o">:</span> <span class="s">"No brand"</span><span class="o">));</span> <span class="c1">// agrupamos por marca si el campo marca es nulo le damos el valor por defecto "No brand"</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>Esta es la magia de Stream poder realizar operaciones sobre una gran cantidad de datos de forma eficiente, ya que estamos obteniendo valores de forma secuencial sin necesidad de obtener el universo completo y después realizar operaciones. Basado en programación funcional nos hace más fácil crear código más legible claro que esto es con operaciones más comunes lamentablemente hay ocasiones donde el código es más difícil de entender por la nomenclatura de los genéricos de Java, pero ahi solo queda dividir y vencer.</p><p>Para probar por ti mismo realiza las pruebas en la clase <code class="language-plaintext highlighter-rouge">src/main/java/App.java</code>:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nd">@Log4j2</span>
<span class="nd">@Component</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ProductUseCases</span> <span class="n">productUseCases</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">App</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@EventListener</span><span class="o">(</span><span class="nc">ApplicationReadyEvent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReady</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">productUseCases</span>
                <span class="o">.</span><span class="na">getSkuWithoutStock</span><span class="o">()</span>
                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">product</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Product {}"</span><span class="o">,</span> <span class="n">product</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h2 id="conclusiones"><span class="mr-2">Conclusiones</span><a href="#conclusiones" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>No hay conclusiones prueba por ti mismo el verdadero poder de API Stream de Java</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/java-high-performance-api.git">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="https://i.ibb.co/HHmdD5Z/efc4edaf-eb8e-4b92-a5fb-2b6283e8e85d.jpg" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/programacion/'>Programacion</a>, <a href='//categories/java/'>Java</a>, <a href='//categories/arquitectura-de-software/'>Arquitectura de software</a>, <a href='//categories/spring/'>Spring</a>, <a href='//categories/springboot/'>Springboot</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/java/" class="post-tag no-text-decoration" >Java</a> <a href="//tags/spring/" class="post-tag no-text-decoration" >Spring</a> <a href="//tags/stream/" class="post-tag no-text-decoration" >Stream</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Trabajando+con+1+mill%C3%B3n+de+registros+con+Java+Stream+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Ftranajando-con-1millon-de-registros-con-java-stream%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Trabajando+con+1+mill%C3%B3n+de+registros+con+Java+Stream+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Ftranajando-con-1millon-de-registros-con-java-stream%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Ftranajando-con-1millon-de-registros-con-java-stream%2F&text=Trabajando+con+1+mill%C3%B3n+de+registros+con+Java+Stream+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Ftranajando-con-1millon-de-registros-con-java-stream%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/high-performance-reactive-applications-with-spring-webflux/"><div class="card-body"> <em class="small" data-ts="1676043120" data-df="YYYY-MM-DD" > 2023-02-10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Aplicaciones Reactivas de Alto Rendimiento con Spring WebFlux</h3><div class="text-muted small"><p> ¿Qué es Spring WebFlux Spring WebFlux es un proyecto del Framework Spring que permite el desarrollo de aplicaciones web asíncronas siguiendo el paradigma de programación reactivo. Ofrece una alt...</p></div></div></a></div><div class="card"> <a href="/posts/que-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico/"><div class="card-body"> <em class="small" data-ts="1738040400" data-df="YYYY-MM-DD" > 2025-01-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>¿Qué es y cómo funciona el Event Sourcing con un ejemplo práctico?</h3><div class="text-muted small"><p> ¿Qué es Event Sourcing? Event Sourcing es un patrón de arquitectura de software que trata cada cambio en el estado de una aplicación como un evento. En lugar de almacenar el estado actual de un ...</p></div></div></a></div><div class="card"> <a href="/posts/que-es-cqrs-y-como-funciona-con-un-ejemplo-practico/"><div class="card-body"> <em class="small" data-ts="1738645200" data-df="YYYY-MM-DD" > 2025-02-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>¿Qué es CQRS y cómo funciona? Con un ejemplo práctico.</h3><div class="text-muted small"><p> ¿Qué es CQRS y qué problema soluciona? CQRS (Command Query Responsibility Segregation) es un patrón arquitectónico que separa las operaciones de lectura y escritura en una aplicación. En lugar d...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/disenando-microservicios-con-ddd/" class="btn btn-outline-primary" prompt="Anterior"><p>Diseñando Microservicios con Domain Driven Design y NestJS</p></a> <a href="//posts/high-performance-reactive-applications-with-spring-webflux/" class="btn btn-outline-primary" prompt="Nuevo"><p>Aplicaciones Reactivas de Alto Rendimiento con Spring WebFlux</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
