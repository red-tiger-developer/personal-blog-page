<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Diseñando Microservicios con Domain Driven Design y NestJS" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/disenando-microservicios-con-ddd/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/disenando-microservicios-con-ddd/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-01-10T12:32:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Diseñando Microservicios con Domain Driven Design y NestJS" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2023-01-12T00:22:35-03:00","datePublished":"2023-01-10T12:32:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Diseñando Microservicios con Domain Driven Design y NestJS","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/disenando-microservicios-con-ddd/"},"url":"https://nullpointer-excelsior.github.io/posts/disenando-microservicios-con-ddd/"}</script><title>Diseñando Microservicios con Domain Driven Design y NestJS | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Diseñando Microservicios con Domain Driven Design y NestJS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Diseñando Microservicios con Domain Driven Design y NestJS</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1673364720" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-01-10 </em> </span> <span> Actualizado <em class="" data-ts="1673493755" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-01-12 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2534 palabras"> <em>14 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="https://i.ibb.co/tL13zyh/Screen-Shot-2023-01-11-at-20-38-51.png" alt="image" data-proofer-ignore></p><p>Domain Driven Design o DDD para los amigos es un enfoque de diseño donde las reglas y modelo de negocio son el corazón de la aplicación. Nos olvidamos de diseños técnicos y nos centramos más en casos de uso y el modelo de contextos asociados a la problemática a resolver. DDD es ideal para proyectos complejos tanto en software como de arquitectura. Dicho esto veremos el poder de DDD en una arquitectura orientada a microservicios.</p><p>La arquitectura de microservicios no solo se trata de tomar una aplicación enorme como un monolito y dividirla en partes o módulos pequeños independientes en tecnología y lenguaje para poder obtener una independencia de funcionalidades. Esto conlleva grandes desafíos como la comunicación entre los diversos componentes, cada microservicio es independiente, pero contribuye a una misma causa, la que es integrar un sistema más grande donde este tiene un propósito que cumplir.</p><h2 id="definiendo-microservicios-basados-en-ddd"><span class="mr-2">Definiendo microservicios basados en DDD</span><a href="#definiendo-microservicios-basados-en-ddd" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Cuando modelamos un sistema con DDD dividimos nuestra problemática en Bounded Contexts (límites de contexto), estos son los que marcan los límites de una funcionalidad en nuestra aplicación y define que importancia, comportamiento responsabilidad tendrán los componentes que conformen este Bounded Context. Cada contexto es independiente y la comunicación entre estos puede darse mediante eventos de dominio. Sus componentes, aunque compartan ciertas propiedades con los de otros contextos, son totalmente diferentes, ya que tienen su responsabilidad definida por el negocio. Esta característica de diseño sobre el dominio que posee DDD nos da la ventaja de definir las tecnologías adecuadas para cada contexto. Con esto la implementación de nuestros microservicios estará guiada por el dominio y cada microservicio representará una problemática específica resolver del sistema</p><h2 id="el-contexto-define-la-intención-y-su-responsabilidad"><span class="mr-2">El contexto define la intención y su responsabilidad</span><a href="#el-contexto-define-la-intención-y-su-responsabilidad" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>El contexto nos dice mucho</p><p><img data-src="https://i.ibb.co/hMmZYwt/The-Teachers-Copy-vs-What-They-Give-You-11012023201206.jpg" alt="meme contexto" data-proofer-ignore></p><p>La importancia del contexto en nuestros modelos es enorme. En aplicaciones tradicionales es típico modelar casos de negocio donde una tabla en base de datos representa distintos contextos dependiendo del caso. Por ejemplo, la tabla producto en una aplicación de ventas tiene su objetivo, pero en un contexto de bodega tiene otro y cada caso de uso diferente le dará más prioridad a ciertas propiedades sobre otras de la tabla. Cuando el sistema escale los requerimientos serán distintos y podemos también tener el problema que un cambio necesario para un contexto determinado como el de bodega afecte el contexto de ventas, esto repercute negativamente al momento de modelar nuestras lógicas de negocio, es por este motivo que una de las premisas de los microservicios es que cada microservicio es dueño de sus datos. Y esto encaja perfecto con la idea de Bounded Context en DDD.</p><h2 id="modelando-un-servicio-de-viajes-tipo-uber"><span class="mr-2">Modelando un servicio de viajes tipo UBER</span><a href="#modelando-un-servicio-de-viajes-tipo-uber" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Para levantar un stack de microservicios con DDD levantaremos un servicio de viajes tipo Uber donde definiremos unos módulos de ejemplo para poder implementar unos microservicios de ejemplo. Todo esto, ayudados por nuestro framework Gatuno NestJs. El proyecto es una implementación en Mono repositorio donde el sistema completo tendrá los siguientes contextos:</p><ul><li><code class="language-plaintext highlighter-rouge">enrollment</code>: Registro de conductores y pasajeros<li><code class="language-plaintext highlighter-rouge">tracking</code>: Seguimiento del vehículo el cual podrá emitir alertas de pánico.<li><code class="language-plaintext highlighter-rouge">trips</code>: Agendamiento de viajes</ul><p>Estas 3 características serán nuestros microservicios. Ahora generamos nuestro stack mediante la cli de NestJs lo importante acá es definir la librería <code class="language-plaintext highlighter-rouge">domain</code> la que contendrá la lógica del negocio donde incluye los contextos anteriormente descritos.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
nest new microservices-apps
nest generate library domain
</pre></table></code></div></div><blockquote><p>Si quieres aprender de monorepos con NestJs ven por <a href="https://nullpointer-excelsior.github.io/posts/mono-repo-with-nestjs/">acá</a> muchacho</p></blockquote><p>Entonces nuestra librería <code class="language-plaintext highlighter-rouge">domain</code> queda la siguiente manera:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
├──  context
│   ├──  enrollment
│   │   ├──  entity
│   │   │   ├──  Account.ts
│   │   │   ├──  Driver.ts
│   │   │   └──  Rider.ts
│   │   ├──  event
│   │   │   ├──  AccountCreated.ts
│   │   │   ├──  DriverCreated.ts
│   │   │   └──  RiderCreated.ts
│   │   ├──  port
│   │   │   ├──  AccountRepository.ts
│   │   │   ├──  DriverRepository.ts
│   │   │   └──  RiderRepository.ts
│   │   └──  vo
│   │       ├──  Capacity.ts
│   │       ├──  Color.ts
│   │       ├──  Email.ts
│   │       ├──  Model.ts
│   │       ├──  Vehicule.ts
│   │       └──  Year.ts
│   ├──  tracking
│   │   ├──  entity
│   │   │   ├──  Driver.ts
│   │   │   ├──  PanicAlert.ts
│   │   │   └──  Vehicule.ts
│   │   ├──  event
│   │   │   ├──  ButtonPanicActivated.ts
│   │   │   ├──  ButtonPanicDesactivated.ts
│   │   │   └──  GpsPositionUpdated.ts
│   │   ├──  port
│   │   │   ├──  DriverRepository.ts
│   │   │   └──  VehiculeRepository.ts
│   │   └──  vo
│   │       └──  GpsPosition.ts
│   └──  trips
│       ├──  entity
│       │   ├──  Driver.ts
│       │   ├──  Rider.ts
│       │   ├──  Trip.ts
│       │   └──  Vehicule.ts
│       ├──  event
│       │   └──  DriverAssigned.ts
│       ├──  GpsPosition.ts
│       └──  vo
│           ├──  MapPoint.ts
│           ├──  Pricing.ts
│           └──  TripState.ts
├──  index.ts
└──  shared
    ├──  domain
    │   ├──  PersonInfo.ts
    │   ├──  Plate.ts
    │   └──  vo
    ├──  libs
    │   └──  schemaValidator.ts
    └──  seedwork
        ├──  AggregateRoot.ts
        ├──  DomainEvent.ts
        ├──  DomainException.ts
        ├──  Entity.ts
        ├──  Identifier.ts
        ├──  port
        │   └──  DomainEventBus.ts
        ├──  UniqueEntityID.ts
        ├──  UseCase.ts
        └──  ValueObject.ts
</pre></table></code></div></div><p>Mientras tanto le echamos una mirada a al módulo de tracking y la entidad Vehicule</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
</pre><td class="rouge-code"><pre>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">VehiculeState</span> <span class="p">{</span>
    <span class="nl">plate</span><span class="p">:</span> <span class="nx">Plate</span><span class="p">;</span>
    <span class="nl">driver</span><span class="p">:</span> <span class="nx">Driver</span><span class="p">;</span>
    <span class="nl">position</span><span class="p">:</span> <span class="nx">GpsPosition</span><span class="p">;</span>
    <span class="nl">isPanicButtonActive</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">panicAlerts</span><span class="p">:</span> <span class="nx">PanicAlert</span><span class="p">[]</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">Vehicule</span> <span class="kd">extends</span> <span class="nx">Entity</span><span class="o">&lt;</span><span class="nx">VehiculeState</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="na">props</span><span class="p">:</span> <span class="nx">EntityProps</span><span class="o">&lt;</span><span class="nx">VehiculeState</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">GpsPositionUpdated</span><span class="p">({</span>
                <span class="p">...</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
            <span class="p">})</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">updatePosition</span><span class="p">(</span><span class="na">position</span><span class="p">:</span> <span class="nx">GpsPosition</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">position</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">GpsPositionUpdated</span><span class="p">({</span>
            <span class="p">...</span><span class="nx">position</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
        <span class="p">}))</span>

    <span class="p">}</span>

    <span class="nx">activeButtonPanic</span><span class="p">(</span><span class="na">position</span><span class="p">:</span> <span class="nx">GpsPosition</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isPanicButtonActive</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">position</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">panicAlerts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">PanicAlert</span><span class="p">({</span>
            <span class="na">position</span><span class="p">:</span> <span class="nx">position</span><span class="p">,</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">button-panic-active</span><span class="dl">'</span>
        <span class="p">}))</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">ButtonPanicActivated</span><span class="p">({</span>
            <span class="na">vehiculeID</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
            <span class="na">position</span><span class="p">:</span> <span class="nx">position</span>
        <span class="p">}))</span>

    <span class="p">}</span>

    <span class="nx">desactiveButtonPanic</span><span class="p">(</span><span class="na">position</span><span class="p">:</span> <span class="nx">GpsPosition</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isPanicButtonActive</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isPanicButtonActive</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">position</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">panicAlerts</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">PanicAlert</span><span class="p">({</span>
            <span class="na">position</span><span class="p">:</span> <span class="nx">position</span><span class="p">,</span>
            <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">button-panic-desactive</span><span class="dl">'</span>
        <span class="p">}))</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="k">new</span> <span class="nx">ButtonPanicDesactivated</span><span class="p">({</span>
            <span class="na">vehiculeID</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span>
            <span class="na">position</span><span class="p">:</span> <span class="nx">position</span>
        <span class="p">}))</span>

    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">plate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">plate</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">position</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">position</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">driver</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">driver</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">isButtonPanicActive</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isPanicButtonActive</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Nuestra entidad <code class="language-plaintext highlighter-rouge">Vehicule</code> muestra lógica asociada a la ubicación y alertas de pánico, pero si vemos el código de <code class="language-plaintext highlighter-rouge">Vehicule</code> en el contexto de <code class="language-plaintext highlighter-rouge">enrollment</code> vemos que esta no es una entidad sino un value object que tiene otra responsabilidad</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">VehiculeProps</span> <span class="p">{</span>
    <span class="nl">plate</span><span class="p">:</span> <span class="nx">Plate</span><span class="p">;</span>
    <span class="nl">model</span><span class="p">:</span> <span class="nx">Model</span><span class="p">;</span>
    <span class="nl">color</span><span class="p">:</span> <span class="nx">Color</span><span class="p">;</span>
    <span class="nl">year</span><span class="p">:</span> <span class="nx">Year</span><span class="p">;</span>
    <span class="nl">capacity</span><span class="p">:</span> <span class="nx">Capacity</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">Vehicule</span> <span class="kd">extends</span> <span class="nx">ValueObject</span><span class="o">&lt;</span><span class="nx">VehiculeProps</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="na">props</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">licence</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">firstname</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">lastname</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">phoneNumber</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">plate</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">model</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">color</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">year</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
        <span class="nl">capacity</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="p">}){</span>
        <span class="k">super</span><span class="p">({</span>
            <span class="na">plate</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Plate</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">plate</span><span class="p">),</span>
            <span class="na">capacity</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Capacity</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">capacity</span><span class="p">),</span>
            <span class="na">color</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Color</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">color</span><span class="p">),</span>
            <span class="na">model</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Model</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">model</span><span class="p">),</span>
            <span class="na">year</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Year</span><span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">year</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">plate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">plate</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">model</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">color</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">color</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">year</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">year</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">get</span> <span class="nx">capacity</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">year</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Con esto podemos aclarar más la idea de contextos y sus límites.</p><h2 id="librería-application-y-la-definición-de-los-casos-de-uso"><span class="mr-2">Librería application y la definición de los casos de uso</span><a href="#librería-application-y-la-definición-de-los-casos-de-uso" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nuestra librería <code class="language-plaintext highlighter-rouge">domain</code> esta implementada ahora crearemos una nueva librería llamada <code class="language-plaintext highlighter-rouge">application</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
nest generate library application
</pre></table></code></div></div><p>Esta contendrá los casos de uso de nuestra aplicación esta capa contendrá la definición de los módulos de NestJs por cada contexto de nuestro dominio.</p><p>Caso de uso <code class="language-plaintext highlighter-rouge">enrollment</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">EnrollmentUseCasesService</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">driver</span><span class="p">:</span> <span class="nx">DriverRepository</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">rider</span><span class="p">:</span> <span class="nx">RiderRepository</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">account</span><span class="p">:</span> <span class="nx">AccountRepository</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">eventbus</span><span class="p">:</span> <span class="nx">DomainEventBus</span>
    <span class="p">)</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="nx">createAccount</span><span class="p">(</span><span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="kd">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="nx">Account</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span>
        
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">account</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">eventbus</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">account</span><span class="p">.</span><span class="nx">pullEvents</span><span class="p">())</span>

    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">enrollDriver</span><span class="p">(</span><span class="nx">dto</span><span class="p">:</span> <span class="nx">EnrollDriverDto</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="kd">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">dto</span><span class="p">.</span><span class="nx">accountID</span><span class="p">)</span>
        <span class="kd">const</span> <span class="nx">driver</span> <span class="o">=</span> <span class="nx">Driver</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="p">...</span><span class="nx">dto</span><span class="p">,</span> <span class="nx">account</span> <span class="p">})</span>
        
        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">driver</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">driver</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">eventbus</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">driver</span><span class="p">.</span><span class="nx">pullEvents</span><span class="p">())</span>

    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">enrollRider</span><span class="p">(</span><span class="nx">dto</span><span class="p">:</span> <span class="nx">EnrollRiderDto</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="kd">const</span> <span class="nx">account</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="nx">dto</span><span class="p">.</span><span class="nx">accountID</span><span class="p">)</span>
        <span class="kd">const</span> <span class="nx">rider</span> <span class="o">=</span> <span class="nx">Rider</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="p">...</span><span class="nx">dto</span><span class="p">,</span> <span class="nx">account</span> <span class="p">})</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">rider</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">rider</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">eventbus</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">rider</span><span class="p">.</span><span class="nx">pullEvents</span><span class="p">())</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Caso de uso <code class="language-plaintext highlighter-rouge">tracking</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">TrackingUseCasesService</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">vehicule</span><span class="p">:</span> <span class="nx">VehiculeRepository</span><span class="p">,</span> 
        <span class="k">private</span> <span class="k">readonly</span> <span class="nx">eventbus</span><span class="p">:</span> <span class="nx">DomainEventBus</span>
    <span class="p">)</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="nx">startTracking</span><span class="p">(</span><span class="nx">dto</span><span class="p">:</span> <span class="nx">StartTrackingDto</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="nx">driver</span> <span class="o">=</span> <span class="nx">Driver</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="p">...</span><span class="nx">dto</span><span class="p">.</span><span class="nx">driver</span> <span class="p">})</span>
        <span class="kd">const</span> <span class="nx">vehicule</span> <span class="o">=</span> <span class="nx">Vehicule</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span> <span class="p">..</span><span class="nx">dto</span><span class="p">,</span> <span class="nx">vehicule</span> <span class="p">})</span>

        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">vehicule</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">vehicule</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">eventbus</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">vehicule</span><span class="p">.</span><span class="nx">pullEvents</span><span class="p">())</span>

    <span class="p">}</span>

    <span class="k">async</span> <span class="nx">updateTracking</span><span class="p">(</span><span class="nx">dto</span><span class="p">:</span> <span class="nx">UpdateTrackingDto</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="nx">vehicule</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">vehicule</span><span class="p">.</span><span class="nx">findById</span><span class="p">(</span><span class="k">new</span> <span class="nx">UniqueEntityID</span><span class="p">(</span><span class="nx">dto</span><span class="p">.</span><span class="nx">vehiculeID</span><span class="p">))</span>
        <span class="nx">vehicule</span><span class="p">.</span><span class="nx">updatePosition</span><span class="p">(</span><span class="k">new</span> <span class="nx">GpsPosition</span><span class="p">({</span> 
            <span class="p">...</span><span class="nx">dto</span> 
        <span class="p">}))</span>

        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">vehicule</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">vehicule</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">eventbus</span><span class="p">.</span><span class="nx">dispatch</span><span class="p">(</span><span class="nx">vehicule</span><span class="p">.</span><span class="nx">pullEvents</span><span class="p">())</span>

    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><h2 id="integrando-el-dominio-con-nestjs-mediante-módulos-dinámicos"><span class="mr-2">Integrando el dominio con Nestjs mediante módulos dinámicos</span><a href="#integrando-el-dominio-con-nestjs-mediante-módulos-dinámicos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Los módulos dinámicos que nos provee NestJs son excelentes para integrar componentes de software totalmente desacoplados.</p><p>Empezamos definiendo la estructura de las opciones de nuestro módulo, lo haremos con el contexto de tracking, pero la misma lógica se aplica a otros contextos. El parámetro <code class="language-plaintext highlighter-rouge">Type</code> es propio de NestJs, Nos ayuda a trabajar con <code class="language-plaintext highlighter-rouge">providers</code> y <code class="language-plaintext highlighter-rouge">modules</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kr">interface</span> <span class="nx">TrackingModuleOptions</span> <span class="p">{</span>
    <span class="nl">modules</span><span class="p">:</span> <span class="nx">Type</span><span class="p">[]</span>
    <span class="nx">adapters</span><span class="p">:</span> <span class="p">{</span>
        <span class="nl">vehiculeRepository</span><span class="p">:</span> <span class="nx">Type</span><span class="o">&lt;</span><span class="nx">VehiculeRepository</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="nl">eventbus</span><span class="p">:</span> <span class="nx">Type</span><span class="o">&lt;</span><span class="nx">DomainEventBus</span><span class="o">&gt;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">TrackingModuleOptions</code> recibe los siguientes parámetros:</p><ul><li><code class="language-plaintext highlighter-rouge">modules</code>: módulos NestJs a importar para poder hacer uso de providers externos.<li><code class="language-plaintext highlighter-rouge">adapters</code>: providers que implementan los puertos definidos en nuestro dominio, estos providers deben estar en los módulos registros por le parámetro <code class="language-plaintext highlighter-rouge">modules</code> de <code class="language-plaintext highlighter-rouge">TrackingModuleOptions</code>.</ul><p>Ahora la interfaz <code class="language-plaintext highlighter-rouge">TrackingModuleOptions</code> la integraremos al método <code class="language-plaintext highlighter-rouge">register()</code> de nuestro módulo <code class="language-plaintext highlighter-rouge">tracking</code> de esta manera nuestro casos de uso podemos inyectarlo como proveedor de NestJS mediante la ayuda e <code class="language-plaintext highlighter-rouge">useFactory</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Module</span><span class="p">({})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">TrackingModule</span> <span class="p">{</span>

    <span class="k">static</span> <span class="nx">register</span><span class="p">(</span><span class="nx">options</span><span class="p">:</span> <span class="nx">TrackingModuleOptions</span><span class="p">):</span> <span class="nx">DynamicModule</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="p">{</span> <span class="nx">modules</span><span class="p">,</span> <span class="nx">adapters</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">options</span>
        <span class="kd">const</span> <span class="p">{</span> <span class="nx">vehiculeRepository</span><span class="p">,</span> <span class="nx">eventbus</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">adapters</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="na">module</span><span class="p">:</span> <span class="nx">TrackingModule</span><span class="p">,</span>
            <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">...</span><span class="nx">modules</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="na">exports</span><span class="p">:</span> <span class="p">[</span>
                <span class="nx">TrackingUseCasesService</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="na">provide</span><span class="p">:</span> <span class="nx">TrackingUseCasesService</span><span class="p">,</span>
                    <span class="nx">useFactory</span><span class="p">(</span><span class="na">repository</span><span class="p">:</span> <span class="nx">VehiculeRepository</span><span class="p">,</span> <span class="na">eventbus</span><span class="p">:</span> <span class="nx">DomainEventBus</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="k">new</span> <span class="nx">TrackingUseCasesService</span><span class="p">(</span><span class="nx">repository</span><span class="p">,</span> <span class="nx">eventbus</span><span class="p">)</span>
                    <span class="p">},</span>
                    <span class="na">inject</span><span class="p">:[</span>
                        <span class="nx">vehiculeRepository</span><span class="p">,</span>
                        <span class="nx">eventbus</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>

    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Y ahora crearemos nuestro microservicio <code class="language-plaintext highlighter-rouge">tracking-ms</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
nest generate app tracking-ms
nest genrate module core
nest genrate module adapter
nest genrate module http-server

</pre></table></code></div></div><p>Para poder hacer uso de nuestro módulo solo debemos crear los adaptadores correspondientes al módulo <code class="language-plaintext highlighter-rouge">tracking</code> en este caso necesitamos:</p><ul><li><code class="language-plaintext highlighter-rouge">DomianEventBus</code>: encargado de emitir eventos de dominio en este caso nos integraremos con RabbitMQ con el cual enviaremos nuestro evento de dominio.<li><code class="language-plaintext highlighter-rouge">VehiculeRepository</code>: encargado de la persistencia de vehículos en este caso es una implementación ordinaria en memoria.</ul><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">TrackingEventService</span> <span class="k">implements</span> <span class="nx">DomainEventBus</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">rabbitmq</span><span class="p">:</span> <span class="nx">RabbitMQClientService</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">events</span><span class="p">:</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">[]):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="nx">events</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">event</span> <span class="o">=&gt;</span><span class="k">this</span><span class="p">.</span><span class="nx">rabbitmq</span><span class="p">.</span><span class="nx">emitTo</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">VehiculeService</span> <span class="k">implements</span> <span class="nx">VehiculeRepository</span> <span class="p">{</span>
    
    <span class="k">private</span> <span class="nx">vehicules</span><span class="p">:</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="nx">UniqueEntityID</span><span class="p">,</span> <span class="nx">Vehicule</span><span class="o">&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">()</span>

    <span class="k">async</span> <span class="nx">save</span><span class="p">(</span><span class="nx">vehicule</span><span class="p">:</span> <span class="nx">Vehicule</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">vehicules</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">vehicule</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span> <span class="nx">vehicule</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">async</span> <span class="nx">findById</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="nx">UniqueEntityID</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Vehicule</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">vehicules</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><h2 id="la-comunicación-entre-microservicios-mediante-eventos-de-dominio"><span class="mr-2">La comunicación entre microservicios mediante eventos de dominio</span><a href="#la-comunicación-entre-microservicios-mediante-eventos-de-dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Los eventos de dominio que generaran nuestro contextos serán la forma en que estos se comunicaran entre sí de forma asíncrona para esto podemos implementar un broker de mensajería con RabbitMQ a modo de ejemplo. Para lograr un componente encargado de los eventos reutilizable generaremos un módulo llamdo <code class="language-plaintext highlighter-rouge">event-queue</code> de NestJs en la librería <code class="language-plaintext highlighter-rouge">shared</code> de nuestro stack.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre> event-queue
├──  contants.ts
├──  event-queue.module.ts
└──  rabbitmq
    ├──  rabbitmq-message.ts
    └──  services
        └──  rabbitmq-client.service.ts
</pre></table></code></div></div><p>Y el código cliente de nuestro RabbitMQ:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">RabbitMQMessage</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">pattern</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">;</span>
    <span class="nl">data</span><span class="p">:</span> <span class="nx">T</span><span class="p">;</span>
<span class="p">}</span>


<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">EventQueueService</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">RABBITMQ_CLIENT</span><span class="p">)</span> <span class="k">private</span> <span class="nx">client</span><span class="p">:</span> <span class="nx">ClientProxy</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
 
    <span class="nx">emitTo</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">pattern</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">payload</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">RabbitMQMessage</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="na">message</span><span class="p">:</span> <span class="nx">RabbitMQMessage</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">id</span><span class="p">:</span> <span class="nx">uuidv4</span><span class="p">(),</span>
            <span class="na">pattern</span><span class="p">:</span> <span class="nx">pattern</span><span class="p">,</span>
            <span class="na">timestamp</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
            <span class="na">data</span><span class="p">:</span> <span class="nx">payload</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">message</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><h2 id="registro-de-módulos-en-nuestros-microservicios"><span class="mr-2">Registro de módulos en nuestros microservicios</span><a href="#registro-de-módulos-en-nuestros-microservicios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Con nuestros puertos definidos ahora inicializaremos nuestro módulo <code class="language-plaintext highlighter-rouge">tracking</code> en el archivo <code class="language-plaintext highlighter-rouge">apps/tracking-ms/src/core/core.module.ts</code> haciendo uso de los providers del módulo <code class="language-plaintext highlighter-rouge">AdaperModule</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>
<span class="kd">const</span> <span class="nx">trackingModule</span> <span class="o">=</span> <span class="nx">TrackingModule</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span>
    <span class="na">modules</span><span class="p">:</span> <span class="p">[</span>
        <span class="nx">AdapterModule</span>
    <span class="p">],</span>
    <span class="na">adapters</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">vehiculeRepository</span><span class="p">:</span> <span class="nx">VehiculeService</span><span class="p">,</span>
        <span class="na">eventbus</span><span class="p">:</span> <span class="nx">TrackingEventService</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="p">@</span><span class="nd">Global</span><span class="p">()</span>
<span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
    <span class="na">imports</span><span class="p">:[</span>
        <span class="nx">trackingModule</span>
    <span class="p">],</span>
    <span class="na">exports</span><span class="p">:</span> <span class="p">[</span>
        <span class="nx">trackingModule</span>
    <span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CoreModule</span> <span class="p">{}</span>
</pre></table></code></div></div><p>Así ya tenemos nuestro microservicio listo su estructura es la siguiente:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>├──  core
│   │   └──  core.module.ts
│   ├──  infraestructure
│   │   ├──  adapter
│   │   │   ├──  adapter.module.ts
│   │   │   └──  services
│   │   │       ├──  tracking-event.service.ts
│   │   │       └──  vehicule.service.ts
│   │   └──  http-server
│   │       ├──  controller
│   │       │   └──  tracking.controller.ts
│   │       ├──  http-server.module.ts
│   │       └──  model
│   │           ├──  StartTrackingRequest.ts
│   │           └──  UpdateTrackingRequest.ts
</pre></table></code></div></div><p>Nuestros otros contextos tendrán una implementación casi idéntica, diferirán en los adaptadores y otras propiedades que dependerán del caso.</p><p>Para iniciar nuestra aplicación ejecutamos lo siguiente:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>docker run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">--hostname</span> DDD-rabitmq <span class="nt">-p</span> 15672:15672 <span class="nt">-p</span> 5672:5672 rabbitmq:3-management

nest start <span class="nt">-w</span> tracking-ms
nest start <span class="nt">-w</span> enrollment-ms
nest start <span class="nt">-w</span> trips-ms

</pre></table></code></div></div><h2 id="conclusiones"><span class="mr-2">Conclusiones</span><a href="#conclusiones" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Diseñamos la base para una arquitectura de microservicios utilizando las bondades de diseño que nos brinda DDD. Este enfoque no solo nos da una mirada más al negocio, sino que se complementa bien en el diseño de software en sistemas complejos y distribuidos si bien DDD puede ser complejo, empezar por utilizar sus conceptos será un buen inicio.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/nestjs-microservices-with-ddd">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h2 id="finalizando"><span class="mr-2">Finalizando</span><a href="#finalizando" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Para terminar nos despedimos con el meme de cortesía.</p><p><img data-src="https://i.ibb.co/bJ40Znm/Zombo-Meme-27122022141407.jpg" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/programacion/'>Programacion</a>, <a href='//categories/nestjs/'>Nestjs</a>, <a href='//categories/arquitectura-de-software/'>Arquitectura de software</a>, <a href='//categories/typescript/'>Typescript</a>, <a href='//categories/domain-driven-design/'>Domain Driven Design</a>, <a href='//categories/ddd/'>DDD</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/typescript/" class="post-tag no-text-decoration" >typescript</a> <a href="//tags/nestjs/" class="post-tag no-text-decoration" >NestJs</a> <a href="//tags/hexagonal/" class="post-tag no-text-decoration" >hexagonal</a> <a href="//tags/microservices/" class="post-tag no-text-decoration" >microservices</a> <a href="//tags/ddd/" class="post-tag no-text-decoration" >ddd</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Dise%C3%B1ando+Microservicios+con+Domain+Driven+Design+y+NestJS+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fdisenando-microservicios-con-ddd%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Dise%C3%B1ando+Microservicios+con+Domain+Driven+Design+y+NestJS+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fdisenando-microservicios-con-ddd%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fdisenando-microservicios-con-ddd%2F&text=Dise%C3%B1ando+Microservicios+con+Domain+Driven+Design+y+NestJS+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fdisenando-microservicios-con-ddd%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/"><div class="card-body"> <em class="small" data-ts="1667835120" data-df="YYYY-MM-DD" > 2022-11-07 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CQRS en Soluciones de Alto Rendimiento con Nestjs</h3><div class="text-muted small"><p> CQRS es una solución de diseño de software que separa las operaciones de lectura y escritura de nuestra aplicación. Esto no es mero capricho de la ingeniería de software. Este enfoque que proporc...</p></div></div></a></div><div class="card"> <a href="/posts/implementando-hexagonal-con-nestjs-part1/"><div class="card-body"> <em class="small" data-ts="1666711920" data-df="YYYY-MM-DD" > 2022-10-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitectura hexagonal con nestjs Parte I</h3><div class="text-muted small"><p> No voy a profundizar en que es una arquitectura hexagonal, ya que tenemos un montón de recursos que te lo explican de forma detallada, pero ojo que cuando hablamos de este tipo de arquitecturas d...</p></div></div></a></div><div class="card"> <a href="/posts/implementando-hexagonal-con-nestjs-part2/"><div class="card-body"> <em class="small" data-ts="1666798320" data-df="YYYY-MM-DD" > 2022-10-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitectura hexagonal Parte II Conectando una clean architecture con Nestjs</h3><div class="text-muted small"><p> La segunda parte de esta serie de arquitectura hexagonal o (clean architecture) profundizaremos como configurar la interacción de un framework con el core de nuestra arquitectura, Nestjs nos ofre...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/mono-repo-with-nestjs/" class="btn btn-outline-primary" prompt="Anterior"><p>Mono Repositorios con Nestjs Para una Arquitectura Orientada a Eventos</p></a> <a href="//posts/tranajando-con-1millon-de-registros-con-java-stream/" class="btn btn-outline-primary" prompt="Nuevo"><p>Trabajando con 1 millón de registros con Java Stream</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
