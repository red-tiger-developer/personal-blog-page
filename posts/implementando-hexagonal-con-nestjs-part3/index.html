<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Arquitectura hexagonal Parte III Modelando el Dominio a Fondo con Domain Driven Design" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/implementando-hexagonal-con-nestjs-part3/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/implementando-hexagonal-con-nestjs-part3/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-07T12:32:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Arquitectura hexagonal Parte III Modelando el Dominio a Fondo con Domain Driven Design" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2022-12-05T00:19:47-03:00","datePublished":"2022-11-07T12:32:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Arquitectura hexagonal Parte III Modelando el Dominio a Fondo con Domain Driven Design","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/implementando-hexagonal-con-nestjs-part3/"},"url":"https://nullpointer-excelsior.github.io/posts/implementando-hexagonal-con-nestjs-part3/"}</script><title>Arquitectura hexagonal Parte III Modelando el Dominio a Fondo con Domain Driven Design | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Arquitectura hexagonal Parte III Modelando el Dominio a Fondo con Domain Driven Design</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Arquitectura hexagonal Parte III Modelando el Dominio a Fondo con Domain Driven Design</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1667835120" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-11-07 </em> </span> <span> Actualizado <em class="" data-ts="1670210387" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-12-05 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4991 palabras"> <em>27 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="https://i.ibb.co/v1HNZKR/Screen-Shot-2022-11-14-at-10-19-55.png" alt="image" data-proofer-ignore></p><p>En post anteriores vimos como implementar una arquitectura hexagonal y aprendimos sus principales conceptos y componentes. En esta oportunidad modelaremos en profundidad el Dominio de nuestra aplicación aplicando Domain Driven Design.</p><p>Arquitectura Hexagonal y Domain Driven Design son clean architecture. Hexagonal y DDD se complementan muy bien pero son cosas distintas mientras hexagonal hace enfasis en separar mediante adaptadores y puertos el dominio y los casos de uso de la infraestructura DDD se centra en el diseño de la capa de dominio. En resumen básicamente la diferencia es que hexagonal se enfoca más en los adaptadores y puertos para desacoplar nuestro modelo de las tecnologías empleadas mientras que DDD es el diseño orientado al dominio de negocio y los casos de uso después de este breve resumen vamos al maldito código</p><h2 id="creando-un-microservicio-para-registrar-usuarios"><span class="mr-2">Creando un microservicio para registrar usuarios</span><a href="#creando-un-microservicio-para-registrar-usuarios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>La aplicación que crearemos será un servicio para administrar usuarios iremos iterando sobre algunos caso de uso simples e implementaremos un modelado de dominio a fondo utilizando Domain Driven Design empezaremos por el siguiente caso de uso:</p><p><code class="language-plaintext highlighter-rouge">Creación de usuarios</code></p><ul><li>Se necesita un servicio que cree usuarios donde el username debe tener el siguiente formato: la primera letra del nombre seguido de un punto y de su apellido, en caso de que exista un usuario con esta nomenclatura se debe agregar un número correlacional ejemplo : para el empleado john wick su usuario sería <code class="language-plaintext highlighter-rouge">j.wick00</code> y jordan wick sería <code class="language-plaintext highlighter-rouge">j.wick01</code> al crear el usuario debemos notificarlo mediante un email</ul><p>Muy bien creamos nuestra app Nestjs y sus módulos</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>nest new user-micro-service
<span class="nb">cd </span>user-micro-service
nest generate module core
nest generate module infraestructure

</pre></table></code></div></div><p>Ahora generamos la siguiente estructura básica de de directorios</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>──  core
│   ├──  application
│   │   ├──  ports
│   │   └──  services
│   ├──  core.module.ts
│   ├──  domain
│   │   ├──  model
│   │   └──  ports
│   │   │   ├──  inbound
│   │   │   └──  outbound
│   │   ├──  services
│   └──  shared
│       ├──  dto
│       └──  error
├──  infraestructure
│   ├──  adapters
│   └──  infraestructure.module.ts

</pre></table></code></div></div><p>Con esta estructura empezaremos a aplicar DDD como locos</p><h2 id="1---definiendo-entidades"><span class="mr-2">1 - Definiendo Entidades</span><a href="#1---definiendo-entidades" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Crearemos una clase abstract base para nuestras entidades</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">Entity</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">{</span>

    <span class="na">id</span><span class="p">:</span> <span class="nx">Id</span><span class="p">;</span>

    <span class="kd">abstract</span> <span class="nx">equalsTo</span><span class="p">(</span><span class="na">entity</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Esta clase define el método abstracto equalsTo() para que sus clases hijas tengan que implementar la lógica de igualdad en entidades. Entonces la forma básica de definir nuestras entidades sería la siguiente:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">User</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span> <span class="p">{</span>
    
    <span class="na">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">confirmed</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="nx">equalsTo</span><span class="p">(</span><span class="na">entity</span><span class="p">:</span> <span class="nx">User</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">===</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Definimos valores primitivos y los asignamos nada del otro mundo, como definimos nuestras clases en la mayoría de los proyectos que hemos trabajado, pero esto tiene un detalle los valores primitivos pueden representar cosas totalmente alejadas a nuestro dominio, pueden romper reglas de negocio incluso la integridad de los datos almacenados si no existen restricciones en el motor de base de datos escogido veamos este ejemplo:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">()</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">john.carter</span><span class="dl">'</span> <span class="c1">// this in not a email</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">a john le gusta la c...</span><span class="dl">'</span> <span class="c1">// XD</span>
</pre></table></code></div></div><p>Esto no representa nuestra entidad, esto no es correcto generalmente en enfoques tradicionales agregamos validaciones a nivel de peticiones HTTP o restricciones de base de datos, o podemos delegar esta responsabilidad a servicios de dominio u otra lógica de negocio.</p><p>Pero somos ingenieros de software y vamos por una solución mas cercana al dominio.</p><h2 id="2---value-objects-en-el-dominio"><span class="mr-2">2 - Value Objects en el Dominio</span><a href="#2---value-objects-en-el-dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Vamos a redefinir nuestra Entidad reemplazando nuestras variables primitivas por unos nuevos objetos llamados <code class="language-plaintext highlighter-rouge">ValueObjects</code> estos objetos son una especie de envoltura sobre valores primitivos para poder representar uno o más valores relacionados con nuestro modelo de dominio estos son objetos inmutables una vez instanciados no debemos cambiar su valor. La principal diferencia entre una entidad y un Value Object es que una entidad posee identidad es decir que contiene un valor como una id que lo identifica como único en nuestra aplicación en cambio el value object para compararlo debes comparar todas sus propiedades.</p><p>Ahora crearemos el siguiente value object</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">Email</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nx">getValue</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">email</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>Este nuevo objeto solo es una envoltura de un valor primitivo ¿Pero de qué nos sirve crear esto que beneficios nos trae? Parece ser código de sobra. Bien si nuestro value object no sirve para nada hasta ahora. Pero como esta clase representa un Email vamos a agregar la siguiente lógica de validación:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">Email</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">email</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">EmailValidException</span><span class="p">(</span><span class="s2">`Email value </span><span class="p">${</span><span class="nx">email</span><span class="p">}</span><span class="s2"> is not valid`</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">validate</span><span class="p">(</span><span class="nx">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="sr">/^</span><span class="se">(([^</span><span class="sr">&lt;&gt;()</span><span class="se">\[\]\\</span><span class="sr">.,;:</span><span class="se">\s</span><span class="sr">@"</span><span class="se">]</span><span class="sr">+</span><span class="se">(\.[^</span><span class="sr">&lt;&gt;()</span><span class="se">\[\]\\</span><span class="sr">.,;:</span><span class="se">\s</span><span class="sr">@"</span><span class="se">]</span><span class="sr">+</span><span class="se">)</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(</span><span class="sr">".+"</span><span class="se">))</span><span class="sr">@</span><span class="se">((\[[</span><span class="sr">0-9</span><span class="se">]{1,3}\.[</span><span class="sr">0-9</span><span class="se">]{1,3}\.[</span><span class="sr">0-9</span><span class="se">]{1,3}\.[</span><span class="sr">0-9</span><span class="se">]{1,3}\])</span><span class="sr">|</span><span class="se">(([</span><span class="sr">a-zA-Z</span><span class="se">\-</span><span class="sr">0-9</span><span class="se">]</span><span class="sr">+</span><span class="se">\.)</span><span class="sr">+</span><span class="se">[</span><span class="sr">a-zA-Z</span><span class="se">]{2,}))</span><span class="sr">$/</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nx">getValue</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">email</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>Ahora nuestro <code class="language-plaintext highlighter-rouge">ValueObject</code> tiene sentido entonces para ahorrar esfuerzo en crear más <code class="language-plaintext highlighter-rouge">ValueObject</code> crearemos una clase base abstracta:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">ValueObjectBase</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">protected</span> <span class="kd">abstract</span> <span class="nx">validate</span><span class="p">(</span><span class="na">value</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="na">primitiveValue</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="na">errorMessage</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">(</span><span class="nx">primitiveValue</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">DomainException</span><span class="p">(</span><span class="nx">errorMessage</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">getValue</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">primitiveValue</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>Aplicamos <code class="language-plaintext highlighter-rouge">Template method</code> para reutilizar lógica y extender su funcionalidad mediante sus hijos.</p></blockquote><p>y definiremos nuevos value objects de la siguiente manera:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="c1">// Email</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Email</span> <span class="kd">extends</span> <span class="nx">ValueObject</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="na">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">super</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="s2">`Invalid Email Address: </span><span class="p">${</span><span class="nx">email</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span> 
    <span class="p">}</span>

    <span class="nx">validate</span><span class="p">(</span><span class="na">email</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="sr">/^</span><span class="se">(([^</span><span class="sr">&lt;&gt;()</span><span class="se">\[\]\\</span><span class="sr">.,;:</span><span class="se">\s</span><span class="sr">@"</span><span class="se">]</span><span class="sr">+</span><span class="se">(\.[^</span><span class="sr">&lt;&gt;()</span><span class="se">\[\]\\</span><span class="sr">.,;:</span><span class="se">\s</span><span class="sr">@"</span><span class="se">]</span><span class="sr">+</span><span class="se">)</span><span class="sr">*</span><span class="se">)</span><span class="sr">|</span><span class="se">(</span><span class="sr">".+"</span><span class="se">))</span><span class="sr">@</span><span class="se">((\[[</span><span class="sr">0-9</span><span class="se">]{1,3}\.[</span><span class="sr">0-9</span><span class="se">]{1,3}\.[</span><span class="sr">0-9</span><span class="se">]{1,3}\.[</span><span class="sr">0-9</span><span class="se">]{1,3}\])</span><span class="sr">|</span><span class="se">(([</span><span class="sr">a-zA-Z</span><span class="se">\-</span><span class="sr">0-9</span><span class="se">]</span><span class="sr">+</span><span class="se">\.)</span><span class="sr">+</span><span class="se">[</span><span class="sr">a-zA-Z</span><span class="se">]{2,}))</span><span class="sr">$/</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">());</span>
    <span class="p">}</span>
    
<span class="p">}</span>
<span class="c1">// Id </span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">Id</span> <span class="kd">extends</span> <span class="nx">ValueObject</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="s2">`Invalid UUID Id:</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2"> `</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">validate</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">re</span>  <span class="o">=</span>  <span class="sr">/^</span><span class="se">[</span><span class="sr">0-9a-f</span><span class="se">]{8}</span><span class="sr">-</span><span class="se">[</span><span class="sr">0-9a-f</span><span class="se">]{4}</span><span class="sr">-</span><span class="se">[</span><span class="sr">0-5</span><span class="se">][</span><span class="sr">0-9a-f</span><span class="se">]{3}</span><span class="sr">-</span><span class="se">[</span><span class="sr">089ab</span><span class="se">][</span><span class="sr">0-9a-f</span><span class="se">]{3}</span><span class="sr">-</span><span class="se">[</span><span class="sr">0-9a-f</span><span class="se">]{12}</span><span class="sr">$/i</span>
        <span class="k">return</span> <span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">generate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Id</span><span class="p">(</span><span class="nx">uuidv4</span><span class="p">())</span>
    <span class="p">}</span>
    
<span class="p">}</span>

</pre></table></code></div></div><p>Finalmente nuestro <code class="language-plaintext highlighter-rouge">Username ValueObject</code> tendra la lógica asociada a nuestro caso de uso del formato de nombre de usuario.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">Username</span> <span class="kd">extends</span> <span class="nx">ValueObject</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="na">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="s2">`Username </span><span class="p">${</span><span class="nx">username</span><span class="p">}</span><span class="s2"> doesn't follow Northiwind policies`</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="cm">/**
     * Username must be first letter of name followed by dot, lastname and number Ex: "a.smith0" or "a.smith1"
     * @param username 
     */</span>
    <span class="nx">validate</span><span class="p">(</span><span class="na">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">username</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="kd">const</span> <span class="nx">split</span> <span class="o">=</span> <span class="nx">username</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">split</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">createUsernameBase</span><span class="p">(</span><span class="na">firstname</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">lastname</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">firstname</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span><span class="s2">.</span><span class="p">${</span><span class="nx">lastname</span><span class="p">}</span><span class="s2">`</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">create</span><span class="p">(</span><span class="na">firstname</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">lastname</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Username</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">createUsernameBase</span><span class="p">(</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">lastname</span><span class="p">)}</span><span class="s2">00`</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">createWithIdentity</span><span class="p">(</span><span class="na">firstname</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">lastname</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">identity</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userNumber</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">identity</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Username</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">createUsernameBase</span><span class="p">(</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">lastname</span><span class="p">)}${</span><span class="nx">userNumber</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Ahora el concepto de value object toma más sentido y nos da una manera de crear reglas de negocio o validaciones de propiedades más cerca de nuestro dominio. En el desarrollo clásico estas validaciones las delegamos en librerías de terceros de validaciones o a servicios de negocio, Pero no siempre validamos un email o un largo de un texto tenemos que tener en cuenta que podemos encontrar reglas de negocio que no existirán en librerías de terceros.</p><p>Nuestra entidad queda así:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">User</span> <span class="kd">extends</span> <span class="nx">Entity</span> <span class="p">{</span>

    <span class="nl">username</span><span class="p">:</span> <span class="nx">Username</span><span class="p">;</span>
    <span class="nl">email</span><span class="p">:</span> <span class="nx">Email</span><span class="p">;</span>
    <span class="nl">confirmed</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Y el siguiente código nos arrojaría una excepción de dominio</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">user</span><span class="p">()</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">(</span><span class="dl">'</span><span class="s1">juan.lorca.gmail</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// throw DomainException() Invalid email</span>
</pre></table></code></div></div><p>Con este enfoque controlamos la creación de objetos con mas coherencia pero también tenemos una desventaja, Con entidades grandes la instanciación de nuestros objetos se vuelve tediosa y con excesivo código en muchos casos. Para solucionar esto podemos aplicar el patrón de diseño Builder:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserBuilder</span> <span class="p">{</span>

    <span class="k">private</span> <span class="nx">user</span><span class="p">:</span> <span class="nx">User</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">()</span>

    <span class="nx">id</span><span class="p">(</span><span class="nx">id</span><span class="p">:</span> <span class="nx">Id</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">Id</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">:</span> <span class="nx">id</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="p">}</span>

    <span class="nx">username</span><span class="p">(</span><span class="nx">username</span><span class="p">:</span> <span class="nx">Username</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">username</span>  <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">Username</span><span class="p">(</span><span class="nx">username</span><span class="p">)</span> <span class="p">:</span> <span class="nx">username</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="p">}</span>

    <span class="nx">email</span><span class="p">(</span><span class="nx">email</span><span class="p">:</span> <span class="nx">Email</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">email</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span> <span class="p">:</span> <span class="nx">email</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="p">}</span>

    <span class="nx">confirmed</span><span class="p">(</span><span class="nx">confirmed</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">confirmed</span> <span class="o">=</span> <span class="nx">confirmed</span>
        <span class="k">return</span> <span class="k">this</span>
    <span class="p">}</span>

    <span class="nx">build</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><blockquote><p>El pátron <code class="language-plaintext highlighter-rouge">builder</code> nos provee una manera de crear objetos complejos desde un objeto base y puede ir componiendose de más partes a medida que llamamos operaciones secuenciales para construir nuestro objeto final</p></blockquote><p>El funcionamiento de este patrón es simple:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">// creamos instancia de UserBuilder </span>
<span class="kd">const</span> <span class="nx">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UserBuilder</span><span class="p">()</span>
<span class="c1">// internamente se instancia un objeto User</span>
<span class="k">private</span> <span class="nx">user</span><span class="p">:</span> <span class="nx">User</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">()</span>
<span class="c1">// definimos metodos que reciben propiedades y las seteamos en nuestra instancia de User y devolvemos la instancia de UserBuilder con "this". De esta manera podemos encadenar los métodos de creación o devolver el mismo objeto builder para usarlo en futuras operaciones</span>
<span class="nx">email</span><span class="p">(</span><span class="nx">email</span><span class="p">:</span> <span class="nx">Email</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">email</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span> <span class="p">:</span> <span class="nx">email</span>
    <span class="k">return</span> <span class="k">this</span>
<span class="p">}</span>
<span class="c1">// Cuando ya setemaos las variables deseadas de nuestro User hacemos un llamado a l metodo build() y este devolvera el objeto User</span>
<span class="nx">build</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Lo siguiente será definir la lógica de creación o inicialización de usuarios a nuestra entidad ya definido nuestro builder lo declararemos como una clase interna de User y a su vez declararemos el constructor de user como privado para que solo User pueda instanciarse mediante las operaciones relacionadas con el dominio.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">User</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">constructor</span><span class="p">()</span> <span class="p">{}</span>
    <span class="c1">// values</span>
    <span class="k">private</span> <span class="k">static</span> <span class="nx">UserBuilder</span> <span class="o">=</span> <span class="kd">class</span>  <span class="p">{</span>
        <span class="c1">// code...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>tambien definiremos</p><p>Ahora empleamos nuestro builder de la siguiente manera en la entidad User agregando el método estático <code class="language-plaintext highlighter-rouge">create()</code> nuestra entidad quedaría así.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">User</span> <span class="kd">extends</span> <span class="nx">Entity</span> <span class="p">{</span>

    <span class="nl">username</span><span class="p">:</span> <span class="nx">Username</span><span class="p">;</span>
    <span class="nl">email</span><span class="p">:</span> <span class="nx">Email</span><span class="p">;</span>
    <span class="nl">confirmed</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="k">static</span> <span class="nx">create</span><span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="nx">CreateNewUserDto</span><span class="p">):</span> <span class="nx">User</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">email</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">user</span>
        <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">Id</span><span class="p">.</span><span class="nx">generate</span><span class="p">()</span>

        <span class="k">return</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">UserBuilder</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">username</span><span class="p">(</span><span class="nx">username</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">email</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">confirmed</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">build</span><span class="p">()</span>

    <span class="p">}</span>

    <span class="nx">equalsTo</span><span class="p">(</span><span class="nx">e</span><span class="p">:</span> <span class="nx">User</span><span class="p">):</span> <span class="nx">boolean</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span> <span class="o">===</span> <span class="nx">e</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">getValue</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="nx">UserBuilder</span> <span class="o">=</span> <span class="kd">class</span>  <span class="p">{</span>

        <span class="k">private</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">()</span>

        <span class="kd">constructor</span><span class="p">()</span> <span class="p">{}</span>
    
        <span class="nx">id</span><span class="p">(</span><span class="na">id</span><span class="p">:</span> <span class="nx">Id</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">id</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">Id</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">:</span> <span class="nx">id</span>
            <span class="k">return</span> <span class="k">this</span>
        <span class="p">}</span>
    
        <span class="nx">username</span><span class="p">(</span><span class="na">username</span><span class="p">:</span> <span class="nx">Username</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">username</span>  <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">Username</span><span class="p">(</span><span class="nx">username</span><span class="p">)</span> <span class="p">:</span> <span class="nx">username</span>
            <span class="k">return</span> <span class="k">this</span>
        <span class="p">}</span>
    
        <span class="nx">email</span><span class="p">(</span><span class="na">email</span><span class="p">:</span> <span class="nx">Email</span> <span class="o">|</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">email</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span> <span class="p">:</span> <span class="nx">email</span>
            <span class="k">return</span> <span class="k">this</span>
        <span class="p">}</span>
    
        <span class="nx">confirmed</span><span class="p">(</span><span class="na">confirmed</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">confirmed</span> <span class="o">=</span> <span class="nx">confirmed</span>
            <span class="k">return</span> <span class="k">this</span>
        <span class="p">}</span>
    
        <span class="nx">build</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">user</span>
        <span class="p">}</span>
    
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Muy bien ya aplicamos una solución al excesivo código boiler plate que nos puede generar entidades con un montón de <code class="language-plaintext highlighter-rouge">ValueObject</code></p><h2 id="3---definición-de-puertos-y-adaptadores-hexagonal-y-domain-driven-design-juntos"><span class="mr-2">3 - Definición de puertos y adaptadores hexagonal y Domain Driven Design Juntos</span><a href="#3---definición-de-puertos-y-adaptadores-hexagonal-y-domain-driven-design-juntos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>resumiendo de nuestro primer post <a href="/posts/implementando-hexagonal-con-nestjs-part1/">Arquitectura hexagonal Parte I </a> Los puertos son las entradas y salidas que nuestro dominio tiene para comunicarse con el resto de la aplicación es decir con infraestructura, tenemos 2 tipos de puertos:</p><ul><li><code class="language-plaintext highlighter-rouge">inbound (entrada):</code> representan los cambios de estado que queremos realizar en nuestro dominio como puede ser la actualización de el nombre de un usuario<li><code class="language-plaintext highlighter-rouge">outbound (sálida):</code> Representan los cambios que nuestro dominio quiere realizar fuera de él. Por ejemplo actualizar una base de datos</ul><p>Ahora definimos nuestros puertos casos de uso y redefinimos nuestros componentes a compartir en el directorio shared</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre>├──  core
│   ├──  application
│   │   ├──  services
│   │   |   ├──  CreateUserService.spec.ts
│   │   |   └──  CreateUserService.ts
|   |   └──  CreateUser.ts
│   ├──  core.module.ts
│   ├──  domain
│   │   ├──  model
│   │   │   ├──  entities
│   │   │   │   └──  User.ts
│   │   │   └──  valueobjects
│   │   │       ├──  Email.spec.ts
│   │   │       ├──  Email.ts
│   │   │       ├──  Username.spec.ts
│   │   │       └──  Username.ts
│   │   ├──  ports
│   │   │   ├──  inbound
│   │   │   │   └──  UniqueUsernameGenerator.ts
│   │   │   └──  outbound
│   │   │       └──  UserRepository.ts
│   │   └──  services
│   │       ├──  UniqueUsernameGeneratorService.spec.ts
│   │       └──  UniqueUsernameGeneratorService.ts
│   └──  shared
│       ├──  application
│       │   └──  ports
│       │       └──  outbound
│       │           └──  email-service
│       │               ├──  EmailMessage.ts
│       │               └──  EmailService.ts
│       ├──  domain
│       │   ├──  Entity.ts
│       │   ├──  ValueObject.ts
│       │   └──  valueobjects
│       │       ├──  Id.spec.ts
│       │       └──  Id.ts
│       ├──  dto
│       │   ├──  CreateUserDto.ts
│       │   └──  RegisterEmailNotificationDto.ts
│       └──  error
│           └──  DomainException.ts
</pre></table></code></div></div><p>Definición de puertos de dominio</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">UniqueUsernameGenerator</span> <span class="p">{</span>
    <span class="nx">generate</span><span class="p">(</span><span class="nx">firstname</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">lastname</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Username</span><span class="o">&gt;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">UserRepository</span> <span class="p">{</span>
    <span class="nx">save</span><span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="nx">User</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nx">findByUsernameStartWith</span><span class="p">(</span><span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Definición de puertos de aplicación</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">// Use case</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">CreateUser</span> <span class="p">{</span>
    <span class="nx">create</span><span class="p">(</span><span class="nx">createUser</span><span class="p">:</span> <span class="nx">CreateUserDto</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Definición de adaptadores de dominio:</p><p>En nuestro caso el puerto UserRepository será solo una implementación en memoria para simplificar el ejemplo</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">InMemoryUserRepository</span> <span class="k">implements</span> <span class="nx">UserRepository</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">users</span><span class="p">:</span> <span class="nx">User</span><span class="p">[])</span> <span class="p">{</span> <span class="p">}</span>
    
    <span class="k">async</span> <span class="nx">save</span><span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="nx">User</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
       <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="nx">findByUsernameStartWith</span><span class="p">(</span><span class="nx">username</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">User</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">.</span><span class="nx">getValue</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">username</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Definición de servicios de dominio:</p><p><code class="language-plaintext highlighter-rouge">UniqueUsernameGeneratorService</code> se encarga de generar el nombre de usuario de acuerdo a las políticas de nuestro fantasioso caso de uso.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">UniqueUsernameGeneratorService</span> <span class="k">implements</span> <span class="nx">UniqueUsernameGenerator</span> <span class="p">{</span>
   
    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">UserRepository</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">async</span> <span class="nx">generate</span><span class="p">(</span><span class="nx">firstname</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">lastname</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Username</span><span class="o">&gt;</span> <span class="p">{</span>
        
        <span class="kd">const</span> <span class="nx">usernamebase</span> <span class="o">=</span> <span class="nx">Username</span><span class="p">.</span><span class="nx">createUsernameBase</span><span class="p">(</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">lastname</span><span class="p">)</span>
        <span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">findByUsernameStartWith</span><span class="p">(</span><span class="nx">usernamebase</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">users</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">identity</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="nx">Username</span><span class="p">.</span><span class="nx">createWithIdentity</span><span class="p">(</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">lastname</span><span class="p">,</span> <span class="nx">identity</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="nx">Username</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">lastname</span><span class="p">)</span>
        
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><h2 id="4---servicios-de-aplicación-implementación-de-caso-de-uso"><span class="mr-2">4 - Servicios de aplicación implementación de caso de uso</span><a href="#4---servicios-de-aplicación-implementación-de-caso-de-uso" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>En la implementación de nuestro caso de uso hacemos inyección de los puertos <code class="language-plaintext highlighter-rouge">UserRepository</code> y el servicio de dominio <code class="language-plaintext highlighter-rouge">UniqueUsernameGenerator</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateUserService</span> <span class="k">implements</span> <span class="nx">CreateUser</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">UserRepository</span><span class="p">,</span>
        <span class="k">private</span> <span class="nx">uniqueUsernameGenerator</span><span class="p">:</span> <span class="nx">UniqueUsernameGenerator</span><span class="p">,</span>
    <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
    
    <span class="k">async</span> <span class="nx">create</span><span class="p">(</span><span class="nx">createuser</span><span class="p">:</span> <span class="nx">CreateUserDto</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
        
        <span class="kd">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">uniqueUsernameGenerator</span><span class="p">.</span><span class="nx">generate</span><span class="p">(</span><span class="nx">createuser</span><span class="p">.</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">createuser</span><span class="p">.</span><span class="nx">lastname</span><span class="p">)</span>
        
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
            <span class="na">username</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
            <span class="na">email</span><span class="p">:</span> <span class="nx">createuser</span><span class="p">.</span><span class="nx">email</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
        
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Para completar nuestro caso de uso debemos implementar el envío del correo electrónico notificando la creación de usuario, pero en esta ocasión implementaremos un nuevo concepto de Domain Driven Design. Este caso de uso puede ser divido en 2:</p><ul><li>Crear usuario<li>Notificar usuario por correo</ul><p>En un enfoque tradicional implementaríamos un servicio y al crear el usuario invocaríamos este componente mediante la coordinación de nuestro servicio de aplicación en ciertos escenarios esto nos bastaría, pero como nuestro sistema es algo mas ligado a un proceso de negocio es mejor pensar en un enfoque más desacoplado. Para lograrlo implementaremos Eventos de Dominio.</p><h2 id="5---eventos-de-dominio"><span class="mr-2">5 - Eventos de Dominio</span><a href="#5---eventos-de-dominio" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Como su nombre lo indica estos son sucesos que han ocurrido en el dominio se describen en verbo pasado como <code class="language-plaintext highlighter-rouge">UserCreated</code>, <code class="language-plaintext highlighter-rouge">UserUpdated</code>. Esto nos permite notificar a otros componentes de nuestra aplicación los cambios que han ocurrido en el dominio de forma explícita. Los eventos de dominio nos permite declarar tanto el evento como el subscriptor o manejador del evento de esta manera podemos lograr una aplicación más desacoplada al implementar casos de usos más específicos y con responsabilidad más acotada.</p><p>Para implementar los eventos de dominio debemos crear un componente llamado <code class="language-plaintext highlighter-rouge">EventBus</code> esto es quien coordinara el envío del evento y la distribución de este a los componentes que necesitan realizar una acción determinada. Para crear este <code class="language-plaintext highlighter-rouge">EventBus</code> nos basaremos en el patrón de diseño <code class="language-plaintext highlighter-rouge">Observer</code></p><blockquote><p>El Patrón de diseño observer nos ofrece la posibilidad de definir una dependencia uno a uno entre dos o más objetos para transmitir todos los cambios de un objeto concreto de la forma más sencilla y rápida posible.</p></blockquote><p>Crearemos una clase abstracta llamada <code class="language-plaintext highlighter-rouge">EventBase</code> y el tipo <code class="language-plaintext highlighter-rouge">EventName</code>. Esta clase declara el método <code class="language-plaintext highlighter-rouge">getName()</code> que identificara el tipo de evento a su vez declaramos una segunda clase abstracta llamada DomainEvent haciendo uso de genericos para que el método <code class="language-plaintext highlighter-rouge">getData()</code> devuelva de forma tipada los datos que queremos enviar al <code class="language-plaintext highlighter-rouge">EventBus</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">type</span> <span class="nx">EventName</span> <span class="o">=</span> <span class="kr">string</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">EventBase</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">readonly</span> <span class="nx">eventId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="k">readonly</span> <span class="nx">ocurredOn</span><span class="p">:</span> <span class="nb">Date</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="kd">abstract</span> <span class="nx">getName</span><span class="p">():</span> <span class="nx">EventName</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nx">EventBase</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="nx">data</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">Id</span><span class="p">.</span><span class="kr">string</span><span class="p">(),</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">())</span>
    <span class="p">}</span>

    <span class="nx">getData</span><span class="p">():</span> <span class="nx">T</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Ya definido nuestra estructura de eventos debemos hacer cambios en nuestra clase <code class="language-plaintext highlighter-rouge">Entity</code>. En domain driven design la idea es que nuestras lógicas de negocio este lo mas cerca de las entidades de nuestro dominio es por eso que <code class="language-plaintext highlighter-rouge">User</code> almacenará los eventos relacionados a él.</p><p>Declararemos un arreglo vacío de EventBase donde iremos almacenando los eventos que pueda producir nuestra entidad <code class="language-plaintext highlighter-rouge">User</code>. Acá nuestra clase base nos ayuda a ignorar problemas de tipado cuando tengamos distintos eventos con tipo de data distintos entre sí. Definimos también los siguientes métodos:</p><ul><li><code class="language-plaintext highlighter-rouge">record():</code> registra un nuevo evento<li><code class="language-plaintext highlighter-rouge">pullevents():</code> devolverá todos los eventos y los eliminará de nuestra entidad.</ul><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">Entity</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">{</span>

    <span class="na">id</span><span class="p">:</span> <span class="nx">Id</span><span class="p">;</span>
    <span class="k">private</span> <span class="na">events</span><span class="p">:</span> <span class="nx">EventBase</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="kd">abstract</span> <span class="nx">equalsTo</span><span class="p">(</span><span class="na">entity</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>

    <span class="nx">record</span><span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">EventBase</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">pullEvents</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">domainEvents</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">return</span> <span class="nx">domainEvents</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Ahora debemos generar el evento en el método <code class="language-plaintext highlighter-rouge">create()</code> de nuestra entidad <code class="language-plaintext highlighter-rouge">User</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">User</span> <span class="kd">extends</span> <span class="nx">Entity</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="c1">// Entity props</span>

    <span class="k">static</span> <span class="nx">create</span><span class="p">(</span><span class="na">user</span><span class="p">:</span> <span class="nx">CreateNewUserDto</span><span class="p">):</span> <span class="nx">User</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="p">{</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">email</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">user</span>
        <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">Id</span><span class="p">.</span><span class="nx">generate</span><span class="p">()</span>

        <span class="kd">const</span> <span class="nx">userCreated</span> <span class="o">=</span> <span class="k">new</span> <span class="k">this</span><span class="p">.</span><span class="nx">UserBuilder</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">username</span><span class="p">(</span><span class="nx">username</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">email</span><span class="p">(</span><span class="nx">email</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">confirmed</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">build</span><span class="p">()</span>
        <span class="c1">// generate a domain event</span>
        <span class="nx">userCreated</span><span class="p">.</span><span class="nx">record</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">UserCreated</span><span class="p">(</span><span class="nx">userCreated</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="nx">userCreated</span>

    <span class="p">}</span>
    <span class="c1">// More code...</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Finalizamos los cambios sobre nuestra entidad <code class="language-plaintext highlighter-rouge">User</code> y declararemos nuestros componentes subscriptores. Creamos una interfaz base <code class="language-plaintext highlighter-rouge">EventSubscriber</code> con los siguientes métodos:</p><ul><li><code class="language-plaintext highlighter-rouge">subscribeTo():</code> Indicaremos a que evento queremos subscribirnos<li><code class="language-plaintext highlighter-rouge">onEvent():</code> Acá implementaremos la lógica que queremos realizar cuando llegue un evento de dominio.</ul><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kr">interface</span> <span class="nx">EventSubscriber</span> <span class="p">{</span>
    <span class="nx">suscribeTo</span><span class="p">():</span> <span class="nx">EventName</span><span class="p">;</span>
    <span class="nx">onEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">EventBase</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Definimos la siguiente interfaz hija de <code class="language-plaintext highlighter-rouge">EventSubscriber</code> esta interfaz sobreescribe el método <code class="language-plaintext highlighter-rouge">onEvent()</code> con el parámetro event de tipo <code class="language-plaintext highlighter-rouge">DomainEvent</code> el cual nos permite crear un <code class="language-plaintext highlighter-rouge">EventSubscriber</code> de forma tipada.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kr">interface</span> <span class="nx">DomainEventSubscriber</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="nx">EventSubscriber</span> <span class="p">{</span>
    <span class="nx">onEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Creamos la interfaz <code class="language-plaintext highlighter-rouge">DomainEventBus</code> la cual nos permite agregar subscritores, eliminar subscriptores y enviar eventos de dominio.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kr">interface</span> <span class="nx">DomainEventBus</span> <span class="p">{</span>
    <span class="nx">subscribe</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">:</span> <span class="nx">EventSubscriber</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
    <span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">:</span> <span class="nx">EventSubscriber</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
    <span class="nx">publish</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">EventBase</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>La implementación de nuestro <code class="language-plaintext highlighter-rouge">EventBus</code> será en memoria en este caso no necesitamos más. La lógica más importante se centra en método <code class="language-plaintext highlighter-rouge">publish()</code> donde cuando recibe un evento este filtrara a todos los subscriptores que coincidan con en el nombre de evento y notificara el mensaje a los subscriptores correspondientes</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">InMemoryEventBus</span> <span class="k">implements</span> <span class="nx">DomainEventBus</span> <span class="p">{</span>

    <span class="k">private</span> <span class="nx">subscribers</span><span class="p">:</span> <span class="nx">EventSubscriber</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nx">subscribe</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">:</span> <span class="nx">EventSubscriber</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">:</span> <span class="nx">EventSubscriber</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">subscriberIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">subscriber</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">subscriberIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">publish</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">EventBase</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">subscriber</span> <span class="o">=&gt;</span> <span class="nx">subscriber</span><span class="p">.</span><span class="nx">suscribeTo</span><span class="p">()</span> <span class="o">===</span> <span class="nx">event</span><span class="p">.</span><span class="nx">getName</span><span class="p">())</span>
            <span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">subscriber</span> <span class="o">=&gt;</span> <span class="nx">subscriber</span><span class="p">.</span><span class="nx">onEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Nuestro patrón observer está terminado nos resta implementar las clases concretas que tendrán la lógica de dominio.</p><p>Implementamos nuestro evento de dominio donde la data será la misma entidad User, pero puedes enviar los valores que estimes conveniente.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">UserCreated</span> <span class="kd">extends</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>

    <span class="k">static</span> <span class="nx">EVENT_NAME</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">user-ms.user-created</span><span class="dl">'</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="na">user</span><span class="p">:</span> <span class="nx">User</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">getName</span><span class="p">():</span> <span class="kr">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">UserCreated</span><span class="p">.</span><span class="nx">EVENT_NAME</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Implementamos nuestro caso de uso <code class="language-plaintext highlighter-rouge">NotifyUserCreatedByEmail</code>. La lógica no es compleja solo hace uso del puerto <code class="language-plaintext highlighter-rouge">EmailService</code>. lo último a tomar en cuenta es devolver el nombre de evento al que queremos suscribirnos en el método <code class="language-plaintext highlighter-rouge">suscribeTo()</code>.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">NotifyUserCreatedByEmail</span> <span class="k">implements</span> <span class="nx">DomainEventSubscriber</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="k">readonly</span> <span class="na">service</span><span class="p">:</span> <span class="nx">EmailService</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">async</span> <span class="nx">onEvent</span><span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">DomainEvent</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>

        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
            <span class="na">to</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
            <span class="na">message</span><span class="p">:</span> <span class="s2">`Congratulations your username is </span><span class="p">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span><span class="s2">. you must to complete the register on ....`</span><span class="p">,</span>
            <span class="na">sent</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
        <span class="p">})</span>

    <span class="p">}</span>

    <span class="nx">suscribeTo</span><span class="p">():</span> <span class="kr">string</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">UserCreated</span><span class="p">.</span><span class="nx">EVENT_NAME</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Nuestro ubscriptor debemos agregarlo al <code class="language-plaintext highlighter-rouge">EventBus</code>. Dependiendo del framework que estés usando la estrategia de creación de componentes cambiará en esta ocasión no nos enfocaremos en ese punto:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">this</span><span class="p">.</span><span class="nx">eventbus</span><span class="p">.</span><span class="nx">suscribe</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">NotifyUserCreatedByEmail</span><span class="p">(</span><span class="nx">emailService</span><span class="p">)</span>
<span class="p">)</span>
</pre></table></code></div></div><p>Ahora debemos hacer uso de nuestro <code class="language-plaintext highlighter-rouge">EventBus</code> en nuestro caso de uso <code class="language-plaintext highlighter-rouge">CreateUser</code> y hacer unos pequeños cambios:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateUserService</span> <span class="k">implements</span> <span class="nx">CreateUser</span> <span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="nx">repository</span><span class="p">:</span> <span class="nx">UserRepository</span><span class="p">,</span>
        <span class="k">private</span> <span class="nx">uniqueUsernameGenerator</span><span class="p">:</span> <span class="nx">UniqueUsernameGenerator</span><span class="p">,</span>
        <span class="k">private</span> <span class="nx">eventbus</span><span class="p">:</span> <span class="nx">DomainEventBus</span>
    <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
    
    <span class="k">async</span> <span class="nx">create</span><span class="p">(</span><span class="nx">createuser</span><span class="p">:</span> <span class="nx">CreateUserDto</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
        
        <span class="kd">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">uniqueUsernameGenerator</span><span class="p">.</span><span class="nx">generate</span><span class="p">(</span><span class="nx">createuser</span><span class="p">.</span><span class="nx">firstname</span><span class="p">,</span> <span class="nx">createuser</span><span class="p">.</span><span class="nx">lastname</span><span class="p">)</span>
        
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">User</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
            <span class="na">username</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
            <span class="na">email</span><span class="p">:</span> <span class="nx">createuser</span><span class="p">.</span><span class="nx">email</span>
        <span class="p">})</span>

        <span class="k">await</span> <span class="k">this</span><span class="p">.</span><span class="nx">repository</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
        <span class="c1">// pull events and publish</span>
        <span class="nx">user</span>
            <span class="p">.</span><span class="nx">pullEvents</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">event</span> <span class="o">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">eventbus</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span>

    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Hemos implementado nuestros casos de uso de una manera totalmente desacoplada sobre una entidad simple. Esto no termina aca, ya que tendremos escenarios donde nuestras entidades estarán compuestas por otras encontrándonos con relaciones uno a muchos, muchos a uno y muchos a muchos. Domain Driven Design nos introduce el concepto de <code class="language-plaintext highlighter-rouge">AgregateRoot</code> a esta relación de entidades</p><h2 id="6---aggregateroot-y-entidades-complejas"><span class="mr-2">6 - AggregateRoot y entidades complejas</span><a href="#6---aggregateroot-y-entidades-complejas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Un <code class="language-plaintext highlighter-rouge">Aggregate</code> no es nada más que una agrupación de entidades, value objects y propiedades a simples palabras representa un concepto de negocio que mantiene la coherencia entre sus entidades y objetos. Los agregados son un componente que orquesta todas las operaciones relacionadas con las entidades de forma transaccional para poder mantener su integridad. Para acceder a los valores de nuestro agregado debemos definir una entidad raiz por la que sería como la puerta de entrada de nuestro agregado esto se le conoce como <code class="language-plaintext highlighter-rouge">AggregateRoot</code>.</p><p>Crearemos un <code class="language-plaintext highlighter-rouge">AggregateRoot</code> esta tendrá la misma estructura que nuestra clase <code class="language-plaintext highlighter-rouge">Entity</code></p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">AggregateRoot</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">abstract</span> <span class="nx">equalsTo</span><span class="p">(</span><span class="na">e</span><span class="p">:</span> <span class="nx">T</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>En este ejemplo promoveremos nuestra entidad <code class="language-plaintext highlighter-rouge">User</code> a un agregado el cual tendrá los roles que tiene el usuario.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kr">enum</span> <span class="nx">Permission</span> <span class="p">{</span>
    <span class="nx">READ</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">READ</span><span class="dl">'</span>
    <span class="nx">EDIT</span> <span class="o">=</span><span class="dl">'</span><span class="s1">EDIT</span><span class="dl">'</span>
    <span class="nx">DELETE</span> <span class="o">=</span><span class="dl">'</span><span class="s1">DELETE</span><span class="dl">'</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">Module</span> <span class="kd">extends</span> <span class="nx">Entity</span><span class="o">&lt;</span><span class="nx">Module</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">permissions</span><span class="p">:</span> <span class="nx">Permission</span><span class="p">[];</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">Role</span> <span class="kd">extends</span> <span class="nx">Entity</span><span class="o">&lt;</span><span class="nx">Role</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">modules</span><span class="p">:</span> <span class="nx">Module</span><span class="p">[]</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">UserId</span> <span class="kd">extends</span> <span class="nx">Id</span> <span class="p">{</span>

<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">User</span> <span class="kd">extends</span> <span class="nx">AggregateRoot</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="na">userId</span><span class="p">:</span> <span class="nx">UserId</span><span class="p">;</span>
    <span class="nl">username</span><span class="p">:</span> <span class="nx">Username</span><span class="p">;</span>
    <span class="nl">email</span><span class="p">:</span> <span class="nx">Email</span><span class="p">;</span>
    <span class="nl">confirmed</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">roles</span><span class="p">:</span> <span class="nx">Role</span><span class="p">[];</span>

    <span class="k">private</span> <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">create</span><span class="p">(</span><span class="na">user</span><span class="p">:</span> <span class="nx">CreateNewUserDto</span><span class="p">):</span> <span class="nx">User</span> <span class="p">{</span>
        <span class="c1">// code here...</span>
    <span class="p">}</span>  
    <span class="c1">// more code...</span>
<span class="p">}</span>


</pre></table></code></div></div><p>Ahora el acceso de las propiedades de nuestro agregado y operaciones con los datos los realizaremos mediante nuestro agregado como podemos apreciar en este caso el agregado no hace nada diferente a lo que haríamos con una entidad. pero si la idea principal es mantener la coherencia entre sus objetos</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">User</span> <span class="kd">extends</span> <span class="nx">AggregateRoot</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="na">userId</span><span class="p">:</span> <span class="nx">UserId</span><span class="p">;</span>
    <span class="nl">username</span><span class="p">:</span> <span class="nx">Username</span><span class="p">;</span>
    <span class="nl">email</span><span class="p">:</span> <span class="nx">Email</span><span class="p">;</span>
    <span class="nl">confirmed</span><span class="p">:</span> <span class="nx">boolean</span><span class="p">;</span>
    <span class="nl">roles</span><span class="p">:</span> <span class="nx">Role</span><span class="p">[];</span>

    <span class="k">private</span> <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="nx">create</span><span class="p">(</span><span class="na">user</span><span class="p">:</span> <span class="nx">CreateNewUserDto</span><span class="p">):</span> <span class="nx">User</span> <span class="p">{</span>
        <span class="c1">// ... code here</span>
    <span class="p">}</span>

    <span class="nx">addRole</span><span class="p">(</span><span class="na">role</span><span class="p">:</span> <span class="nx">Role</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// code here</span>
    <span class="p">}</span>

    <span class="nx">removeRole</span><span class="p">(</span><span class="na">role</span><span class="p">:</span> <span class="nx">Role</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// code here</span>
    <span class="p">}</span>

    <span class="nx">getModules</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// code here</span>
    <span class="p">}</span>


<span class="p">}</span>
</pre></table></code></div></div><p>Nuestra estructura de carpetas quedaría asi</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
</pre><td class="rouge-code"><pre>├──  core
│   ├──  application
│   │   ├──  CreateUser.ts
│   │   ├──  event-subscribers
│   │   │   └──  NotifyUserCreatedByEmail.ts
│   │   └──  services
│   │       ├──  CreateUserService.ts
│   │       └──  UserCreatorService.spec.ts
│   ├──  core.module.ts
│   ├──  domain
│   │   ├──  events
│   │   │   └──  UserCreated.ts
│   │   ├──  model
│   │   │   ├──  entities
│   │   │   │   └──  User.ts
│   │   │   └──  valueobjects
│   │   │       ├──  Email.spec.ts
│   │   │       ├──  Email.ts
│   │   │       ├──  Username.spec.ts
│   │   │       └──  Username.ts
│   │   ├──  ports
│   │   │   ├──  inbound
│   │   │   │   └──  UniqueUsernameGenerator.ts
│   │   │   └──  outbound
│   │   │       └──  UserRepository.ts
│   │   └──  services
│   │       ├──  UniqueUsernameGeneratorService.ts
│   │       └──  UsernameGeneratorService.spec.ts
│   └──  shared
│       ├──  application
│       │   └──  ports
│       │       └──  outbound
│       │           └──  email-service
│       │               ├──  EmailMessage.ts
│       │               └──  EmailService.ts
│       ├──  domain
│       │   ├──  AggregateRoot.ts
│       │   ├──  DomainEvent.ts
│       │   ├──  DomainEventSubscriber.ts
│       │   ├──  Entity.ts
│       │   ├──  EventBus.ts
│       │   ├──  ValueObject.ts
│       │   └──  valueobjects
│       │       ├──  Id.spec.ts
│       │       └──  Id.ts
│       ├──  dto
│       │   ├──  CreateUserDto.ts
│       │   └──  RegisterEmailNotificationDto.ts
│       └──  error
│           └──  DomainException.ts
├──  infraestructure
│   ├──  adapters
│   │   ├──  <span class="k">in</span><span class="nt">-memory-event-bus</span>.service.ts
│   │   ├──  <span class="k">in</span><span class="nt">-memory-user</span>.repository.spec.ts
│   │   └──  <span class="k">in</span><span class="nt">-memory-user</span>.repository.ts
│   └──  infraestructure.module.ts
</pre></table></code></div></div><p>Tenemos cubierto como modelar nuestro dominio pero nuestro dominio debe estar dentro de un contexto definido para representar los caso de uso del negocio.</p><h2 id="7---indentificando-bounded-context-de-nuestra-aplicación"><span class="mr-2">7 - Indentificando Bounded Context de nuestra aplicación</span><a href="#7---indentificando-bounded-context-de-nuestra-aplicación" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Los Bounded Context nos da los límites de nuestros modelos para poder separar en los distintos dominios y contextos estableciendo las relaciones necesarias para poder resolver la problemática de nuestro negocio de una manera más modular y adecuado al contexto de lo que está solucionando. Los casos de usos que realizamos para la creación de un usuario podemos englobarlos en un Bounded Context llamado “users” nuestra aplicación después puede integrar otros Bounded Context como puede ser el caso de “user-logs” o “authorization” pero cada uno engloba su propio contexto y si necesitamos que estos Bounded Context se comuniquen podemos realizarlo mediante los eventos de dominio.</p><p>Para finalizar la estructura de directorios para representar un Bounded Context sería nada más que definir nuestros dominios en forma modular.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>├──  core
│   ├──  auth
│   │   ├──  application
│   │   ├──  domain
│   │   └──  shared
│   ├──  shared
│   │   ├──  application
│   │   └──  domain
│   ├──  user-logs
│   │   ├──  application
│   │   ├──  domain
│   │   └──  shared
│   └──  <span class="nb">users</span>
│       ├──  application
│       ├──  domain
│       └──  shared
├──  infraestructure
└──  shared
</pre></table></code></div></div><p>Finalizando los Bounded Context pueden ser una característica del software o puede representar un microservicio.</p><h2 id="finalizando-con-domain-driven-design"><span class="mr-2">Finalizando con Domain Driven Design</span><a href="#finalizando-con-domain-driven-design" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Modelamos el dominio de nuestra aplicación con Domain Driven Design espero que este post pueda servirte si quieres emplear clean architectures. Conceptualmente puede abrumarnos ciertos conceptos, pero creo que la decisión de que arquitectura emplear en una solución de software dependerá de que es lo que necesitamos resolver es muy distinto resolver un problema específico del negocio a modelar un proceso entero de negocio que sea vital para la organización. Ten esto en mente para aplicar la arquitectura correcta.</p><p>Puedes ver los demás artículos de arquitectura hexagonal acá 😉</p><ul><li><a href="/posts/implementando-hexagonal-con-nestjs-part1/">Arquitectura hexagonal Parte I </a><li><a href="/posts/implementando-hexagonal-con-nestjs-part2/">Arquitectura hexagonal Parte II </a><li><a href="/posts/implementando-hexagonal-con-nestjs-part4/">Arquitectura hexagonal Parte IV </a></ul><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/nestjs-northwind-hexagonal/tree/main/clean-architecture-examples/part-3-domain-full-design-with-ddd">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="meme-de-cortesía"><span class="mr-2">Meme de cortesía</span><a href="#meme-de-cortesía" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="https://i.ibb.co/FBFxSNy/Screen-Shot-2022-11-14-at-10-44-23.png" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/programacion/'>Programacion</a>, <a href='//categories/nestjs/'>Nestjs</a>, <a href='//categories/arquitectura-de-software/'>Arquitectura de software</a>, <a href='//categories/typescript/'>Typescript</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/typescript/" class="post-tag no-text-decoration" >typescript</a> <a href="//tags/nestjs/" class="post-tag no-text-decoration" >nestjs</a> <a href="//tags/hexagonal/" class="post-tag no-text-decoration" >hexagonal</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Arquitectura+hexagonal+Parte+III+Modelando+el+Dominio+a+Fondo+con+Domain+Driven+Design+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fimplementando-hexagonal-con-nestjs-part3%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Arquitectura+hexagonal+Parte+III+Modelando+el+Dominio+a+Fondo+con+Domain+Driven+Design+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fimplementando-hexagonal-con-nestjs-part3%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fimplementando-hexagonal-con-nestjs-part3%2F&text=Arquitectura+hexagonal+Parte+III+Modelando+el+Dominio+a+Fondo+con+Domain+Driven+Design+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fimplementando-hexagonal-con-nestjs-part3%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/implementando-hexagonal-con-nestjs-part1/"><div class="card-body"> <em class="small" data-ts="1666711920" data-df="YYYY-MM-DD" > 2022-10-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitectura hexagonal con nestjs Parte I</h3><div class="text-muted small"><p> No voy a profundizar en que es una arquitectura hexagonal, ya que tenemos un montón de recursos que te lo explican de forma detallada, pero ojo que cuando hablamos de este tipo de arquitecturas d...</p></div></div></a></div><div class="card"> <a href="/posts/implementando-hexagonal-con-nestjs-part2/"><div class="card-body"> <em class="small" data-ts="1666798320" data-df="YYYY-MM-DD" > 2022-10-26 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitectura hexagonal Parte II Conectando una clean architecture con Nestjs</h3><div class="text-muted small"><p> La segunda parte de esta serie de arquitectura hexagonal o (clean architecture) profundizaremos como configurar la interacción de un framework con el core de nuestra arquitectura, Nestjs nos ofre...</p></div></div></a></div><div class="card"> <a href="/posts/nestjs-tips-la-versatilidad-de-configuration-module/"><div class="card-body"> <em class="small" data-ts="1666971120" data-df="YYYY-MM-DD" > 2022-10-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Nestjs tips La versatilidad de ConfigMdule</h3><div class="text-muted small"><p> El manejo de credenciales y configuraciones en nuestras aplicaciones es generalmente algo indispensable para los distintos escenarios de desarrollo y despliegue. Algo tedioso a veces, pero nuestr...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/nestjs-tips-la-versatilidad-de-configuration-module/" class="btn btn-outline-primary" prompt="Anterior"><p>Nestjs tips La versatilidad de ConfigMdule</p></a> <a href="//posts/implementando-hexagonal-con-nestjs-part4/" class="btn btn-outline-primary" prompt="Nuevo"><p>Arquitectura hexagonal Parte IV Patrones de arquitectura sobre la capa Application</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
