<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Sagas I - Transacciones Distribuidas Con Patrones Saga" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/sagas-i-transacciones-distribuidas-con-patrones-saga/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/sagas-i-transacciones-distribuidas-con-patrones-saga/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-03-11T02:00:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Sagas I - Transacciones Distribuidas Con Patrones Saga" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2024-03-11T02:00:00-03:00","datePublished":"2024-03-11T02:00:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"Sagas I - Transacciones Distribuidas Con Patrones Saga","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/sagas-i-transacciones-distribuidas-con-patrones-saga/"},"url":"https://nullpointer-excelsior.github.io/posts/sagas-i-transacciones-distribuidas-con-patrones-saga/"}</script><title>Sagas I - Transacciones Distribuidas Con Patrones Saga | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Sagas I - Transacciones Distribuidas Con Patrones Saga</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Sagas I - Transacciones Distribuidas Con Patrones Saga</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1710133200" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2024-03-11 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1987 palabras"> <em>11 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/intros/intro5.webp" alt="intro" data-proofer-ignore></p><h2 id="transacciones-centralizadas-vs-distribuidas"><span class="mr-2">Transacciones centralizadas vs distribuidas</span><a href="#transacciones-centralizadas-vs-distribuidas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Las aplicaciones monolíticas tienen la ventaja de poder crear procesos transaccionales de forma sencilla. Las transacciones nos ayudan a mantener la consistencia de los datos en operaciones de escritura.</p><p>Ya que podemos iniciar un conjunto de operaciones y, si son exitosas, persistir los cambios. Si algún error ocurre, realizaremos un rollback, el cual volverá a dejar en un estado consistente la base de datos antes de haber intentado una operación de escritura.</p><p>Si bien las bases de datos relacionales nos permiten esto de forma sencilla, en las arquitecturas de microservicio los procesos transaccionales son complejos, ya que no existe manera de centralizar las operaciones de escritura.</p><p>Para lograr transacciones en microservicios o sistemas distribuidos, podemos aprender de los patrones SAGA. Estos nos ayudarán a lidiar con sistemas distribuidos complejos donde involucran transacciones.</p><h2 id="qué-son-las-sagas"><span class="mr-2">Qué son las SAGAS</span><a href="#qué-son-las-sagas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>El patrón SAGA (también conocido como patrón de transacción SAGA) es un patrón de diseño utilizado en arquitecturas de microservicios para manejar transacciones distribuidas. Su objetivo es mantener la consistencia de los datos en sistemas distribuidos donde múltiples servicios están involucrados en una transacción.</p><p>En lugar de utilizar una transacción monolítica que involucre a todos los servicios y que pueda causar bloqueos y cuellos de botella, el patrón SAGA divide la transacción en pasos más pequeños o secuencias de acciones. Cada paso se ejecuta como una transacción independiente en el contexto de un servicio específico. Estos pasos se organizan en una secuencia lógica y se ejecutan de manera secuencial o en paralelo.</p><p>El patrón SAGA utiliza dos estrategias principales para mantener la consistencia:</p><ul><li><p><strong>SAGA Orquestada:</strong> Un componente central (orquestador) coordina y dirige la ejecución de los pasos de la transacción. Este orquestador envía comandos a los servicios involucrados para realizar las operaciones necesarias. Si un paso falla, el orquestador puede desencadenar acciones de compensación para revertir los cambios realizados en pasos anteriores.</p><li><p><strong>SAGA Coreografía:</strong> En este enfoque, no hay un orquestador central. En cambio, cada servicio conoce las acciones que debe realizar y cómo responder ante eventos. Cada servicio inicia sus propias transacciones y envía eventos para desencadenar las acciones en otros servicios. Este enfoque puede ser más complejo de diseñar y mantener, pero puede ser más escalable y distribuido.</p></ul><h2 id="diseñando-una-saga"><span class="mr-2">Diseñando una Saga</span><a href="#diseñando-una-saga" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Orquestado o coreográfico, independientemente de cuál sea, debemos definir lo siguiente:</p><ul><li>Transacciones o pasos<li>Operaciones del servicio que realiza la transacción<li>Comunicación entre servicios</ul><p>Cuando creamos un proceso basado en sagas, definiremos los pasos. Estos serán las invocaciones a las operaciones de las aplicaciones involucradas.</p><h3 id="proceso-de-compra-basado-en-sagas"><span class="mr-2">Proceso de compra basado en sagas</span><a href="#proceso-de-compra-basado-en-sagas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Diseñaremos un proceso de compra para un usuario basado en la adquisición de mercadería de las bandas de nuestro clon de Spotify. Entonces, estos son los pasos:</p><ul><li><strong>create-order:</strong> encargado de crear una nueva orden en el sistema.<li><strong>create-payment:</strong> encargado de procesar un nuevo pago en el sistema.<li><strong>update-stock:</strong> encargado de actualizar el inventario de productos en el sistema.<li><strong>create-delivery:</strong> encargado de crear una nueva entrega en el sistema.<li><strong>notify-purchase:</strong> notificación al usuario de su compra</ul><p>Cada paso definido se refiere a una operación en un microservicio. Cada operación puede ser síncrona o asíncrona, pero normalmente en una saga coreográfica debería ser asíncrona utilizando alguna estrategia de mensajería distribuida como RabbitMQ o Kafka.</p><h3 id="operaciones-de-las-sagas"><span class="mr-2">Operaciones de las sagas</span><a href="#operaciones-de-las-sagas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Cada paso de nuestra saga debe definir los siguientes componentes:</p><ul><li><strong>Transacción:</strong> la operación que realiza el microservicio. Esta debe devolver una respuesta exitosa o un error.<li><strong>Compensación:</strong> es la operación que actuará como un rollback, debe dejar el estado de los datos en la condición previa a la transacción realizada.<li><strong>Respuesta ok de transacción:</strong> indica que la transacción fue realizada exitosamente.<li><strong>Error en transacción:</strong> indica que la transacción falló, se deberá ver qué operaciones de compensación deben realizarse en este punto.</ul><p>Definiendo este contrato podremos coordinar nuestro proceso de manera uniforme a través de los servicios involucrados. Debemos tener en cuenta que las operaciones de inicio y término pueden diferir en la implementación de estos contratos, pero todos los procesos fuera de las operaciones de inicio y término deben cumplir este contrato.</p><p>Para implementar de forma sencilla esto podemos hacer uso de un enum de typescript.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/sagas/CreateNotificationSaga.ts</span>
<span class="k">export</span> <span class="kr">enum</span> <span class="nx">CreateNotificationSaga</span> <span class="p">{</span>
    <span class="nx">TRANSACTION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">send-notification-transaction</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">COMPENSATION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">notification-compensation</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">OK</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">notification-sent-ok</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">ERROR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">notification-error</span><span class="dl">'</span>
<span class="p">}</span>
<span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/sagas/CreateOrderSaga.ts</span>
<span class="k">export</span> <span class="kr">enum</span> <span class="nx">CreateOrderSaga</span> <span class="p">{</span>
    <span class="nx">TRANSACTION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">create-order-transaction</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">COMPENSATION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">create-order-compensation</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">OK</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">create-order-ok</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">ERROR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">create-order-error</span><span class="dl">'</span>
<span class="p">}</span>
<span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/sagas/CreatePaymentSaga.ts</span>
<span class="k">export</span> <span class="kr">enum</span> <span class="nx">CreatePaymentSaga</span> <span class="p">{</span>
    <span class="nx">TRANSACTION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">create-payment-transaction</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">COMPENSATION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">create-payment-compensation</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">OK</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">create-payment-ok</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">ERROR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">payment-error</span><span class="dl">'</span>
<span class="p">}</span>
<span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/sagas/DeliverySaga.ts</span>
<span class="k">export</span> <span class="kr">enum</span> <span class="nx">DeliverySaga</span> <span class="p">{</span>
    <span class="nx">TRANSACTION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">delivery-transaction</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">COMPENSATION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">delivery-compensation</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">OK</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">delivery-ok</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">ERROR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">delivery-error</span><span class="dl">'</span>
<span class="p">}</span>
<span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/sagas/UpdateStockSaga.ts</span>
<span class="k">export</span> <span class="kr">enum</span> <span class="nx">UpdateStockSaga</span> <span class="p">{</span>
    <span class="nx">TRANSACTION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">update-stock-transaction</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">COMPENSATION</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">update-stock-compensation</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">OK</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">update-stock-ok</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">ERROR</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">update-stock-error</span><span class="dl">'</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Donde cada valor corresponderá a un endpoint o el nombre de una cola o patrón de mensajería. De esta manera centralizamos nuestras constantes y nos ahorraremos problemas de typo. Al diseñar sistemas complejos, debemos considerar las buenas prácticas desde el comienzo para evitar errores triviales.</p><h3 id="comunicación-entre-servicios"><span class="mr-2">Comunicación entre servicios</span><a href="#comunicación-entre-servicios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Debemos definir cómo comunicar los servicios. Dependiendo del enfoque, podremos hacer uso de comunicación síncrona (modelo request-response) o comunicación asíncrona (por eventos).</p><p>En una comunicación por coreografía, la mejor opción es elegir la comunicación por mensajes o eventos. Mientras tanto, en la comunicación por orquestación, podemos hacer uso tanto de comunicación síncrona como asíncrona, es decir, podremos comunicarnos con los microservicios mediante una API REST para una manera síncrona, y por medio de una cola de mensajes para comunicación asíncrona.</p><h3 id="diseñando-la-comunicación-basada-en-eventos"><span class="mr-2">Diseñando la comunicación basada en eventos</span><a href="#diseñando-la-comunicación-basada-en-eventos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Cada paso ya ha definido sus operaciones, es hora de diseñar la comunicación. Cada paso puede comunicarse con otros mediante mensajes, eventos o request-response. En esta saga de ejemplo diseñaremos una comunicación basada en eventos y nos ayudaremos de la siguiente clase abstracta que será la base.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">// libs/distributed-transactions/src/sagas/saga.event.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">IsDate</span><span class="p">,</span> <span class="nx">IsNotEmpty</span><span class="p">,</span> <span class="nx">IsString</span><span class="p">,</span> <span class="nx">IsUUID</span><span class="p">,</span> <span class="nx">ValidateNested</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">class-validator</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">Props</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">transactionId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">pattern</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="nl">payload</span><span class="p">:</span> <span class="nx">T</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">SagaEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="p">@</span><span class="nd">IsUUID</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="na">transactionId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsDate</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="na">timestamp</span><span class="p">:</span> <span class="nb">Date</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">T</span><span class="p">;</span>

    <span class="p">@</span><span class="nd">IsString</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="k">public</span> <span class="k">readonly</span> <span class="na">pattern</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">({</span> <span class="nx">transactionId</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">payload</span> <span class="p">}:</span> <span class="nx">Props</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">transactionId</span> <span class="o">=</span> <span class="nx">transactionId</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">payload</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Esta clase será la base para nuestros eventos donde destacamos las siguientes propiedades:</p><ul><li><p><strong>transactionID:</strong> Esta propiedad es la que relacionará todos los eventos a un proceso de compra iniciado por algún usuario. Es importante esta identificación, ya que los servicios involucrados en el 100% del diseño de estos contemplan la creación de ids internos para sus entidades. Entonces, basados en esta situación, cada operación debe estar asociada a un <code class="language-plaintext highlighter-rouge">transactionId</code> y debemos asociar todas las respuestas y peticiones a este identificador.</p><li><p><strong>pattern:</strong> Esta propiedad indicará la operación asociada. En una arquitectura basada en eventos, este representa la cola de mensajes donde enviar el evento.</p><li><strong>Payload:</strong> Nos indica el contenido de los mensajes, es la info que el servicio necesita para realizar su operación.<li><strong>timestamp:</strong> Nos indicará la creación del evento.</ul><p>Ya con nuestra evento base explicado, definimos los eventos de las operaciones:</p><p>Ejemplo de create-order-saga:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre><td class="rouge-code"><pre><span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/events/create-order-transaction.event.ts</span>
<span class="kd">type</span> <span class="nx">Payload</span> <span class="o">=</span> <span class="nx">Omit</span><span class="o">&lt;</span><span class="nx">Order</span><span class="p">,</span> <span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateOrderTransactionEvent</span> <span class="kd">extends</span> <span class="nx">SagaEvent</span><span class="o">&lt;</span><span class="nx">Payload</span><span class="o">&gt;</span><span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="na">props</span><span class="p">:</span> <span class="nx">EventProps</span><span class="o">&lt;</span><span class="nx">Payload</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">({</span>
            <span class="p">...</span><span class="nx">props</span><span class="p">,</span>
            <span class="na">pattern</span><span class="p">:</span> <span class="nx">CreateOrderSaga</span><span class="p">.</span><span class="nx">TRANSACTION</span>
        <span class="p">})</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/events/create-order-compensation.event.ts</span>
<span class="kd">class</span> <span class="nx">Payload</span> <span class="p">{</span>
    
    <span class="p">@</span><span class="nd">IsUUID</span><span class="p">()</span>
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="nx">orderId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateOrderCompensationEvent</span> <span class="kd">extends</span> <span class="nx">SagaEvent</span><span class="o">&lt;</span><span class="nx">Payload</span><span class="o">&gt;</span><span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="na">props</span><span class="p">:</span> <span class="p">{</span> <span class="na">transactionId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="na">payload</span><span class="p">:</span> <span class="nx">Payload</span> <span class="p">})</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">({</span>
            <span class="p">...</span><span class="nx">props</span><span class="p">,</span>
            <span class="na">pattern</span><span class="p">:</span> <span class="nx">CreateOrderSaga</span><span class="p">.</span><span class="nx">COMPENSATION</span><span class="p">,</span>
        <span class="p">})</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/events/create-order-ok.event.ts</span>
<span class="kd">class</span> <span class="nx">Payload</span> <span class="p">{</span>
    
    <span class="p">@</span><span class="nd">ValidateNested</span><span class="p">()</span>
    <span class="nx">order</span><span class="p">:</span> <span class="nx">Order</span><span class="p">;</span>
    
<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateOrderOkEvent</span> <span class="kd">extends</span> <span class="nx">SagaEvent</span><span class="o">&lt;</span><span class="nx">Payload</span><span class="o">&gt;</span><span class="p">{</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="na">props</span><span class="p">:</span> <span class="nx">EventProps</span><span class="o">&lt;</span><span class="nx">Payload</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">({</span>
            <span class="p">...</span><span class="nx">props</span><span class="p">,</span>
            <span class="na">pattern</span><span class="p">:</span> <span class="nx">CreateOrderSaga</span><span class="p">.</span><span class="nx">OK</span>
        <span class="p">})</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="c1">// libs/distributed-transactions/src/user-purchases/orchestation-saga/events/create-order-error.event.ts</span>
<span class="kd">class</span> <span class="nx">Payload</span> <span class="p">{</span>
    
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="nx">error</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
    
    <span class="p">@</span><span class="nd">IsNotEmpty</span><span class="p">()</span>
    <span class="nx">reason</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateOrderErrorEvent</span> <span class="kd">extends</span> <span class="nx">SagaEvent</span><span class="o">&lt;</span><span class="nx">Payload</span><span class="o">&gt;</span><span class="p">{</span>
    
        <span class="kd">constructor</span><span class="p">(</span><span class="na">props</span><span class="p">:</span> <span class="nx">EventProps</span><span class="o">&lt;</span><span class="nx">Payload</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">({</span>
                <span class="p">...</span><span class="nx">props</span><span class="p">,</span>
                <span class="na">pattern</span><span class="p">:</span> <span class="nx">CreateOrderSaga</span><span class="p">.</span><span class="nx">ERROR</span>
            <span class="p">})</span>
        <span class="p">}</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Los demás eventos seguirán el mismo patrón. Dependiendo de la operación, variará el payload del evento.</p><h3 id="envío-de-eventos-entre-microservicios"><span class="mr-2">Envío de Eventos entre microservicios</span><a href="#envío-de-eventos-entre-microservicios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>NestJS nos permite utilizar una variedad de proveedores de microservicios, dependiendo del caso. Así que creamos un servicio llamado <code class="language-plaintext highlighter-rouge">SagaExecutorService</code>, el cual despachará los eventos.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">// libs/distributed-transactions/src/sagas/services/saga-executor.service.ts</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SagaExecutorService</span> <span class="p">{</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nx">SagaExecutorService</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>

    <span class="kd">constructor</span><span class="p">(@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">USER_PURCHASES_CLIENT</span><span class="p">)</span> <span class="k">private</span> <span class="nx">client</span><span class="p">:</span> <span class="nx">ClientProxy</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="nx">execute</span><span class="o">&lt;</span><span class="nx">T</span> <span class="o">=</span> <span class="kr">any</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">SagaEvent</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">`Sending Event(pattern=</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">pattern</span><span class="p">}</span><span class="s2">, transaction=</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">transactionId</span><span class="p">}</span><span class="s2">)`</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Y podemos hacer uso de este de la siguiente manera:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// sending events</span>
<span class="k">this</span><span class="p">.</span><span class="nx">sagaExecutor</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="k">new</span> <span class="nx">DeliveryTransactionEvent</span><span class="p">({</span>
    <span class="na">transactionId</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">transactionId</span><span class="p">,</span>
    <span class="na">payload</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">order</span><span class="p">:</span> <span class="nx">purchase</span><span class="p">.</span><span class="nx">order</span>
    <span class="p">}</span>
<span class="p">}))</span>
</pre></table></code></div></div><p>Independientemente de la estrategia coreográfica u orquestación, cada microservicio involucrado debe cumplir el siguiente contrato:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// libs/distributed-transactions/src/sagas/ports/saga.controller.port.ts</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">RedisContext</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@nestjs/microservices</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nx">SagaControllerPort</span><span class="o">&lt;</span><span class="nx">T</span><span class="p">,</span> <span class="nx">C</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">abstract</span> <span class="nx">onTransaction</span><span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">T</span><span class="p">,</span> <span class="na">context</span><span class="p">:</span> <span class="nx">RedisContext</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
    <span class="kd">abstract</span> <span class="nx">onCompensation</span><span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">C</span><span class="p">,</span> <span class="na">context</span><span class="p">:</span> <span class="nx">RedisContext</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Donde nuestro microservicio deberá definir la operación de transacción y la operación de compensación, donde el servicio creará el rollback del proceso.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">// apps/merch-products-ms/src/delivery/infrastructure/sagas/create-delivery-saga.controller.ts</span>
<span class="p">@</span><span class="nd">Controller</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">CreateDeliverySagaController</span> <span class="kd">extends</span> <span class="nx">SagaControllerPort</span><span class="o">&lt;</span><span class="nx">DeliveryTransactionEvent</span><span class="p">,</span> <span class="nx">DeliveryCompensationEvent</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nx">CreateDeliverySagaController</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="na">deliveryService</span><span class="p">:</span> <span class="nx">DeliveryService</span><span class="p">,</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="na">sagas</span><span class="p">:</span> <span class="nx">SagaExecutorService</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="p">@</span><span class="nd">EventPattern</span><span class="p">(</span><span class="nx">DeliverySaga</span><span class="p">.</span><span class="nx">TRANSACTION</span><span class="p">)</span>
    <span class="k">async</span> <span class="nx">onTransaction</span><span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">DeliveryTransactionEvent</span><span class="p">,</span> <span class="na">context</span><span class="p">:</span> <span class="nx">RedisContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">`Received Event(pattern=</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">pattern</span><span class="p">}</span><span class="s2">, transactionId=</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">transactionId</span><span class="p">}</span><span class="s2">)`</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Event-payload</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">payload</span><span class="p">)</span>
        <span class="c1">// trasaction operation</span>
    <span class="p">}</span>

    <span class="p">@</span><span class="nd">EventPattern</span><span class="p">(</span><span class="nx">DeliverySaga</span><span class="p">.</span><span class="nx">COMPENSATION</span><span class="p">)</span>
    <span class="nx">onCompensation</span><span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">DeliveryCompensationEvent</span><span class="p">,</span> <span class="na">context</span><span class="p">:</span> <span class="nx">RedisContext</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">`Received Event(pattern=</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">pattern</span><span class="p">}</span><span class="s2">, transactionId=</span><span class="p">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">transactionId</span><span class="p">}</span><span class="s2">)`</span><span class="p">)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">logger</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="dl">'</span><span class="s1">Event-payload</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">payload</span><span class="p">)</span>
        <span class="c1">// compensation operation</span>
    <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Nuestro controlador automáticamente será asociado a nuestro servicio de mensajería definido en <code class="language-plaintext highlighter-rouge">main.ts</code> del microservicio.</p><blockquote><p>Si quieres aprender más sobre microservicios en NestJs <a href="https://nullpointer-excelsior.github.io/posts/arquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion/">acá</a></p></blockquote><p>Dependiendo de la estrategia escogida, orquestación o coreografía, la lógica del flujo será delegada a un componente central o a los servicios involucrados. En la siguiente imagen vemos la diferencia entre coreografía y orquestación.</p><p><img data-src="/assets/img/examples/sagas-architecture.webp" alt="saga" data-proofer-ignore></p><ul><li><p><strong>Coreografía:</strong> Cada servicio sabe cuál es su tarea y a qué parte del flujo pertenece. Realiza las transacciones y, en caso de error, invoca las compensaciones en los servicios correspondientes, es decir, en aquellos que ya hayan tenido las operaciones correctas.</p><li><p><strong>Orquestación:</strong> Tendremos un componente central encargado de realizar las operaciones y coordinar las compensaciones dependiendo del paso que haya fallado.</p></ul><p>En el caso de la Coreografía, la mejor forma de comunicación será mediante eventos para poder crear un sistema distribuido escalable y desacoplado. Mientras tanto, en una Saga orquestada, podemos usar tanto la comunicación por eventos como de forma síncrona. Dependerá de la operación y su coste. Debemos considerar que este componente central deberá estar al tanto de la coherencia de las operaciones. Este enfoque tendrá la ventaja de ser más mantenible que una saga coreográfica.</p><h2 id="conclusión"><span class="mr-2">Conclusión</span><a href="#conclusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>El patrón SAGA es esencial para preservar la atomicidad de las transacciones en el entorno distribuido de los microservicios. No obstante, su implementación requiere una gestión meticulosa de fallos, durabilidad de mensajes y consistencia eventual para asegurar la integridad de los datos. Dependiendo de si utilizamos una estrategia basada en coreografía u orquestación, estas dependerán del caso. Si bien hay situaciones que no contemplamos en este artículo, las bases están declaradas y te ayudarán a entender los desafíos de los sistemas distribuidos.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/microservices-architecture-nestjs/">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="meme-de-despedida"><span class="mr-2">Meme de despedida</span><a href="#meme-de-despedida" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="/assets/img/memes/meme3.webp" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/arquitectura/'>Arquitectura</a>, <a href='//categories/software/'>Software,</a>, <a href='//categories/microservicios/'>Microservicios,</a>, <a href='//categories/eventos/'>Eventos</a>, <a href='//categories/architecture/'>Architecture,</a>, <a href='//categories/patrones/'>Patrones</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/arquitectura/" class="post-tag no-text-decoration" >arquitectura</a> <a href="//tags/software/" class="post-tag no-text-decoration" >software,</a> <a href="//tags/microservicios/" class="post-tag no-text-decoration" >microservicios,</a> <a href="//tags/eventos/" class="post-tag no-text-decoration" >eventos</a> <a href="//tags/architecture/" class="post-tag no-text-decoration" >architecture,</a> <a href="//tags/patrones/" class="post-tag no-text-decoration" >patrones</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Sagas+I+-+Transacciones+Distribuidas+Con+Patrones+Saga+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fsagas-i-transacciones-distribuidas-con-patrones-saga%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Sagas+I+-+Transacciones+Distribuidas+Con+Patrones+Saga+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fsagas-i-transacciones-distribuidas-con-patrones-saga%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fsagas-i-transacciones-distribuidas-con-patrones-saga%2F&text=Sagas+I+-+Transacciones+Distribuidas+Con+Patrones+Saga+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fsagas-i-transacciones-distribuidas-con-patrones-saga%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/patrones-de-resiliencia/"><div class="card-body"> <em class="small" data-ts="1715230800" data-df="YYYY-MM-DD" > 2024-05-09 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Patrones de resiliencia</h3><div class="text-muted small"><p> ¿Qué es la resiliencia? La resiliencia es la capacidad de un sistema de poder recuperarse de un escenario adverso. En el desarrollo de software, podemos aplicar este concepto para crear aplicaci...</p></div></div></a></div><div class="card"> <a href="/posts/microservicios-1-construyendo-aplicaciones-escalables-y-mantenibles/"><div class="card-body"> <em class="small" data-ts="1698382800" data-df="YYYY-MM-DD" > 2023-10-27 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MicroServicios 1 Construyendo aplicaciones escalables y mantenibles</h3><div class="text-muted small"><p> En este capítulo tomaremos nota de pequeños tips para generar aplicaciones escalables y mantenibles, las cuales podrán ayudarte de manera más sencilla en una posible transición de monolito a micr...</p></div></div></a></div><div class="card"> <a href="/posts/5-Arquitecturas-de-software-para-tigres-del-codigo/"><div class="card-body"> <em class="small" data-ts="1662977400" data-df="YYYY-MM-DD" > 2022-09-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>5 Arquitecturas de software para tigres del código</h3><div class="text-muted small"><p> 5 arquitecturas de software para proyectos serios Cuando iniciamos a crear nuestros proyectos lo primero que nos enseñaron fue el patrón MVC o la arquitectura por capas con el tiempo Todos los pro...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/arquitecturas-eda-eventos-de-dominio-vs-eventos-de-integracion/" class="btn btn-outline-primary" prompt="Anterior"><p>Arquitecturas EDA Eventos de dominio vs eventos de integración</p></a> <a href="//posts/patrones-de-resiliencia/" class="btn btn-outline-primary" prompt="Nuevo"><p>Patrones de resiliencia</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
