<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="¿Qué es y cómo funciona el Event Sourcing con un ejemplo práctico?" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><meta property="og:description" content="Ingeniería de software aplicada, tips, buenas práctias y códigos" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/que-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/que-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-01-28T02:00:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="¿Qué es y cómo funciona el Event Sourcing con un ejemplo práctico?" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2025-01-28T02:00:00-03:00","datePublished":"2025-01-28T02:00:00-03:00","description":"Ingeniería de software aplicada, tips, buenas práctias y códigos","headline":"¿Qué es y cómo funciona el Event Sourcing con un ejemplo práctico?","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/que-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico/"},"url":"https://nullpointer-excelsior.github.io/posts/que-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico/"}</script><title>¿Qué es y cómo funciona el Event Sourcing con un ejemplo práctico? | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>¿Qué es y cómo funciona el Event Sourcing con un ejemplo práctico?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>¿Qué es y cómo funciona el Event Sourcing con un ejemplo práctico?</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1738040400" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2025-01-28 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1135 palabras"> <em>6 min</em> de lectura</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/intros/intro10.webp" alt="intro" data-proofer-ignore></p><h2 id="qué-es-event-sourcing"><span class="mr-2">¿Qué es Event Sourcing?</span><a href="#qué-es-event-sourcing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Event Sourcing es un patrón de arquitectura de software que trata cada cambio en el estado de una aplicación como un evento. En lugar de almacenar el estado actual de un objeto, se almacenan los eventos que han ocurrido, los cuales se pueden reproducir para recrear el estado del objeto en cualquier momento. Esto permite tener un historial completo de las transacciones, facilitando la auditoría y la recuperación ante desastres.</p><h2 id="crud-vs-event-sourcing"><span class="mr-2">CRUD vs Event Sourcing</span><a href="#crud-vs-event-sourcing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>El enfoque tradicional de CRUD (Crear, Leer, Actualizar, Eliminar) se centra en interactuar con el estado actual de una entidad. En contraste, Event Sourcing se enfoca en la secuencia de eventos que han llevado a ese estado.</p><h3 id="ventajas-y-desventajas"><span class="mr-2">Ventajas y desventajas</span><a href="#ventajas-y-desventajas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>Ventajas:</strong></p><ul><li><strong>Auditoría completa:</strong> Permite un seguimiento detallado de todas las acciones.<li><strong>Reproducción del estado:</strong> El estado de una entidad puede ser reconstruido en cualquier momento.<li><strong>Facibilidad en el manejo de cambios:</strong> Cambios en los requisitos son más fáciles de implementar, ya que solo se necesita añadir nuevos eventos.</ul><p><strong>Desventajas:</strong></p><ul><li><strong>Complejidad:</strong> Puede introducir mayor complejidad en la gestión de estados.<li><strong>Carga de almacenamiento:</strong> Almacenar todos los eventos puede requerir mucho espacio.<li><strong>Performance:</strong> La recuperación del estado puede ser más lenta que un enfoque de estado actual.<li><strong>Consistencia eventual:</strong> Las arquitecturas basadas en eventos deben lidiar con la consistencia eventual, donde los datos pueden no estar inmediatamente sincronizados, pero eventualmente se reflejan en todos los componentes del sistema.</ul><h2 id="conceptos-principales-de-event-sourcing"><span class="mr-2">Conceptos principales de Event Sourcing</span><a href="#conceptos-principales-de-event-sourcing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><strong>Events:</strong> Son representaciones de un cambio de estado en el sistema. Cada evento indica una acción que ha tenido lugar, como “Orden Creada” o “Orden Completada”.<li><strong>Event Stream:</strong> Es la secuencia de eventos que se han producido para una entidad específica a lo largo del tiempo.<li><strong>Event Store:</strong> Un almacenamiento especializado para guardar eventos, permitiendo su recuperación y consulta.<li><strong>Entities and Aggregates:</strong> Las entidades son objetos en el dominio que contienen datos y lógica de negocio. Los agregados son conjuntos de entidades que se tratan como una unidad para asegurar la coherencia de los cambios.<li><strong>Projections:</strong> Representaciones de datos derivadas de eventos, que permiten consultas eficientes sin necesidad de reconstruir el estado desde cero.<li><strong>Snapshots:</strong> Instantáneas del estado actual de un agregada, que ayudan a optimizar el rendimiento al evitar la necesidad de reproducir cada evento para reconstruir el estado.</ul><p>Dejemos de lado la teoría y vamos con un ejemplo práctico.</p><h2 id="ejemplo-práctico-manejo-de-órdenes-de-compra-con-java"><span class="mr-2">Ejemplo práctico: Manejo de órdenes de compra con Java</span><a href="#ejemplo-práctico-manejo-de-órdenes-de-compra-con-java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>En este ejemplo, vamos a ver cómo implementar event sourcing para manejar el ciclo de vida de órdenes de compra. El código proporcionado abarca la creación, entrega y finalización de órdenes.</p><h3 id="definición-y-aplicación-de-eventos-sobre-order"><span class="mr-2">Definición y aplicación de eventos sobre Order</span><a href="#definición-y-aplicación-de-eventos-sobre-order" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>En la clase <code class="language-plaintext highlighter-rouge">Order</code>, se instancian eventos como <code class="language-plaintext highlighter-rouge">OrderCreatedEvent</code>, <code class="language-plaintext highlighter-rouge">OrderDeliveredEvent</code> y <code class="language-plaintext highlighter-rouge">OrderCompletedEvent</code>, cada uno de ellos describe un cambio en el estado de la orden:</p><p>Estructura de eventos:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Event</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">LocalDateTime</span> <span class="n">createdAt</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Event</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderCreatedEvent</span> <span class="kd">extends</span> <span class="nc">Event</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">total</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">OrderStatus</span> <span class="n">status</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Getter</span><span class="o">()</span>
<span class="nd">@ToString</span>
<span class="nd">@AllArgsConstructor</span><span class="o">()</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderDeliveredEvent</span> <span class="kd">extends</span> <span class="nc">Event</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Shipping</span> <span class="n">shipping</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">OrderStatus</span> <span class="n">status</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderCompletedEvent</span> <span class="kd">extends</span> <span class="nc">Event</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">orderId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">OrderStatus</span> <span class="n">status</span><span class="o">;</span>
<span class="o">}</span>

</pre></table></code></div></div><p>Estructura y creación de Order:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="nc">Order</span> <span class="nf">create</span><span class="o">(</span><span class="nc">String</span> <span class="n">orderId</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Product</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">order</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Order</span><span class="o">();</span>
    <span class="kt">var</span> <span class="n">total</span> <span class="o">=</span> <span class="n">products</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
            <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Product:</span><span class="o">:</span><span class="n">getQuantity</span><span class="o">)</span>
            <span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="nl">Integer:</span><span class="o">:</span><span class="n">sum</span><span class="o">);</span>
    <span class="kt">var</span> <span class="n">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OrderCreatedEvent</span><span class="o">(</span><span class="n">orderId</span><span class="o">,</span> <span class="n">products</span><span class="o">,</span> <span class="n">total</span><span class="o">,</span> <span class="nc">OrderStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">events</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>En este código aplicamos la creación de una orden, realizamos todos los cálculos o validaciones que necesitamos, creamos un evento y lo aplicamos, es decir, actualizamos el estado de la entidad.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="nc">OrderCreatedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">products</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getProducts</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">total</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>De esta forma, nuestra entidad Order tendrá un estado consistente dependiendo de los eventos que se apliquen.</p><h3 id="casos-de-uso-y-lógica-de-dominio-de-order"><span class="mr-2">Casos de uso y lógica de dominio de Order</span><a href="#casos-de-uso-y-lógica-de-dominio-de-order" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>La lógica de negocio se centraliza en la clase <code class="language-plaintext highlighter-rouge">OrderUseCases</code>, donde se manejan comandos como crear y completar órdenes:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">createOrder</span><span class="o">(</span><span class="nc">CreateOrderCommand</span> <span class="n">command</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">order</span> <span class="o">=</span> <span class="nc">Order</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">command</span><span class="o">.</span><span class="na">orderId</span><span class="o">(),</span> <span class="n">command</span><span class="o">.</span><span class="na">products</span><span class="o">());</span>
    <span class="n">order</span><span class="o">.</span><span class="na">getEvents</span><span class="o">()</span>
            <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">orderEventStore</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">event</span><span class="o">));</span>
    <span class="n">order</span><span class="o">.</span><span class="na">cleanEvents</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Al invocar <code class="language-plaintext highlighter-rouge">Order.create()</code> realizamos las operaciones necesarias para crear la orden. Después obtendremos los eventos que se han generado internamente en la entidad Order y los guardamos en el <code class="language-plaintext highlighter-rouge">EventStore</code>.</p><h4 id="almacenamientos-de-eventos"><span class="mr-2">Almacenamientos de eventos</span><a href="#almacenamientos-de-eventos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Definimos la interfaz <code class="language-plaintext highlighter-rouge">OrderEventStore</code>, que se utiliza para almacenar y recuperar eventos:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderEventStore</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Event</span> <span class="n">event</span><span class="o">);</span>
    <span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Event</span><span class="o">&gt;</span> <span class="nf">findByOrderId</span><span class="o">(</span><span class="nc">String</span> <span class="n">orderId</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>No nos preocuparemos de la implementación del event store, ya que va más allá del alcance de este artículo.</p><h3 id="consulta-de-un-stream-de-eventos"><span class="mr-2">Consulta de un stream de eventos</span><a href="#consulta-de-un-stream-de-eventos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Cuando se necesita recrear el estado de una orden a partir de sus eventos, se utiliza el método <code class="language-plaintext highlighter-rouge">fromEventStream</code>:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">ublic</span> <span class="kd">static</span> <span class="nc">Order</span> <span class="nf">fromEventStream</span><span class="o">(</span><span class="nc">Stream</span><span class="o">&lt;</span><span class="nc">Event</span><span class="o">&gt;</span> <span class="n">events</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">order</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Order</span><span class="o">();</span>
    <span class="n">events</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">switch</span> <span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">case</span> <span class="nc">OrderCreatedEvent</span> <span class="n">orderCreatedEvent</span> <span class="o">-&gt;</span> <span class="n">order</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">orderCreatedEvent</span><span class="o">);</span>
            <span class="k">case</span> <span class="nc">OrderDeliveredEvent</span> <span class="n">orderDeliveredEvent</span> <span class="o">-&gt;</span> <span class="n">order</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">orderDeliveredEvent</span><span class="o">);</span>
            <span class="k">case</span> <span class="nc">OrderCompletedEvent</span> <span class="n">orderCompletedEvent</span> <span class="o">-&gt;</span> <span class="n">order</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">orderCompletedEvent</span><span class="o">);</span>
            <span class="k">default</span> <span class="o">-&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="s">"Invalid event found: "</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">});</span>
    <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Este método nos ayuda a recrear una <code class="language-plaintext highlighter-rouge">Order</code>; solo debemos proporcionar el stream de eventos consultando el <code class="language-plaintext highlighter-rouge">EventStore</code>:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">eventStream</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">orderEventStore</span><span class="o">.</span><span class="na">findByOrderId</span><span class="o">(</span><span class="n">command</span><span class="o">.</span><span class="na">orderId</span><span class="o">());</span>
<span class="kt">var</span> <span class="n">order</span> <span class="o">=</span> <span class="nc">Order</span><span class="o">.</span><span class="na">fromEventStream</span><span class="o">(</span><span class="n">eventStream</span><span class="o">);</span>
</pre></table></code></div></div><h3 id="guardado-de-proyecciones"><span class="mr-2">Guardado de proyecciones</span><a href="#guardado-de-proyecciones" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>En nuestro caso de uso <code class="language-plaintext highlighter-rouge">completeOrder()</code> queremos persistir la orden completada y para esto nos ayudaremos de las proyecciones. Esta proyección se guarda al completar una orden. Se utiliza la clase <code class="language-plaintext highlighter-rouge">OrderProjection</code> para representar el estado actual:</p><p>Estructura de la proyección.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="n">record</span> <span class="nf">ProductProjection</span><span class="o">(</span><span class="nc">String</span> <span class="n">sku</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">quantity</span><span class="o">)</span> <span class="o">{}</span>

<span class="kd">public</span> <span class="n">record</span> <span class="nf">OrderProjection</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ProductProjection</span><span class="o">&gt;</span> <span class="n">products</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
</pre></table></code></div></div><p>Caso de uso y guardado de la proyección.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">completeOrder</span><span class="o">(</span><span class="nc">CompleteOrderCommand</span> <span class="n">command</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">eventStream</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">orderEventStore</span><span class="o">.</span><span class="na">findByOrderId</span><span class="o">(</span><span class="n">command</span><span class="o">.</span><span class="na">orderId</span><span class="o">());</span>
    <span class="kt">var</span> <span class="n">order</span> <span class="o">=</span> <span class="nc">Order</span><span class="o">.</span><span class="na">fromEventStream</span><span class="o">(</span><span class="n">eventStream</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">complete</span><span class="o">();</span>
    <span class="n">order</span><span class="o">.</span><span class="na">getEvents</span><span class="o">()</span>
            <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">event</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">orderEventStore</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">event</span><span class="o">));</span>
    <span class="kt">var</span> <span class="n">projection</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OrderProjection</span><span class="o">(</span>
            <span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span>
            <span class="n">order</span><span class="o">.</span><span class="na">getProducts</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">ProductProjection</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getSku</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">p</span><span class="o">.</span><span class="na">getQuantity</span><span class="o">()))</span>
                    <span class="o">.</span><span class="na">toList</span><span class="o">(),</span>
            <span class="n">order</span><span class="o">.</span><span class="na">getTotal</span><span class="o">()</span>
    <span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">orderProjectionRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">projection</span><span class="o">);</span>
    <span class="n">order</span><span class="o">.</span><span class="na">cleanEvents</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><h2 id="conclusión"><span class="mr-2">Conclusión</span><a href="#conclusión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Event Sourcing es un poderoso patrón arquitectónico que proporciona una forma efectiva de manejar el estado y la historia de las operaciones en sistemas complejos. Aunque introduce cierta complejidad y consideraciones de rendimiento, sus beneficios en términos de trazabilidad, flexibilidad y consistencia son significativos, especialmente para aplicaciones que requieren un seguimiento detallado de las interacciones y cambios en el sistema.</p><h2 id="github-repository"><span class="mr-2"><a href="https://github.com/nullpointer-excelsior/java-architecture-patterns">Github repository</a></span><a href="#github-repository" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/assets/img/memes/meme8.webp" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/java/'>Java</a>, <a href='//categories/architecture/'>Architecture</a>, <a href='//categories/coding/'>Coding</a>, <a href='//categories/backend/'>Backend</a>, <a href='//categories/fullstack/'>Fullstack</a>, <a href='//categories/microservices/'>Microservices</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/java/" class="post-tag no-text-decoration" >Java</a> <a href="//tags/architecture/" class="post-tag no-text-decoration" >Architecture</a> <a href="//tags/coding/" class="post-tag no-text-decoration" >Coding</a> <a href="//tags/backend/" class="post-tag no-text-decoration" >Backend</a> <a href="//tags/fullstack/" class="post-tag no-text-decoration" >Fullstack</a> <a href="//tags/microservices/" class="post-tag no-text-decoration" >Microservices</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%C2%BFQu%C3%A9+es+y+c%C3%B3mo+funciona+el+Event+Sourcing+con+un+ejemplo+pr%C3%A1ctico%3F+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fque-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%C2%BFQu%C3%A9+es+y+c%C3%B3mo+funciona+el+Event+Sourcing+con+un+ejemplo+pr%C3%A1ctico%3F+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fque-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fque-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico%2F&text=%C2%BFQu%C3%A9+es+y+c%C3%B3mo+funciona+el+Event+Sourcing+con+un+ejemplo+pr%C3%A1ctico%3F+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2Fque-es-y-como-funciona-el-event-sourcing-con-un-ejemplo-practico%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/que-es-cqrs-y-como-funciona-con-un-ejemplo-practico/"><div class="card-body"> <em class="small" data-ts="1738645200" data-df="YYYY-MM-DD" > 2025-02-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>¿Qué es CQRS y cómo funciona? Con un ejemplo práctico.</h3><div class="text-muted small"><p> ¿Qué es CQRS y qué problema soluciona? CQRS (Command Query Responsibility Segregation) es un patrón arquitectónico que separa las operaciones de lectura y escritura en una aplicación. En lugar d...</p></div></div></a></div><div class="card"> <a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/"><div class="card-body"> <em class="small" data-ts="1675092720" data-df="YYYY-MM-DD" > 2023-01-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Trabajando con 1 millón de registros con Java Stream</h3><div class="text-muted small"><p> Trabajando con 1 millón de registros con Java Stream Cuando trabajamos con grandes cantidades de datos lo primero que hacemos es definir un filtrado de la fuente de datos para poder trabajar co...</p></div></div></a></div><div class="card"> <a href="/posts/high-performance-reactive-applications-with-spring-webflux/"><div class="card-body"> <em class="small" data-ts="1676043120" data-df="YYYY-MM-DD" > 2023-02-10 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Aplicaciones Reactivas de Alto Rendimiento con Spring WebFlux</h3><div class="text-muted small"><p> ¿Qué es Spring WebFlux Spring WebFlux es un proyecto del Framework Spring que permite el desarrollo de aplicaciones web asíncronas siguiendo el paradigma de programación reactivo. Ofrece una alt...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/integracion-de-arquitectura-hexagonal-en-spring/" class="btn btn-outline-primary" prompt="Anterior"><p>Integración de arquitectura hexagonal en Spring</p></a> <a href="//posts/que-es-cqrs-y-como-funciona-con-un-ejemplo-practico/" class="btn btn-outline-primary" prompt="Nuevo"><p>¿Qué es CQRS y cómo funciona? Con un ejemplo práctico.</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
