<!DOCTYPE html><html lang="es-ES" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Ejemplo programación reactiva 100% Real No Fake" /><meta name="author" content="Benjamin" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Ejemplo programación reactiva 100% Real No Fake" /><meta property="og:description" content="Ejemplo programación reactiva 100% Real No Fake" /><link rel="canonical" href="https://nullpointer-excelsior.github.io/posts/Ejemplo-programaci%C3%B3n-reactiva-100-Real-No-Fake/" /><meta property="og:url" content="https://nullpointer-excelsior.github.io/posts/Ejemplo-programaci%C3%B3n-reactiva-100-Real-No-Fake/" /><meta property="og:site_name" content="Nullpointer Excelsior" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-20T20:32:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Ejemplo programación reactiva 100% Real No Fake" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Benjamin"},"dateModified":"2022-09-20T20:32:00-03:00","datePublished":"2022-09-20T20:32:00-03:00","description":"Ejemplo programación reactiva 100% Real No Fake","headline":"Ejemplo programación reactiva 100% Real No Fake","mainEntityOfPage":{"@type":"WebPage","@id":"https://nullpointer-excelsior.github.io/posts/Ejemplo-programaci%C3%B3n-reactiva-100-Real-No-Fake/"},"url":"https://nullpointer-excelsior.github.io/posts/Ejemplo-programaci%C3%B3n-reactiva-100-Real-No-Fake/"}</script><title>Ejemplo programación reactiva 100% Real No Fake | Nullpointer Excelsior</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Nullpointer Excelsior"><meta name="application-name" content="Nullpointer Excelsior"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Nullpointer Excelsior</a></div><div class="site-subtitle font-italic">Ingeniería de software aplicada</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/nullpointer-excelsior" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Ejemplo programación reactiva 100% Real No Fake</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Ejemplo programación reactiva 100% Real No Fake</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1663716720" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-09-20 </em> </span><div class="d-flex justify-content-between"> <span> Por <em> Benjamin </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2181 palabras"> <em>12 min</em> de lectura</span></div></div></div><div class="post-content"><h1 id="ejemplo-programación-reactiva-100-real-no-fake">Ejemplo programación reactiva 100% Real No Fake</h1><p>La programación reactiva es un paradigma enfocado en el trabajo con flujos de datos finitos o infinitos de manera asíncrona. Su concepción y evolución ha ido ligada a la publicación del Reactive Manifesto, que establecía las bases de los sistemas reactivos, los cuales deben ser:</p><ul><li>Responsivos: aseguran la calidad del servicio cumpliendo unos tiempos de respuesta establecidos.<li>Resilientes: se mantienen responsivos incluso cuando se enfrentan a situaciones de error.<li>Elásticos: se mantienen responsivos incluso ante aumentos en la carga de trabajo.<li>Orientados a mensajes: minimizan el acoplamiento entre componentes al establecer interacciones basadas en el intercambio de mensajes de manera asíncrona.</ul><p>La motivación detrás de este nuevo paradigma procede de la necesidad de responder a las limitaciones de escalado presentes en los modelos de desarrollo actuales, que se caracterizan por su desaprovechamiento del uso de la CPU debido al I/O, el sobreuso de memoria (enormes thread pools) y la ineficiencia de las interacciones bloqueantes.</p><p>La arquitectura de estos sistemas se basa en los patrones observable, iterable y la integración del paradigma funcional. Todo esto crea una forma distinta de tratar los datos, ya que dejamos de verlos como variables y pasan a ser flujos de datos. Con el tiempo hemos pasado de tratar con una cantidad de datos ya definidos a fuentes de datos infinitas tales como mensajería en tiempo real, eventos de usuario, comunicación entre servicios en diversos protocolos, logs, Iot, etc.</p><h1 id="el-paradigma-de-programación-imperativo-solucionaba-esto">¿El paradigma de programación imperativo solucionaba esto?</h1><p>¿Imagina tratar con flujo de datos que no sabes cuando termina o intermitente en el tiempo con nuestros clásicos while data.exists() do some_operation() esto es lo más básico para tratar con datos, pero imaginate controlar si hay un error tendremos que agregar un try catch ahora si necesitamos reintentar el proceso? ¿Vamos a volver a recorrer nuestros datos? Ahora se quiere un nuevo proceso que haga cálculos con esa data, o duplicamos la lógica o la agrandamos, y si ahora los datos crecen y el algoritmo se necesita optimizar? Todo a la basura y a reimplementar, suena a complejidad y difícil de mantener.</p><p>Acordémonos del manifiesto reactivo y verás que el paradigma imperativo se vuelve complejo de usar en este contexto de sistemas.</p><p>El uso de programación reactiva no implica dejar nuestra amada clásica forma de programar es más como te había explicado la programación funcional juega un papel importante, lo que debemos tener claro es que la programación imperativa es ideal para crear funciones específicas con lógicas más pequeñas y con una responsabilidad única, no usemos esto para controlar procesos complejos cuando existen arquitecturas de software pensadas en resolver estos problemas. Con la separación de responsabilidades dentro de una solución de software con esto podemos lograr código más testeable y seguir arquitecturas como S.O.L.I.D.</p><h1 id="se-terminó-la-cháchara-vamos-a-crear-nuestra-primera-aplicación-reactiva">Se terminó la cháchara vamos a crear nuestra primera aplicación reactiva</h1><p>En esta ocasión compartiré un pequeño ejemplo de uso de programación reactiva utilizando la librería RxJs donde crearemos un servicio que utiliza Firebase con las operaciones de lectura escritura y escucha de actualizaciones de datos. Usaremos Angular ya que es un framework full reactivo ideal para este ejemplo.</p><h2 id="qué-es-un-observable"><span class="mr-2">¿Qué es un observable?</span><a href="#qué-es-un-observable" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Un observable es un objeto con el que podemos manipular un stream de datos estos pueden emir valores de forma infinita o finita de forma asíncrona y a su vez un observable nos proporciona una manera de poder estar a la escucha del flujo de datos poseen los siguientes métodos:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>
next<span class="o">()</span> <span class="c"># es la llamada a emitir un valor dado</span>
subscribe<span class="o">()</span> <span class="c"># es un método que recibe la emisión de valores</span>
<span class="nb">complete</span><span class="o">()</span> <span class="c"># nos índica que el observable termino de emitir valores y ya no volverá a hacerlo</span>
error<span class="o">()</span> <span class="c"># nos indica que un error ha ocurrido al emitir un valor</span>

</pre></table></code></div></div><p>El uso basico de un observable es el siguiente:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">obs$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">subs</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">subs</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hello</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">subs</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">"</span><span class="s2">World!!!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">obs$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>

</pre></table></code></div></div><p>nuestra salida en consola sera</p><p>“Hello”</p><p>“World”</p><p>Si invocamos a complete()</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>
<span class="kd">const</span> <span class="nx">obs$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">subs</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">subs</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hello</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">subs</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">"</span><span class="s2">World!!!</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">subs</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
    <span class="nx">subs</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">"</span><span class="s2">And Good Bye!!!</span><span class="dl">"</span><span class="p">)</span>
<span class="p">});</span>
<span class="nx">obs$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">);</span>

</pre></table></code></div></div><p>La salida sería la misma que la anterior, ya que hemos completado el observable no emitirá más valores aunque llamemos a next()</p><h2 id="creando-un-cliente-firebase"><span class="mr-2">Creando un cliente firebase</span><a href="#creando-un-cliente-firebase" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ahora crearemos un cliente Firebase utilizando la misma lógica. Definiremos una interfaz con las operaciones que nuestros casos de uso necesitan.</p><p>Hemos definido la interfaz DocumentProvider con operaciones de manipulación de documentos, Firebase no es la única solución serverless a sí que si en un futuro queremos enviar a la casa a Firebase podremos hacerlo sin complicaciones.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">rxjs</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">DocumentProvider</span> <span class="p">{</span>
    <span class="nx">saveDocument</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entity</span><span class="p">:</span> <span class="kr">any</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nx">onDocumentAdded</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entityAdapter</span><span class="p">:</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Implementamos nuestra interfaz y definimos sus métodos, agregamos la inicialización de Firebase en este caso usamos la mala práctica de inicializar un. Objeto dentro del constructor, porque se me da la gana y en este caso veo más óptimo guardar la lógica de Firebase en este componente, ya que la inyección de dependencias es más importante en los servicios core de la aplicación como los caso de uso. Implementaremos el método onDocumentAdded() ya que acá usaremos la clase Observable Rxjs.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="p">{</span> <span class="nx">initializeApp</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">firebase/app</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Firestore</span><span class="p">,</span> <span class="nx">getFirestore</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">firebase/firestore</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">environment</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../environments/environment</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">DocumentProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./providers/document.provider</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">initializeApp</span><span class="p">({</span>
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">apiKey</span><span class="p">,</span>
  <span class="na">authDomain</span><span class="p">:</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">authDomain</span><span class="p">,</span>
  <span class="na">projectId</span><span class="p">:</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">projectId</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">FirebaseClientService</span> <span class="k">implements</span> <span class="nx">DocumentProvider</span> <span class="p">{</span>

  <span class="k">private</span> <span class="nx">db</span><span class="p">:</span> <span class="nx">Firestore</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="nx">getFirestore</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nx">saveDocument</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entity</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
    
  <span class="p">}</span>

  <span class="nx">onDocumentAdded</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entityAdapter</span><span class="p">:</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">DocumentData</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>

    
  <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Lo primero es definir el queryDocument para poder estar a la escucha de nuevos documentos agregados en Firebase.</p><p>Llamamos al objeto query y a su vez a collection de las librerías de Firebase le pasamos como parámetro el nombre de una colección y el objeto ya inicializado de FireStore, con esto obtenemos el queryDocument con el cual hacer operaciones sobre Firebase.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
 <span class="nx">onDocumentAdded</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entityAdapter</span><span class="p">:</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">DocumentData</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">queryDocument</span> <span class="o">=</span> <span class="nx">query</span><span class="p">(</span><span class="nx">collection</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">,</span> <span class="nx">collectionName</span><span class="p">));</span>
 <span class="p">}</span>

</pre></table></code></div></div><p>Ahora definimos las siguientes funciones callback para crear nuestro objeto observable. Estas funciones son necesarias por Firebase para poder crear una escucha en tiempo real de las actualizaciones de los documentos mediante una función onSnapshot() propia de Firebase</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>
    <span class="nx">onDocumentAdded</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entityAdapter</span><span class="p">:</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">DocumentData</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="kd">const</span> <span class="nx">queryDocument</span> <span class="o">=</span> <span class="nx">query</span><span class="p">(</span><span class="nx">collection</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">,</span> <span class="nx">collectionName</span><span class="p">));</span>

        <span class="kd">const</span> <span class="nx">onSnapshotNext</span> <span class="o">=</span> <span class="p">(</span><span class="nx">snapshot</span><span class="p">:</span> <span class="nx">QuerySnapshot</span><span class="o">&lt;</span><span class="nx">DocumentData</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">onSnapshotError</span> <span class="o">=</span> <span class="p">(</span><span class="nx">error</span><span class="p">:</span> <span class="nx">FirestoreError</span><span class="p">,</span> <span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">onSnapshotComplete</span> <span class="o">=</span> <span class="p">(</span><span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

        <span class="p">}</span>

    <span class="p">}</span>

</pre></table></code></div></div><p>onSnapshotNext(): Esta función llama a observer.next() cuando recibe un documento de Firebase y con esto nuestro observable emitirá el valor obtenido. Cuando nos ponemos en escucha a los cambios de un documento en Firebase con snapshot.docChanges() recibimos un objeto de tipo QuerySnapshot el cual nos permite realizar operaciones para obtener una respuesta más limpia adecuada a nuestras necesidades.</p><p>así que haremos lo siguiente:</p><ul><li>filtraremos por él el change.type de “added”<li>haremos un map() a la propiedad “data”<li>usaremos la función callback entityAdapter() para convertir los datos recibidos de Firebase a un objeto de tipo Entidad de nuestra aplicación. Con esto centralizamos la inicialización de una entidad en un único punto<li>Por cada documento agregado llamamos a observer.next(entityValue)</ul><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>
<span class="kd">const</span> <span class="nx">onSnapshotNext</span> <span class="o">=</span> <span class="p">(</span><span class="nx">snapshot</span><span class="p">:</span> <span class="nx">QuerySnapshot</span><span class="o">&lt;</span><span class="nx">DocumentData</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">snapshot</span><span class="p">.</span><span class="nx">docChanges</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">change</span> <span class="o">=&gt;</span> <span class="nx">change</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">added</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">change</span> <span class="o">=&gt;</span> <span class="nx">change</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">data</span><span class="p">())</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="nx">entityAdapter</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">entity</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">entity</span><span class="p">))</span>
    <span class="p">}</span>

</pre></table></code></div></div><p>La implementación de observer.error() y observer.complete() son las siguientes:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>
    <span class="kd">const</span> <span class="nx">onSnapshotError</span> <span class="o">=</span> <span class="p">(</span><span class="nx">error</span><span class="p">:</span> <span class="nx">FirestoreError</span><span class="p">,</span> <span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">onSnapshotComplete</span> <span class="o">=</span> <span class="p">(</span><span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">()</span>
    <span class="p">}</span>

</pre></table></code></div></div><p>Ahora definimos nuestro objeto Observable y dentro de su función callback llamamos a onSnapshot() quien es el encargado de poder tener nuestros documentos de Firebase en tiempo real, a esta función le debemos pasar como parámetros las funciones que definimos onSnapshoNext() onSnapshotError() y onSnapshotComplete() y con esto ya tendríamos la posibilidad de suscribirnos a nuevos documentos agregados.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>
 <span class="kd">const</span> <span class="nx">documentAdded$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">((</span><span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// función Firebase para poder estar a la escucha de eventos en tiempo real</span>
    <span class="nx">onSnapshot</span><span class="p">(</span>
        <span class="nx">queryDocument</span><span class="p">,</span> <span class="c1">// collecion de documentos a escuchar por nuevos cambios</span>
        <span class="p">(</span><span class="nx">snapshot</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">onSnapshotNext</span><span class="p">(</span><span class="nx">snapshot</span><span class="p">,</span> <span class="nx">observer</span><span class="p">),</span> <span class="c1">// funcion callback para emitir valores</span>
        <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">onSnapshotError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">observer</span><span class="p">),</span> <span class="c1">// error</span>
        <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">onSnapshotComplete</span><span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="c1">// termino de emision de eventos</span>
    <span class="p">);</span>
<span class="p">})</span>

</pre></table></code></div></div><p>Finalmente devolvemos nuestro observable, pero fíjense en que el observable lo devolvemos con un llamado a una función llamada pipe() y ¿para qué sirve pipe? Pipe nos sirve para poder encadenar operadores o funciones que se ejecutaran sobre los flujos de datos de nuestro observable y en esta ocasión lo usamos para agregar el operador share() es cuál nos permite que el observable que retorna es único para todos los que se suscriban a él, si share() no estuviera cada vez que un cliente se suscriba a Firebase se crearía una nueva conexión a Firebase lo cual no es óptimo en este caso, a posibilidad de pipe es que nos puede devolver nuevos observables a partir de otros. Que maravilla lógicas complejas pueden ser reutilizables.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
<span class="k">return</span> <span class="nx">documentAdded$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">share</span><span class="p">()</span>
<span class="p">)</span>

</pre></table></code></div></div><h2 id="otra-forma-de-crear-observables"><span class="mr-2">Otra forma de crear observables</span><a href="#otra-forma-de-crear-observables" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ahora implementaremos el método saveDocument() este deberá guardar un documento en Firebase y devolver un Observable para crear observables Rxjs nos facilita operadores creacionales para facilitar este proceso, no siempre crear un Observable a la vieja escuela es lo ideal, pero a veces debemos hacerlo en esta ocasión usaremos el operador from() con el cual podemos crear un observable a partir de una promesa y así de simple cuando necesitamos observables a partir de primitivos u objetos. Existen más operadores creacionales, pero no se abordan acá.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>
<span class="nx">saveDocument</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entity</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">setDoc</span><span class="p">(</span><span class="nx">doc</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">,</span> <span class="nx">collectionName</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span> <span class="nx">entity</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">from</span><span class="p">(</span><span class="nx">promise</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">map</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">entity</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Finalmente nuestro servicio queda de la siguiente manera:</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="p">{</span> <span class="nx">initializeApp</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">firebase/app</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">setDoc</span><span class="p">,</span> <span class="nx">DocumentData</span><span class="p">,</span> <span class="nx">Firestore</span><span class="p">,</span> <span class="nx">FirestoreError</span><span class="p">,</span> <span class="nx">getDoc</span><span class="p">,</span> <span class="nx">getFirestore</span><span class="p">,</span> <span class="nx">QuerySnapshot</span><span class="p">,</span> <span class="nx">collection</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">onSnapshot</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">firebase/firestore</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="k">from</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">Observable</span><span class="p">,</span> <span class="nx">Observer</span><span class="p">,</span> <span class="nx">share</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">environment</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">../../../environments/environment</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">DocumentProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./providers/document.provider</span><span class="dl">'</span><span class="p">;</span>


<span class="nx">initializeApp</span><span class="p">({</span>
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">apiKey</span><span class="p">,</span>
  <span class="na">authDomain</span><span class="p">:</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">authDomain</span><span class="p">,</span>
  <span class="na">projectId</span><span class="p">:</span> <span class="nx">environment</span><span class="p">.</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">projectId</span>
<span class="p">});</span>

<span class="k">export</span> <span class="kd">class</span> <span class="nx">FirebaseService</span> <span class="k">implements</span> <span class="nx">DocumentProvider</span> <span class="p">{</span>

  <span class="k">private</span> <span class="nx">db</span><span class="p">:</span> <span class="nx">Firestore</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="nx">getFirestore</span><span class="p">();</span> <span class="p">}</span>

  <span class="nx">saveDocument</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entity</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">setDoc</span><span class="p">(</span><span class="nx">doc</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">,</span> <span class="nx">collectionName</span><span class="p">,</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span> <span class="nx">entity</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">from</span><span class="p">(</span><span class="nx">promise</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">map</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">entity</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">onDocumentAdded</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">entityAdapter</span><span class="p">:</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">DocumentData</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="kr">any</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">const</span> <span class="nx">queryDocument</span> <span class="o">=</span> <span class="nx">query</span><span class="p">(</span><span class="nx">collection</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">,</span> <span class="nx">collectionName</span><span class="p">));</span>

    <span class="kd">const</span> <span class="nx">onSnapshotNext</span> <span class="o">=</span> <span class="p">(</span><span class="nx">snapshot</span><span class="p">:</span> <span class="nx">QuerySnapshot</span><span class="o">&lt;</span><span class="nx">DocumentData</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">snapshot</span><span class="p">.</span><span class="nx">docChanges</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">change</span> <span class="o">=&gt;</span> <span class="nx">change</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">added</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">change</span> <span class="o">=&gt;</span> <span class="nx">change</span><span class="p">.</span><span class="nx">doc</span><span class="p">.</span><span class="nx">data</span><span class="p">())</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="nx">entityAdapter</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">entity</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">entity</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">onSnapshotError</span> <span class="o">=</span> <span class="p">(</span><span class="nx">error</span><span class="p">:</span> <span class="nx">FirestoreError</span><span class="p">,</span> <span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">onSnapshotComplete</span> <span class="o">=</span> <span class="p">(</span><span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">documentAdded$</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">((</span><span class="nx">observer</span><span class="p">:</span> <span class="nx">Observer</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">onSnapshot</span><span class="p">(</span>
        <span class="nx">queryDocument</span><span class="p">,</span>
        <span class="p">(</span><span class="nx">snapshot</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">onSnapshotNext</span><span class="p">(</span><span class="nx">snapshot</span><span class="p">,</span> <span class="nx">observer</span><span class="p">),</span> 
        <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">onSnapshotError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">observer</span><span class="p">),</span> 
        <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">onSnapshotComplete</span><span class="p">(</span><span class="nx">observer</span><span class="p">));</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="nx">documentAdded$</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">share</span><span class="p">()</span>
    <span class="p">)</span>
    
  <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>Uso de FirebaseService</p><p>Inyección de FirebaseService en el módulo de la aplicación. esto es importante ya que definimos una interfaz como servicio. no utilizamos el decorador.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>
<span class="k">import</span> <span class="p">{</span> <span class="nx">InjectionToken</span><span class="p">,</span> <span class="nx">NgModule</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">AppComponent</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./app.component</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">DOCUMENT_SERVICE</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionToken</span><span class="o">&lt;</span><span class="nx">DocumentProvider</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">app.document.service</span><span class="dl">'</span><span class="p">);</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">AppComponent</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">RouterModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">(</span><span class="nx">routes</span><span class="p">),</span>
    <span class="nx">RegisterModule</span>
    <span class="nx">AppRoutingModule</span><span class="p">,</span>
    <span class="nx">SharedModule</span><span class="p">,</span>
  <span class="p">],</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[{</span>
    <span class="na">provide</span><span class="p">:</span> <span class="nx">DOCUMENT_SERVICE</span><span class="p">,</span>
    <span class="na">useClass</span><span class="p">:</span> <span class="nx">FirebaseService</span>
  <span class="p">}],</span>
  <span class="na">bootstrap</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{</span> <span class="p">}</span>

</pre></table></code></div></div><p>Uso de FirebaseService</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span>
  <span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">MessageService</span> <span class="p">{</span>

  <span class="kd">constructor</span><span class="p">(@</span><span class="nd">Inject</span><span class="p">(</span><span class="nx">DOCUMENT_SERVICE</span><span class="p">)</span> <span class="k">private</span> <span class="nx">firebase</span><span class="p">:</span> <span class="nx">DocumentProvider</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="nx">sendMessage</span><span class="p">(</span><span class="nx">msg</span><span class="p">:</span> <span class="nx">Message</span><span class="p">){</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">saveDocument</span><span class="p">(</span><span class="dl">'</span><span class="s1">messages</span><span class="dl">'</span><span class="p">,</span> <span class="nx">msg</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">getRealtimeMessages</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">Message</span><span class="o">&gt;</span> <span class="p">{</span>
    
    <span class="kd">const</span> <span class="nx">adapter</span> <span class="o">=</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="kr">any</span><span class="p">):</span> <span class="nx">Message</span> <span class="o">=&gt;</span> <span class="p">({</span> 
      <span class="na">id</span><span class="p">:</span> <span class="nx">data</span><span class="p">[</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">message</span><span class="p">:</span> <span class="nx">data</span><span class="p">[</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">createdAt</span><span class="p">:</span> <span class="nx">data</span><span class="p">[</span><span class="dl">'</span><span class="s1">createdAt</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">images</span><span class="p">:</span> <span class="nx">data</span><span class="p">[</span><span class="dl">'</span><span class="s1">images</span><span class="dl">'</span><span class="p">]</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">firebase</span><span class="p">.</span><span class="nx">onDocumentAdded</span><span class="p">(</span><span class="dl">'</span><span class="s1">messages</span><span class="dl">'</span><span class="p">,</span> <span class="nx">adapter</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span>
      <span class="nx">filter</span><span class="p">(</span><span class="nx">attack</span> <span class="o">=&gt;</span> <span class="nx">attack</span><span class="p">.</span><span class="nx">message</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">)</span>

  <span class="p">}</span>

<span class="p">}</span>

</pre></table></code></div></div><p>## Conclusión</p><p>Aca no hay concluciones hay memes.</p><p><img data-src="https://i.ibb.co/1JFL4MC/memejavascript.jpg" alt="meme" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/programacion/'>Programacion</a>, <a href='//categories/angular/'>Angular</a>, <a href='//categories/rxjs/'>Rxjs</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/rxjs/" class="post-tag no-text-decoration" >rxjs</a> <a href="//tags/typescript/" class="post-tag no-text-decoration" >typescript</a> <a href="//tags/javascript/" class="post-tag no-text-decoration" >javascript</a> <a href="//tags/frontend/" class="post-tag no-text-decoration" >frontend</a> <a href="//tags/firebase/" class="post-tag no-text-decoration" >firebase</a> <a href="//tags/observables/" class="post-tag no-text-decoration" >observables</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ejemplo+programaci%C3%B3n+reactiva+100%25+Real+No+Fake+-+Nullpointer+Excelsior&url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2FEjemplo-programaci%25C3%25B3n-reactiva-100-Real-No-Fake%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ejemplo+programaci%C3%B3n+reactiva+100%25+Real+No+Fake+-+Nullpointer+Excelsior&u=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2FEjemplo-programaci%25C3%25B3n-reactiva-100-Real-No-Fake%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2FEjemplo-programaci%25C3%25B3n-reactiva-100-Real-No-Fake%2F&text=Ejemplo+programaci%C3%B3n+reactiva+100%25+Real+No+Fake+-+Nullpointer+Excelsior" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fnullpointer-excelsior.github.io%2Fposts%2FEjemplo-programaci%25C3%25B3n-reactiva-100-Real-No-Fake%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/microservicios-observabilidad-en-microservicios-un-ejemplo-practico-de-trazas-distribuidas/">Microservicios 2 Observabilidad en NestJs, un ejemplo práctico de trazas distribuidas</a><li><a href="/posts/realtime-with-reactive-programming/">Aplicaciones en tiempo real con programación reactiva</a><li><a href="/posts/tranajando-con-1millon-de-registros-con-java-stream/">Trabajando con 1 millón de registros con Java Stream</a><li><a href="/posts/disenando-microservicios-con-ddd/">Diseñando Microservicios con Domain Driven Design y NestJS</a><li><a href="/posts/alto-rendimiento-con-cqrs-eventos-en-nestjs/">CQRS en Soluciones de Alto Rendimiento con Nestjs</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/arquitectura-frontend-1-como-integrar-rxjs-4-react-para-aplicaciones-asincronas-complejas/"><div class="card-body"> <em class="small" data-ts="1692640120" data-df="YYYY-MM-DD" > 2023-08-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitectura Frontend 1. Cómo integrar RxJS en React para aplicaciones asíncronas complejas</h3><div class="text-muted small"><p> React es una excelente librería para crear componentes visuales. También nos brinda los hooks, con los cuales podemos trabajar con estados y efectos secundarios en situaciones asíncronas. Si bien...</p></div></div></a></div><div class="card"> <a href="/posts/arquitectura-frontend-2-como-implementar-clean-arquitecture/"><div class="card-body"> <em class="small" data-ts="1697002727" data-df="YYYY-MM-DD" > 2023-10-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Arquitectura Frontend 2. Cómo implementar Clean Architecture en el Frontend.</h3><div class="text-muted small"><p> La aplicación de los principios de la arquitectura limpia (Clean Architecture) no se limita al ámbito del backend; de hecho, pueden ser igualmente beneficiosos cuando se aplican al frontend, ofre...</p></div></div></a></div><div class="card"> <a href="/posts/Usando-los-Hooks-de-React-m%C3%A1s-all%C3%A1-del-useState/"><div class="card-body"> <em class="small" data-ts="1663803120" data-df="YYYY-MM-DD" > 2022-09-21 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Usando los Hooks de React más allá del useState</h3><div class="text-muted small"><p> Usando los Hooks de React más allá del useState Hack 1 - Petición asíncrona con useState() y useEffect() juntos El siguiente componente muestra los datos obtenidos mediante una operación asíncron...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/Specification-pattern/" class="btn btn-outline-primary" prompt="Anterior"><p>¿Que es el Patron especification?</p></a> <a href="//posts/Usando-los-Hooks-de-React-m%C3%A1s-all%C3%A1-del-useState/" class="btn btn-outline-primary" prompt="Nuevo"><p>Usando los Hooks de React más allá del useState</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/nullpointer-excelsior">Benjamin</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/nestjs/">nestjs</a> <a class="post-tag" href="/tags/arquitectura/">arquitectura</a> <a class="post-tag" href="/tags/hexagonal/">hexagonal</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/frontend/">frontend</a> <a class="post-tag" href="/tags/java/">Java</a> <a class="post-tag" href="/tags/microservicios/">microservicios,</a> <a class="post-tag" href="/tags/typescript/">Typescript</a> <a class="post-tag" href="/tags/architecture/">Architecture</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
